define(["backbone","model/content","model/data","model/token-data","view/content","view/popup","util/language-message"],function(a,b,c,d,e,f,g){var h=1900,i=1901,j=1902,k={1900:{},1901:{},1902:{}},l={AIRSHIP_ENHANCE:1,BATTLE_RESULT:2},m=e.extend({isBattleResult:!1,events:{"tap #btn-auto-setting":"onTapBtnAutoSetting","tap .pop-common-auto-setting .btn-auto-setting:not(.disable)":"onTapPopCommonAutoSettingBtnAutoSetting","tap .pop-common-auto-setting .btn-auto-setting.disable":"popCommonCustomConditionSetting","tap .pop-common-auto-setting .btn-condition-setting:not(.disable)":"onTapBtnConditionSetting","tap .pop-common-auto-setting .btn-condition-setting.disable":"popCommonCustomConditionSetting","tap .pop-common-auto-setting .btn-usual-ok":"onTapPopCommonAutoSettingBtnOk","tap .pop-common-auto-setting .btn-usual-close":"popRemove","tap .pop-common-auto-setting .btn-usual-cancel":"popRemoveBattleResult",'change .pop-common-auto-detail-setting input[name="auto-setting-rarity"]':"onChangePopAutoDetailSettingBtnRarity","tap .pop-common-auto-detail-setting .btn-usual-ok":"onTapPopAutoDetailSettingBtnOk","tap .pop-common-auto-detail-setting .btn-usual-close":"popRemoveSecond","tap .pop-common-custom-condition-setting .btn-usual-ok":"popRemoveSecond"},initialize:function(a){var b=a.pageType;this.isBattleResult=+b===l.BATTLE_RESULT},getAutoSellSetting:function(){this.trigger("xhrStart");var a=this,b=new(c.extend({urlRoot:Game.baseUri+"setting/auto_sell_setting/"}));this.stopListening(b,"sync"),this.listenTo(b,"sync",function(b){a.autoSettingInfo=b.toJSON(),a.popAutoSetting(),a.trigger("xhrEnd")}),this.getAutoSellSetting=function(){b.fetch()},this.getAutoSellSetting()},postSettingSave:function(){this.trigger("xhrStart");var a=this,b=new(d.extend({urlRoot:Game.baseUri+"setting/save"}));this.stopListening(b,"sync"),this.listenTo(b,"sync",function(){a.popView.popRemove(),a.trigger("xhrEnd")}),this.postSettingSave=function(){var c=+a.autoSettingInfo.auto_sell_weapon,d=+a.autoSettingInfo.auto_custom_weapon,e=+a.autoSettingInfo.auto_sell_summon,f={auto_sell_weapon:{setting_val:a.popView.$el.find(".btn-auto-setting.weapon").hasClass("active")?1:0,rarity_val:_.isUndefined(k[h].rarityVal)===!1?k[h].rarityVal:c>=2?1:0,skill_val:_.isUndefined(k[h].skillVal)===!1?k[h].skillVal:3===c||5===c?1:0,angel_val:_.isUndefined(k[h].angelVal)===!1?k[h].angelVal:4===c||5===c?1:0},auto_custom_weapon:{setting_val:a.popView.$el.find(".btn-auto-setting.guild").hasClass("active")?1:0,rarity_val:_.isUndefined(k[i].rarityVal)===!1?k[i].rarityVal:d>=2?1:0,skill_val:_.isUndefined(k[i].skillVal)===!1?k[i].skillVal:3===d||5===d?1:0,angel_val:_.isUndefined(k[i].angelVal)===!1?k[i].angelVal:4===d||5===d?1:0},auto_sell_summon:{setting_val:a.popView.$el.find(".btn-auto-setting.summon").hasClass("active")?1:0,rarity_val:_.isUndefined(k[j].rarityVal)===!1?k[j].rarityVal:e>=2?1:0,skill_val:_.isUndefined(k[j].skillVal)===!1?k[j].skillVal:0,angel_val:_.isUndefined(k[j].angelVal)===!1?k[j].angelVal:4===e?1:0}};b.set(f).save()},this.postSettingSave()},popAutoSetting:function(){this.popView=new f({className:"pop-common-auto-setting",title:g.getMessage("pop_common_auto_setting_1"),body:_.template($("#tpl-common-auto-setting").html(),this.autoSettingInfo),flagBtnClose:this.isBattleResult===!0?0:1,flagBtnCancel:this.isBattleResult===!0?1:0,flagBtnOk:1}),this.popView.render().popShow()},popAutoSettingDetail:function(a){var b=this,c=this.adjustAutoSettingInfo(a);this.secondPopView=new f({el:"#pop-second",className:"pop-common-auto-detail-setting",title:g.getMessage("pop_common_auto_setting_2"),body:_.template($("#tpl-common-auto-detail-setting").html(),c),flagBtnClose:1,flagBtnOk:1,showEndCallback:function(){b.secondPopView.$el.find(".btn-usual-ok").attr("data-type",a)}}),this.changeMaskZindexVal(this.popView.$el.find(".pop-usual")),this.secondPopView.render().popShow()},popCommonCustomConditionSetting:function(){this.secondPopView=new f({el:"#pop-second",className:"pop-common-custom-condition-setting",title:g.getMessage("pop_common_auto_setting_3"),body:g.getMessage("pop_common_auto_setting_4"),flagBtnClose:0,flagBtnOk:1}),this.changeMaskZindexVal(this.popView.$el.find(".pop-usual")),this.secondPopView.render().popShow()},popRemove:function(){this.popView&&this.popView.popRemove()},popRemoveSecond:function(){this.secondPopView&&(this.secondPopView.popRemove(1),this.popView.$el.find(".pop-usual").css("z-index",this.popZindexVal))},popRemoveBattleResult:function(){this.popRemove(),this.trigger("popRemoveAutoSetting")},onTapBtnAutoSetting:function(){this.getAutoSellSetting()},onTapPopCommonAutoSettingBtnOk:function(){this.postSettingSave()},onTapPopCommonAutoSettingBtnAutoSetting:function(a){a.preventDefault();var b=$(a.currentTarget);b.hasClass("active")?b.removeClass("active"):(b.hasClass("summon")||this.$el.find(".btn-auto-setting:not(.summon)").removeClass("active"),b.addClass("active"))},onTapBtnConditionSetting:function(a){a.preventDefault(),this.popAutoSettingDetail($(a.currentTarget).data("type"))},onChangePopAutoDetailSettingBtnRarity:function(a){var b=$(a.currentTarget),c=this.secondPopView.$el.find(".btn-usual-setting.skill, .btn-usual-setting.angel");"auto-setting-normal-on"===b.attr("id")?(c.addClass("disable btn-cancel"),c.siblings("input").prop("disabled",!0)):(c.removeClass("disable btn-cancel"),c.siblings("input").prop("disabled",!1))},onTapPopAutoDetailSettingBtnOk:function(a){k[$(a.currentTarget).data("type")]={rarityVal:$("#auto-setting-rare-on").prop("checked")?1:0,skillVal:$("#auto-setting-skill-on").prop("checked")?1:0,angelVal:$("#auto-setting-angel-on").prop("checked")?1:0},this.popRemoveSecond()},adjustAutoSettingInfo:function(a){var b={type:a,isSetDetailSetting:!0,settingInfo:""};if(0===_.size(k[a])){switch(a){case h:b.settingInfo=this.autoSettingInfo.auto_sell_weapon;break;case i:b.settingInfo=this.autoSettingInfo.auto_custom_weapon;break;case j:b.settingInfo=this.autoSettingInfo.auto_sell_summon}b.isSetDetailSetting=!1}else b.settingInfo=k;return b},changeMaskZindexVal:function(a){this.popZindexVal=a.css("z-index"),a.css("z-index",$(".mask").css("z-index"))}});return m});
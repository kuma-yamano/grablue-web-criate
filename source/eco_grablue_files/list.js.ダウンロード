define(["jquery","underscore","model/token-data","view/content"],function(a,b,c,d){var e=2,f=4,g=5,h=6,i=7,j={npc:[f,h,e,i],weapon:[f,g,e],summon:[f,e]};return d.extend({isFetchedNpcLbClass:!1,getNextStatusId:function(a,b){var c=j[a],d=(c.indexOf(b)+1)%c.length;return c[d]},toggleListStatus:function(c,d,f){if(0!==d.length){var g=+a(c.currentTarget).data("id")||e;f=f||b.find(["npc","weapon","summon"],function(b){return a(c.currentTarget).closest(".prt-list").hasClass(b)});var i=this.getNextStatusId(f,g);return i!==h||this.isFetchedNpcLbClass?void this.renderListStatus(d,f,i):(this.isFetchedNpcLbClass=!0,Game.loading.xhrStart(),void this.postNpcLbClass(d).done(function(){this.renderListStatus(d,f,i)}.bind(this)))}},renderListStatus:function(c,d,e){var f=(a("#pop").html()?this.popView:this).$el,g=a("#lis-"+d).length?a("#lis-"+d):f,h=g.find(".prt-lis-item-wrap"),i=f.find(".prt-param-icon");h.each(function(f){a(this).html(b.template(a("#tpl-lis-item").html(),{n:c[f],dir:d,options:{status:e}}))}),i.html(b.template(a("#tpl-current-param").html(),{status:e}))},postNpcLbClass:function(d){var e=a.Deferred(),f=new(c.extend({urlRoot:Game.baseUri+"npc/npczenith_rank/"}));this.stopListening(f,"sync"),this.listenToOnce(f,"sync",function(b){a.extend(!0,d,b.toJSON().list),e.resolve(),Game.loading.xhrEnd()});var g=b.map(d,function(a){return a.master.id});return f.set({character_ids:g}).save(),e}})});
define(["model/data","model/quest/user-actionpoint","view/quest/item-popup"],function(a,b,c){var d=7,e=null,f=a.extend({initialize:function(a){this.param=a},check_quest:function(a){var c=new b;this.stopListening(c,"sync"),this.listenToOnce(c,"sync",this.actionpoint_check),c.fetch(),this.callback=a},actionpoint_check:function(a){this.actionpointCompare(a.toJSON())},actionpointCompare:function(a){var b=+this.param.type===d&&!!this.param.pre_set_flg,f=+a.max_action_point,g=+a.action_point,h=+this.param.quest_ap,i=b?3:1;Game.loading.xhrEnd(),h>f?this.callback({ap_over:!0}):g>=h||1==this.param.progress?this.callback(this.param.quest_id,this.param.type):e=new c({recovery:1,quest_id:this.param.quest_id,type:this.param.type,quest_ap:h,chapter_name:this.param.chapter_name||"",pop_z_position:i,pointData:a})}});return f});
define(["view/content","view/popup","model/data","model/token-data","util/language-message"],function(a,b,c,d,e){var f="rest/quest/droplist/",g=a.extend({events:{"tap .pop-drop-item-list .btn-usual-ok":"popRemoveDropItemList","tap .pop-drop-item-list .btn-drop-item-image":"btnDropItemDetail","tap .pop-drop-item-detail .btn-usual-close":"popCloseDropItemDetail"},btnDropItemList:function(a){var b=$(a.currentTarget),c=b.data("quest-id");this.getDropItemList(c)},getDropItemList:function(a){this.trigger("xhrStart");var b=this;this.dropItemListModel=new(c.extend({urlRoot:Game.baseUri+f+"drop_item_list/"+a})),this.stopListening(this.dropItemListModel,"sync"),this.listenToOnce(this.dropItemListModel,"sync",function(){b.trigger("xhrEnd"),b.popDropItemList()}),this.dropItemListModel.fetch()},popDropItemList:function(){var a=this.dropItemListModel.toJSON(),c=1===+a.quest_type||7===+a.quest_type;this.popView=new b({className:"pop-drop-item-list",title:a.chapter_name,body:_.template($("#tpl-pop-drop-item-list").html(),{list:a.item_list,isMulti:c}),flagBtnOk:1}),this.popView.render().popShow()},btnDropItemDetail:function(a){this.popView.popClose();var b=$(a.currentTarget),c=b.data("item-id"),d=b.data("item-kind");this.getDropItemDetail(c,d)},getDropItemDetail:function(a,b){this.trigger("xhrStart"),this.dropItemDetailModel=new(d.extend({urlRoot:Game.baseUri+f+"drop_item_detail"})),this.stopListening(this.dropItemDetailModel,"sync"),this.listenToOnce(this.dropItemDetailModel,"sync",this.popDropItemDetail),this.dropItemDetailModel.set({item_id:a,item_kind:b}).save()},popDropItemDetail:function(a){this.trigger("xhrEnd");var c=a.toJSON();this.popView=new b({className:"pop-drop-item-detail",title:e.getMessage("pop_drop_item_detail_1"),body:_.template($("#tpl-pop-drop-item-detail").html(),c),flagBtnClose:1,btnTreasure:1,treasureId:Game.footer&&Game.footer.mainView.validateTreasure({id:c.item_id,kind:c.item_kind}),treasureName:c.name}),this.popView.render().popShow()},popRemoveDropItemList:function(){this.popView&&this.popView.popRemove(),this.trigger("popRemoveDropItemList");var a=this;this.stopListening(this.popView),this.listenToOnce(this.popView,"removeEnd",function(){a.trigger("removeEndDropItemList")}),this.listenToOnce(this.popView,"popEmptyEnd",function(){a.trigger("popEmptyEndDropItemList")})},popCloseDropItemDetail:function(){this.popView&&this.popView.popDelete(),this.popDropItemList()}});return g});
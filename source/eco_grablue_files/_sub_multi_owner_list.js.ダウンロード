define(["model/data","view/quest/list-sub","view/popup","util/language-message"],function(a,b,c,d){var e={NORMAL:"normal",HIGH:"high",EVENT:"event"},f=b.extend({el:".contents",events:_.extend(b.prototype.events,{"tap .prt-select-type .btn-stage-type:not(.active)":"changeStageType","tap .prt-stage-rank-list .btn-stage-detail":"onTapStageDetail","tap .pop-stage-detail .btn-usual-close":"popRemove","tap .pop-stage-detail .btn-set-quest:not(.disable)":"onTapSetQuest","tap .pop-event-end-period .btn-usual-ok":"popRemove","tap .pop-synopsis .btn-usual-ok":"popRemove"}),initialize:function(){this.stageType=e.NORMAL},subViewRender:function(){this.$el.find(".prt-owner-list").html($("#tpl-owner-list").html()),this.getStageList()},changeStageType:function(a){var b=$(a.currentTarget);this.$el.find(".btn-stage-type").removeClass("active"),b.addClass("active"),this.stageType=b.data("stage-type"),this.getStageList()},getStageList:function(){var b=this,c="";switch(this.stageType){case e.NORMAL:c=Game.baseUri+"rest/quest/multi/stage_list/1";break;case e.HIGH:c=Game.baseUri+"rest/quest/multi/stage_list/2";break;case e.EVENT:c=Game.baseUri+"rest/quest/eventmulti/stage_list"}var f=new(a.extend({urlRoot:c}));this.trigger("xhrStart"),this.stopListening(f,"sync"),this.listenToOnce(f,"sync",function(a){b.$el.find(".prt-stage-rank-list").html(_.template($("#tpl-stage-rank-list").html(),{stageListData:a.attributes,stageType:b.stageType}));var c="";c=b.stageType!==e.EVENT?d.getMessage("multi_owner_1"):a.attributes.list&&a.attributes.list.length>0?d.getMessage("multi_owner_2"):d.getMessage("multi_owner_3"),b.setStageLeadTxt(c),b.trigger("xhrEnd")}),f.fetch()},setStageLeadTxt:function(a){this.$el.find(".prt-stage-lead-txt").text(a)},onTapStageDetail:function(a){var b=$(a.currentTarget);this.stageDifficulty=b.data("stage-difficulty"),this.getStageDetail(b)},getStageDetail:function(b){var c=this,d="";switch(this.stageType){case e.NORMAL:d=Game.baseUri+"rest/quest/multi/stage_detail/1/"+this.stageDifficulty;break;case e.HIGH:d=Game.baseUri+"rest/quest/multi/stage_detail/2/"+this.stageDifficulty;break;case e.EVENT:d=Game.baseUri+"rest/quest/eventmulti/stage_detail/"+b.data("event-id")}this.trigger("xhrStart");var f=new(a.extend({urlRoot:d}));this.stopListening(f,"sync"),this.listenToOnce(f,"sync",function(a){c.stageDetail=a.attributes,c.popStageDetail(),c.trigger("xhrEnd")}),f.fetch()},popStageDetail:function(){this.stageType!==e.EVENT?this.popView=this.createPopStageDetail():this.popView=this.createPopStageDetailEvent(),this.popView.render().popShow()},createPopStageDetail:function(){var a={questList:this.stageDetail.list,stageType:this.stageType},b="img-icon-star"+(this.stageType===e.NORMAL?"0":"1")+this.stageDifficulty;return new c({className:"pop-stage-detail",title:'<div class="'+b+'"></div>',body:_.template($("#tpl-stage-detail").html(),a),flagBtnClose:1})},createPopStageDetailEvent:function(){var a;if(this.stageDetail.is_progress){var b={questList:this.stageDetail.list,stageType:this.stageType};a=new c({className:"pop-stage-detail",title:this.stageDetail.title,body:_.template($("#tpl-stage-detail").html(),b),flagBtnClose:1})}else a=new c({className:"pop-event-end-period",title:d.getMessage("multi_owner_pop_event_1"),body:d.getMessage("multi_owner_pop_event_2"),flagBtnOk:1});return a},popSynopsis:function(a){var b=this.stageDetail.list[$(a.currentTarget).data("index")],e=b.is_open===!0?b.quest_name:d.getMessage("multi_owner_pop_1");this.popView.popDelete({isHideMask:!1}),this.popView=new c({className:"pop-synopsis",title:e,body:_.template($("#tpl-quest-information").html(),{questData:b,isGetDropItem:b.is_display_drop_item||!1,questId:b.quest_id}),flagBtnOk:1}),this.popView.render().popShow(),this.setGetDropItemListSubView()},btnDropItemList:function(a){var b=this,c="popEmptyEndDropItemList";this.getDropItemListSubView.btnDropItemList(a),this.stopListening(this.getDropItemListSubView,c),this.listenToOnce(this.getDropItemListSubView,c,function(){b.popStageDetail()})},popRemove:function(){var a=["pop-synopsis","pop-treasure-raid"];this.popView&&(_.contains(a,this.popView.className)?(this.stopListening(this.popView,"popEmptyEnd"),this.listenToOnce(this.popView,"popEmptyEnd",this.popStageDetail.bind(this)),this.popView.popRemove(1)):this.popView.popRemove())},onTapSetQuest:function(a){this.stopListening(this.popView,"popEmptyEnd"),this.listenToOnce(this.popView,"popEmptyEnd",this.preQuestStart.bind(this,a)),this.popView.popRemove(1)},preQuestStart:function(a){var b=this,c=$(a.currentTarget),d=c.data("event-type");2===+d?this.returnPoint="3":this.returnPoint=null,this.getQuestInitList(function(){c.hasClass("pair-quest")?(b.listenToOnce(b,b.CLOSE_PAIR_QUEST_TRIGGER,function(){b.popStageDetail()}),b.getPairQuest(a)):c.hasClass("use-treasure")?b.questTreasureRaid(a):c.hasClass("ico-clear")===!0?(b.collectItemQuestId=c.data("quest-id"),b.clearedEpisode(a)):b.questRestartListTouch(a)},a)},getQuestInitList:function(a,b){var c=this;if(!this.questListInitModel){var d=$(b.currentTarget).data("type");this.init(d)}Game.loading.xhrStart(),this.questListInitModel.fetch().done(function(b){c.isProgress=b.is_progress,c.progressQuestidsArr=b.progress_quest_ids,c.location_id=b.location_id,c.canMultiBattle=b.can_multi_battle,c.isSceneSkipFlg=b.is_scene_skip_flg,Game.loading.xhrEnd(),a()})},getListContent:function(){},render:function(){},canvasRender:function(){},after_initialize:function(){},renderIndex:function(){},_showTutorialMoviePopup:function(){},initMove:function(){},initMoves:function(){},renderQuestList:function(){},renderDeck:function(){},skipSetting:function(){},skipSettingResult:function(){},btnRecordOpen:function(){},btnRecordClose:function(){},questDisable:function(){},limitOver:function(){}});return f});
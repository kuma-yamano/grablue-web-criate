define(["model/manifest-loader","model/cjs-loader"],function(a,b){var c="prt-mask-cjs",d="cjs-npc_get",e={width:640,height:960},f=12,g="cjs_exportRoot_npc_get",h="npc_get_master_story",i="cjs_stage_npc_get_master_story",j="npc_get_quest",k="cjs_stage_npc_get_quest",l={GET_MASTER:"npc_get_master",NOPRAISE:"npc_get_master_nopraise",ARCARUM:"npc_get_arcarum"},m={NOPRAISE:"cjs_stage_npc_get_master_nopraise",ARCARUM:"cjs_stage_npc_get_arcarum"},n="npc_get_master",o={npc_get_3030108000_story:{stageName:"cjs_stage_npc_get_3030108000_story",manifestType:1}},p={setParams:function(a){this.message=a.message,this.isSideStoryTemporary=a.isSideStoryTemporary||!1,this.isExclusive=!1;var b=this.message.get_voice;if(this.isSideStoryTemporary===!0)_.isEmpty(this.message.join_cjs)===!1?(this.cjsFileName=this.message.join_cjs,this.isExclusive=!0,this.stageName=o[this.cjsFileName].stageName):(this.cjsFileName=h,this.stageName=i,this.eventImageFileBaseChar=this.eventImageFileBaseText=this.cjsFileName+"_"+a.story_id,_.isUndefined(this.message.chara_id)||(this.eventImageFileBaseChar+="_"+this.message.chara_id));else if(_.isEmpty(this.message.join_cjs)===!1)switch(this.cjsFileName=this.message.join_cjs,this.cjsFileName){case j:this.stageName=k,this.eventImageFileBaseChar=n+"_"+this.message.chara_id;break;case l.NOPRAISE:this.stageName=m.NOPRAISE;var c=l.GET_MASTER+"_"+a.event_id;this.eventImageFileBaseChar=c,this.eventImageFileBaseText=c;break;case l.ARCARUM:this.stageName=m.ARCARUM,this.joinNpcId=a.message.chara_id}this.cjsFileName!==l.ARCARUM&&(b="voice/"+b),window.npc_get_voice=b,window.npc_get_text1=this.message[0]||"",window.npc_get_text2=this.message[1]||"",window[this.stageName]&&(window[this.stageName].removeAllChildren(),createjs.Ticker.removeEventListener("tick",window[this.stageName])),this.setCanvas()},setCanvas:function(){var a=document.getElementById(d);a.width=e.width,a.height=e.height,window[this.stageName]=new createjs.Stage(a),createjs.MotionGuidePlugin.install(),this.loadCjs()},loadCjs:function(){var a=[this.cjsFileName],c=this;b.once("complete",function(){c.loadManifest(a)}),b.loadFiles(a)},loadManifest:function(c){var d=this,e=[];if(this.isSideStoryTemporary===!0)this.isExclusive===!0?1===o[this.cjsFileName].manifestType&&(e=_.flatten(_.map(c,function(a){return b.manifest(a)}))):e=[{src:Game.imgUri+"/sp/cjs/npc_get_master_story.png",id:"npc_get_master_story",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_story_bg2.jpg",id:"npc_get_master_story_bg2",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_story_txt_bg.jpg",id:"npc_get_master_story_txt_bg",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char.png",id:"npc_get_master_story_char",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char_w.png",id:"npc_get_master_story_char_w",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseText+"_text1.png",id:"npc_get_master_story_text1",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_story_text2.png",id:"npc_get_master_story_text2",type:"image"}];else switch(this.cjsFileName){case j:e=[{src:Game.imgUri+"/sp/cjs/npc_get_quest.png",id:"npc_get_quest",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_quest_bg2.jpg",id:"npc_get_quest_bg2",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_quest_txt_bg.jpg",id:"npc_get_quest_txt_bg",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char.png",id:"npc_get_quest_char",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char_w.png",id:"npc_get_quest_char_w",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_quest_text3.png",id:"npc_get_quest_text3",type:"image"}];break;case l.NOPRAISE:e=[{src:Game.imgUri+"/sp/cjs/npc_get_master_nopraise.png",id:"npc_get_master_nopraise",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_nopraise_bg2.jpg",id:"npc_get_master_nopraise_bg2",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_nopraise_txt_bg.jpg",id:"npc_get_master_nopraise_txt_bg",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char.png",id:"npc_get_master_nopraise_char",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseChar+"_char_w.png",id:"npc_get_master_nopraise_char_w",type:"image"},{src:Game.imgUri+"/sp/cjs/"+this.eventImageFileBaseText+"_text1.png",id:"npc_get_master_nopraise_text1",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_master_text2.png",id:"npc_get_master_nopraise_text2",type:"image"}];break;case l.ARCARUM:e=[{src:Game.imgUri+"/sp/cjs/npc_get_arcarum.png",id:"npc_get_arcarum",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_arcarum_scene03_bg.jpg",id:"npc_get_arcarum_scene03_bg",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_arcarum_window.jpg",id:"npc_get_arcarum_window",type:"image"},{src:Game.imgUri+"/sp/cjs/npc_get_arcarum_"+this.joinNpcId+".png",id:"npc_get_arcarum_dummy",type:"image"}]}a.once("complete",function(){d.setContainer()}),a.loadManifest(e,!0)},setContainer:function(){var a=new createjs.Container;a.x=0,a.y=0,window[g]=new lib[this.cjsFileName],a.addChild(window[g]),window[this.stageName].addChild(a),this.hideChat(),this.playThis()},playThis:function(){var a=this,b=$("#"+d),e=$("#"+c);b.trigger("readyNone"),e.addClass("show"),b.addClass("show"),createjs.Ticker.setFPS(f),createjs.Ticker.addEventListener("tick",window[this.stageName]),b.one("playEnd",function(){e.removeClass("show"),b.removeClass("show"),createjs.Ticker.removeAllEventListeners("tick"),window[a.stageName].removeAllChildren(),window[g].removeAllChildren(),a.resolveChat(),$(this).trigger("completeCjsPlay")})},hideChat:function(){var a=$("#general-chat"),b=0;Game.setting.chat_mode!==b&&(a.css({display:"none"}),this.dfdChat=$.Deferred(),this.dfdChat.done(function(){a.css({display:"block"})}))},resolveChat:function(){_.isUndefined(this.dfdChat)===!1&&(this.dfdChat.resolve(),delete this.dfdChat)},destroy:function(){this.resolveChat()}};return p});
define(["backbone","model/content","view/content","view/popup","view/cjs/cjs-play","view/cjs/cjs_lb_classup_result","view/cjs/cjs-arcarum-result","view/common/_cjs_npc_get","view/cjs/cjs-hell_skip","view/common/auto_setting","view/common/evo_star","view/cjs/cjs-uncap-equipment_new","view/cjs/cjs-uncap-character_new","model/sound","model/data","model/token-data","lib/shellapp","constant","util/navigate","util/language-message"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=0,v=0,w=200,x=200,y="bgm/60_sf4collabo_mainmenu_a_01.mp3",z="se/journal_se.mp3",A="se/arcarum_strengthen_se_1.mp3",B="se/loginbonus_roulette_se_1.mp3",C="se/loginbonus_roulette_2018_se_1_3.mp3",D="se/raid_effect_def_up_se_1.mp3",E="se/arcarm_tp_recover.mp3",F="se/raid_appear_lastbattle_se_1.mp3",G={rp:"rankPointGaugeTimeout",jp:"jobPointGaugeTimeout",zp:"zenithPointGaugeTimeout",npc:"npcPointGaugeTimeout",npcLp:"npcLimitPointGaugeTimeout"},H={rp:"rankPointGaugeInterval",jp:"jobPointGaugeInterval",zp:"zenithPointGaugeInterval",npc:"npcPointGaugeInterval",npcLp:"npcLimitPointGaugeInterval"},I=5,J=100,K={1:"bgm/50_domination_disadvantage_00.mp3",2:"bgm/50_domination_disadvantage_02.mp3",3:"bgm/50_domination_disadvantage_04.mp3"},L=null,M=1,N=2,O=2;EVENT_TYPE={TREASURERAID:1,LIMITED:2,TEAMRAID:3,DUNGEON:4,ADVENT:5,BIOGRAPHY:6,SKY:7,MINI:8,ARCARUM:9,DEFENDORDER:10,SOLOTREASURE:11,SEASON:12,REVIVAL:13};var P={RANK_250_TREASURE_1:"151",RANK_250_TREASURE_2:"152",FOUR_SYMBOLS_PENDANT:"90001"},Q=[r.EVENT_TYPE.LIMITED,r.EVENT_TYPE.BIOGRAPHY],R=c.extend({CONST_REWARDS:"rewards",CONST_VALUES:"values",CONST_EVENT:"event",CONST_POPUP_DATA:"popup_data",CONST_PRESENT_FLAGS:"present_flgs",CONST_DUNGEON:"dungeon",CONST_APPEARANCE:"appearance",CONST_PRESENT_FLGS:"present_flgs",CONST_MBP_INFO:"mbp_info",CONST_DOP_INFO:"dop_info",CONST_STONE_INFO:"stone_info",CONST_ARCARUM_INFO:"arcarum_info",CONST_BOARD_INFO:"board_info",CONST_COMMU_POP_MESSAGE:"commu_pop_message",content_model:null,cjsResult:null,url_model:null,friend_model:null,event_bonus_check_flag:!0,get_suppression_check_flag:!0,get_score_check_flag:!0,item_check_flag:!0,special_item_check_flag:!0,plural_item_check_flag:!0,ability_check_flag:!0,max_evolution_check_flag:!0,max_evolution_check_weapon_flag:!0,max_evolution_check_summon_flag:!0,shouldCheckOpenHardPlus:!0,openFateCheckFlag:!0,openFatePopCnt:0,promotionUncappngPopCnt:0,promoteUncappingFlag:!0,cross_fate_check_flag:!0,open_next_fate_check_flag:!0,open_next_fate_pop_count:0,experience_check_flag:!0,friend_check_flag:!0,join_check_flag:!0,joinedNpcDataIndex:0,memorial_flag:!0,title_flag:!0,daily_mission_flag:!0,eventCoopReward:!0,eventCoopBoost:!0,appearance_flg:!0,commuPopMessageFlag:!0,treasureItemInfoFlag:!0,deal_check_flag:!0,adventProudFlag:!0,isCheckedTreasureraidDailyMission:!0,shouldCheckTeamraidBeginnerMission:!0,shouldCheckOpenSideStory:!0,shouldCheckGetStonePopup:!0,shouldCheckTrajectoryPopup:!0,popJournalData:null,popJournalIndex:0,popNewItemIndex:0,newItemList:[],controller:"result",navigate_dir:"result",pop_opened_flg:!1,rankup_pop_flg:!0,zc_pop_flg:!0,job_master_pop_flg:!0,job_ability_pop_flg:!0,isNpcRankup:!1,event_item_pop_flg:!0,npc_ability_pop_flg:!0,change_pop_count:0,isCheckedUsableZenithType:!1,exe_skip:!1,rate:0,postStatusConcurrent:3,isAcquireBoth:!1,bonus_value:0,isInEvent:!1,showZpGauge:!1,navigateToUnclaimedFlag:!1,isArcarumResult:!1,sidestoryOpenPopCount:0,popupStyleTypeClassName:"",subHandleQuestView:null,showRetryBtnFlg:!1,retryTapEvent:null,exPoseOpen:[],popExPoseOpenFlag:!1,redisplayHellAppearanceFlag:!1,showRecyclingItemFlag:!1,hellSkipCheckFlg:!0,hasAnyBattleRewards:!1,events:{"tap .btn-control, .lis-lead-prev":"displayControl","tap #cnt-result .btn-unclaimed":"navigateToUnclaimed","tap .prt-button-area .btn-control-arcade":"locationArcadeNext","tap .prt-button-area .btn-retry":"onTapRetryQuest","tap .btn-register":"btnBookmarkRegister","tap .pop-bookmark-register .btn-usual-ok":"btnBookmarkRegisterResult","tap .pop-bookmark-register .btn-usual-cancel":"popRemoveOrigin","tap .pop-bookmark-register-result .btn-usual-close":"popRemoveOrigin","tap .pop-exp .btn-usual-ok":"preparePopCharacterMessage","tap .pop-get-abilityitem .btn-usual-ok":"checkNextAbilityitem","tap .pop-character-message .btn-usual-ok":"checkNextCharacterMessage","tap .pop-player-up .btn-usual-ok":"popRemoveToSkip","tap .pop-zc-up .btn-usual-ok":"popRemoveToSkip","tap .pop-job-ability .btn-usual-ok":"popRemoveToSkip","tap .pop-trajectory-info .btn-usual-ok":"popRemoveToSkip","tap .pop-journal-update .btn-usual-ok":"popRemoveToSkip","tap .pop-job-master .btn-usual-ok":"zenith_open_pop","tap .pop-zenith-open .btn-usual-ok":"skin_open_pop","tap .pop-skin-open .btn-usual-ok":"popRemoveToSkip","tap .pop-event-item .btn-usual-ok":"popRemoveToSkip","tap .pop-get-stone-info .btn-usual-ok":"popRemoveToSkip","tap .pop-get-score .btn-usual-ok":"popRemoveToSkip","tap .pop-get-suppression .btn-usual-ok":"popRemoveToSkip","tap .pop-get-support-ability .btn-usual-ok":"npc_ability_change_pop","tap .skip-area":"skip_new","tap .pop-newitem .btn-usual-ok":"popRemoveToSkip","tap .pop-reward-item .btn-usual-ok":"popRemoveOnly","tap .pop-reward-ability .btn-usual-ok":"popRemoveOnly","tap .pop-reward-ability-change .btn-usual-ok":"popRemoveOnly","tap .pop-npc-join .btn-usual-ok":"popRemoveOnly","tap .pop-friend-request .btn-usual-ok":"friendRequest","tap .pop-friend-request .btn-usual-cancel":"popRemoveOnly","tap .pop-friend-lupi .btn-usual-ok":"popRemoveOnly","tap .pop-friend-sent .btn-usual-ok":"popRemoveOnly","tap .pop-friend-limit .btn-usual-ok":"popRemoveOnly","tap .pop-friend-complete .btn-usual-ok":"popRemoveOnly","tap .pop-reward-memorial .btn-usual-ok":"popRemoveOnly","tap .pop-notification-title .btn-usual-close":"popRemoveOnly","tap .pop-hell-appearance .btn-usual-close":"popRemoveHell","tap .pop-hell-appearance .btn-close-hell":"popRemoveHell","tap .pop-hell-appearance .btn-usual-next":"onPushHellStart","tap .pop-commu-message .btn-usual-ok":"locationEventTop","tap .pop-notification-title .btn-location-title":"location_title","tap .pop-mission-check .btn-usual-close":"popRemoveOnly","tap .pop-mission-check-treasureraid .btn-usual-close":"popRemoveOnly","tap .pop-open-sidestory .btn-usual-close":"popRemoveOnly","tap .pop-event-coop-reward .btn-usual-ok":"popRemoveOnly","tap .pop-event-coop-boost .btn-usual-ok":"popRemoveOnly","tap .pop-data-error .btn-usual-close":"popRemoveOrigin","tap .pop-treasure-item-info .btn-usual-ok":"popRemoveOnly","tap .pop-advent-proud-appearance .btn-usual-close":"popRemoveOnly","tap .pop-confirm-uncap .btn-confirm-uncap":"onConfirmUncap","tap .pop-exec-uncap .btn-usual-close":"onCloseExecUncap","tap .pop-exec-uncap .btn-exec-uncap":"onTapExecUncap","tap .pop-exec-uncap .btn-material":"onTapTreasureInUncapPU","tap .pop-pose-unlocked-detail .btn-usual-close":"popNextUncap","tap .btn-present":"locationPresent","tap .btn-reward":"locationReward","tap #btn-cjs-skip":"onTapBtnCjsSkip","tap .prt-item-list .lis-treasure:not('.disable, .btn-article')":"itemClick","tap .pop-reward-detail:not(.is-auto-setting):not('.uncap') .btn-usual-ok":"popRemoveOrigin","tap .pop-reward-detail.uncap .btn-usual-ok":"onCloseTreasureDetailPUInUncap","tap .prt-item-list .btn-article":"articleClick","skip #cjs-lp-rankup":"onSkipNpcRankup","playEnd #cjs-lp-rankup":"onPlayEndNpcRankup","tap .prt-button-area .btn-continue":"getSequenceraidPartyDetail","tap .prt-button-area .btn-retry-sequence":"locationSequenceraidSupporter","tap .btn-dungeon":"popDungeon","tap .pop-dungeon .btn-return":"popConfirmReturn","tap .pop-confirm-return .btn-usual-cancel":"popDungeon","tap .pop-confirm-return .quest-end":"dungeonReturn","tap .pop-dungeon .btn-go":"checkContinue","tap .pop-arcade-result .btn-usual-ok":"popRemoveBeforeExp","tap .pop-arcade-bonus .btn-usual-ok":"popRemoveBeforeExp","tap .location-href":"locationHref","tap .location-deal":"locationDeal","tap .cnt-auto-sell-reward-detail .btn-auto-sell-detail":"popAutoSellRewardList","tap .pop-auto-sell-reward-list .btn-usual-ok":"popRemoveOrigin","tap .cnt-auto-custom-reward-detail .btn-auto-custom-detail":"popAutoCustomRewardList","tap .pop-auto-custom-reward-list .btn-usual-ok":"popRemoveOrigin","tap .pop-reward-detail.is-auto-setting .btn-usual-close":"popRemoveSecond","tap .pop-ex-pose-open .btn-usual-close":"popRemoveExPose","tap .cnt-auto-recycle-reward .btn-auto-recycle-detail":"popAutoRecycleRewardList","tap .pop-auto-recycle-reward-list .btn-usual-ok":"popRemoveOrigin","tap #btn-auto-recycle-setting":"getAutoRecycleSetting","tap #auto_recycling_weapon_list":"changeRecycleSettingText","tap #auto_recycling_summon_list":"changeRecycleSettingText","tap .pop-auto-recycle-list-setting .btn-usual-ok":"setAutoRecycleListSetting","tap .pop-auto-recycle-list-setting .btn-usual-close":"popRemoveOrigin","tap .pop-auto-recycle-list-setting .btn-condition-setting":"popAutoRecycleSetting","tap .pop-auto-recycle-setting .btn-usual-ok":"setAutoRecycleSetting","tap .pop-auto-recycle-setting .btn-usual-cancel":"getAutoRecycleSetting","tap .pop-auto-recycle-setting .btn-recycle-weapon":"toggleRecycleSetting","tap .pop-auto-recycle-setting .btn-recycle-summon":"toggleRecycleSetting","tap .pop-auto-recycle-setting .btn-reset-setting":"resetRecycleItemSetting","tap .pop-rank-250-treasure .btn-usual-ok":"checkNextAbilityitem","tap .pop-rank-250-hint .btn-usual-ok":"checkNextAbilityitem","change #hell-skip-setting":"hellSkipSetting","tap .pop-hell-skip-progress .btn-usual-close":"removeHellSkipProgressPop"},initialize:function(a){if(this.content_bind(),this.param=null,this.isPlayingBgm=0,this.hellSkipSettingFlg=!1,this.newItemList=[],void 0!==a)if(a.sceneId)this.param={raid_id:null},this.content_model=new b({controller:this.controller,action:"stage_only",param:{scene_id:a.sceneId}});else{this.isPlayingBgm=a.isPlayingBgm||0;a.is_multi;this.param={raid_id:a.raid_id,speed:a.speed,is_multi:a.is_multi},this.isHellSkipResult=!!a.isHellSkipResult,1==a.is_multi&&(this.controller="resultmulti",this.navigate_dir="result_multi"),this.content_model=new b({controller:this.controller,action:"index",param:this.param})}else this.param={raid_id:null},this.content_model=new b({controller:this.controller,action:"stage_only"});this.listenToOnce(this.content_model,"change",this.pre_render),this.crossFateMessageCount=0;var c=null==this.param.raid_id?"/check_reward/":"/check_reward/"+this.param.raid_id,d=new(o.extend({urlRoot:Game.baseUri+this.controller+c}));this.listenToOnce(d,"change",this.locationJudge),d.fetch()},locationJudge:function(b){var c=b.toJSON();if(c.reward_flag)this.content_model.fetch();else if(this.content_close(),"undefined"!=typeof c.dungeon&&c.dungeon.result_dungeon)a.history.navigate("/result_dungeon/"+b.get("dungeon").raid_id,!0);else if(c.is_trial_battle)a.history.navigate("trial_battle/result/"+this.param.raid_id,!0);else if(c.url)s.hash(c.url,{refresh:!1});else{var d="/empty/"+this.param.raid_id;a.history.navigate(this.navigate_dir+d,!0)}},contents_comp:function(a){0==a.get("has_supporter")&&(this.friend_check_flag=!1);var b=this,c=Number(this.result_data.get(this.CONST_VALUES).get_exp.exp);this.result_data.get("character_message").common.length;if(this.isHellSkipResult){this.trigger("loadEnd");var d=$("#prt-mask-cjs");d.addClass("show");var e=new i(function(){b.setNamedTimeout("hellSkipResultCjs",function(){d.removeClass("show")},100)}),f=this.$el.find(".prt-hell-skip-result-cjs");f.addClass("show");var b=this;$("#cjs-hell-skip-result").one("playEnd",function(){e.remove(),f.removeClass("show"),b.gainExp()})}else if(this.result_data.get("is_arcade")){this.trigger("xhrStart");var g=function(){b.result_data.get("arcade").is_bonus?b.popArcadeBonus():b.popArcadeResult()};if(null!=this.result_data.get("arcade").next_raid_id){var h=new(p.extend({urlRoot:Game.baseUri+this.controller+"/continue_arcade"}));this.stopListening(h,"sync"),this.listenToOnce(h,"sync",g),h.set({raid_id:this.param.raid_id,next_raid_id:this.result_data.get("arcade").next_raid_id}),h.save()}else g()}else"undefined"!=typeof this.result_data.get(this.CONST_DUNGEON)?(this.gaugeDataSet(),this.pop_opened_flg=!1,this.trigger("loadEnd")):1>c?(this.zc_up_flag=!1,this.rankup_flg=!1,this.pop_opened_flg=!1,this.gotNoExpFlg=!0,this.preparePopAbilityitems(),this.trigger("loadEnd")):this.gainExp()},pre_render:function(){this.isStageOnly=null==this.param.raid_id;var a=this.isStageOnly?"/stage_only_data/":"/data/"+this.param.raid_id;this.result_data=new(p.extend({urlRoot:Game.baseUri+this.controller+a})),this.listenToOnce(this.result_data,"sync",this.render),this.result_data.save()},render:function(){var a=this,b=this.result_data.toJSON();if(this.resultJsonData=b,this.content_render(this.content_model),window.CreateJsShell&&q.isShellAppAndroid()&&1==Game.setting.cjs_mode)for(var c=this.el;c;c=c.parentElement)c.style.backgroundColor="";if(!this.result_data.get(this.CONST_POPUP_DATA).response)return this.popDataError(this.result_data.get(this.CONST_POPUP_DATA).status_code);var d=this.result_data.get(this.CONST_REWARDS).reward_list,e=this.result_data.get(this.CONST_REWARDS).lupi,f=this.result_data.get(this.CONST_REWARDS).article_list,g=this.result_data.get(this.CONST_POPUP_DATA).clear_reward.memorial,h=this.result_data.get(this.CONST_POPUP_DATA).supporter_user,i=this.result_data.get("advent_info"),k=this.result_data.get("survival_info"),l=this.result_data.get("bgm_setting"),m=b[this.CONST_POPUP_DATA].clear_reward.special_rewards,o=b[this.CONST_REWARDS],p=+b[this.CONST_VALUES].get_exp.exp;this.hasAnyBattleRewards=_.flatten(d).length>0||+e>0||p>0,this.hasAnyBattleRewards||(this.isPlayingBgm=1,this.blackenBG());var r=[{className:"auto-recycle-reward",value:o.auto_recycling_weapon_list},{className:"auto-recycle-reward",value:o.auto_recycling_summon_list},{className:"auto-sell-reward",value:o.auto_sell_list},{className:"auto-custom-reward",value:o.auto_custom_list}],s=!_.some(r,function(a){return!_.isEmpty(a.value)}),u=this.result_data.get(this.CONST_POPUP_DATA).popup_style_type||"";""===u||_.isNaN(+u)?""!==u&&(this.popupStyleTypeClassName=" pop-escort-"+u):this.popupStyleTypeClassName=" pop-season-event"+u;var v=this.result_data.get(this.CONST_REWARDS);if(this.sequencePointData=null,b[this.CONST_EVENT]&&b[this.CONST_EVENT].sequence_point&&(this.sequencePointData=b[this.CONST_EVENT].sequence_point,this.sequencePointData.totalFormatted=this.numberFormat(this.sequencePointData.total),this.sequencePointData.difficultyName=this.sequencePointData.limited_reward_type?t.getMessage("sequencequest_difficulty_"+this.sequencePointData.limited_reward_type):"",_.each(this.sequencePointData.detail,function(b){b.point=a.numberFormat(b.point)})),$(".cnt-treasure-contents").html(_.template($("#tpl-treasure-item").html(),{rewards:d,article_list:f,memorial:g,get_lupi:e,is_request:h.is_request,advent_info:i,survival_info:k,sequencePoint:this.sequencePointData,specialRewards:m,autoUseTreasureList:r,isAutoUseTreasureListEmpty:s})),this.autoSettingView&&this.autoSettingView.content_close(),this.autoSettingView=new j({pageType:O}),this.addSubView(this.autoSettingView),_.size(v.auto_sell_list)>0){var w=v.auto_sell_weapon_count,x=v.auto_sell_summon_count,z={autoSellWeaponCount:w,autoSellSummonCount:x,autoSellWeaponTxt:t.replaceMessage("result_auto_sell_1",{"%s":w},w),autoSellSummonTxt:t.replaceMessage("result_auto_sell_2",{"%s":x},x),autoSellSoldPrice:v.sold_price,isMoneyMax:v.is_money_max};this.$el.find(".cnt-auto-sell-reward-detail").html(_.template($("#tpl-auto-sell-reward").html(),z))}if(_.size(v.auto_custom_list)>0){var A=v.auto_custom_weapon_count,B={autoCustomWeaponTxt:t.replaceMessage("result_auto_sell_1",{"%s":A},A),getCustomPoint:v.auto_custom_info.get_custom_point,totalCustomPoint:v.auto_custom_info.total_custom_point,isCustomPointMax:v.auto_custom_info.is_custompoint_max};this.$el.find(".cnt-auto-custom-reward-detail").html(_.template($("#tpl-auto-custom-reward").html(),B))}var C=_.size(v.auto_recycling_weapon_list)>0,D=_.size(v.auto_recycling_summon_list)>0,E=v.is_recycling_item_weapon_max,F=v.is_recycling_item_summon_max,G=C===!0||E===!0,H=D===!0||F===!0;if(this.showRecyclingItemFlag=G===!0||H===!0,this.showRecyclingItemFlag===!0){var I=+v.converting_count_weapon,J=+v.converting_count_summon,L={name:v.recycling_item_weapon_name||"",itemId:v.recycling_item_weapon_id||0,isMax:E,maxExp:+v.recycling_item_weapon_max_exp||0,convertingExp:+v.converting_exp_weapon||0,accumulationExp:+v.recycling_item_weapon_accumulation_exp||0,getNumber:+v.recycling_item_weapon_get_number||0},M={name:v.recycling_item_summon_name||"",itemId:v.recycling_item_summon_id||0,isMax:F,maxExp:+v.recycling_item_summon_max_exp||0,convertingExp:+v.converting_exp_summon||0,accumulationExp:+v.recycling_item_summon_accumulation_exp||0,getNumber:+v.recycling_item_summon_get_number||0},N={weaponConvertingCount:I,summonConvertingCount:J,weaponText:t.replaceMessage("result_auto_recycle_1",{"%s":I},I),summonText:t.replaceMessage("result_auto_recycle_2",{"%s":J},J),recyclingItemWeapon:L,recyclingItemSummon:M,showRecyclingItemWeapon:G,showRecyclingItemSummon:H};this.$el.find(".cnt-auto-recycle-reward-detail").html(_.template($("#tpl-auto-recycle-reward").html(),N))}(_.size(v.auto_sell_list)>0||_.size(v.auto_custom_list)>0||C===!0||D===!0)&&this.$el.find(".cnt-get-treasure .txt-auto-settings-caution").css("display","block");var P=this.result_data.get(this.CONST_PRESENT_FLAGS);"undefined"!=typeof P&&P.all&&$(".prt-present-msg").html(t.getMessage("result_1")).css("display","block");var Q=this.result_data.get(this.CONST_VALUES).pc;Q.param.is_max&&Q.param.base.level==Q.param["new"].level&&$("#pc_param-level").append("(MAX)");var R=this.result_data.get(this.CONST_VALUES).npc;if(_.each(R,function(a,b){a.is_max&&a.base.level==a["new"].level&&("en"==Game.lang?$("#npc"+b+"-level").append('<div class="txt-level-max"></div>'):$("#npc"+b+"-level").append("(MAX)"))}),Q.job.is_max&&Number(Q.job.base.level)==Number(Q.job["new"].level)){var S=$(".prt-player-zp");S.find(".txt-player-current-zp").text(Q.job.zenith.before_lp),S.find(".prt-zp-gauge-inner").css("width",Q.job.zenith.before_exp_gauge+"%")}var T=null,U=0;for(var V in this.result_data.get("values").npc)"undefined"!=typeof this.result_data.get("values").npc[V].temporary_point&&(U=this.result_data.get("values").npc[V].temporary_point,T="plus",U+="%",$(".prt-temexp-"+V).html(_.template($("#tpl-temexp").html(),{color:T,temexp:U})));for(var V in this.result_data.get("values").summon)if("undefined"!=typeof this.result_data.get("values").summon[V].temporary_percentage){var W=this.result_data.get("values").summon[V].temporary_percentage+"%";$(".prt-temexp-summon").html(_.template($("#tpl-temexp").html(),{color:"plus",temexp:W}))}$(".do_event_sound").length>0&&(this.isInEvent=!0),this.isInEvent&&(K[1]=$(".do_event_sound.no1").val(),K[2]=$(".do_event_sound.no2").val(),K[3]=$(".do_event_sound.no3").val());var X=$("#cnt-result").data("do-wave")||0,Y=this.$el.find(".prt-result-head");"undefined"!=typeof this.result_data.get(this.CONST_DUNGEON)?(Y.removeClass("head-win").addClass("head-intermission"),$(".cnt-get-exp").css({display:"block"}),$(".cnt-get-exp .txt-rankpt-plus").html("+"+this.result_data.attributes.values.get_exp.exp),$(".cnt-get-exp .txt-exp-plus").html("+"+this.result_data.attributes.values.get_exp.job_exp),"undefined"==typeof window.dungeonTransition&&n.playResultBGM()):X&&X>=1&&3>=X?this.isInEvent&&null!=l.bgm?n.playBGM(l.bgm):n.playBGM(K[X]):(l||{}).is_change_bgm&&(1!=this.isPlayingBgm||Game.ua.isIOS&&Game.shellAppFlag)?n.playBGM(l.bgm):this.result_data.get("is_arcade")?n.playBGM(y):1!=this.isPlayingBgm&&n.playResultBGM();var Z=null;return b.treasurequest&&_.size(b.treasurequest)>0&&(Z=b.treasurequest,this.displayCollectItem(b.treasurequest)),this.setPopJournalData(this.result_data.get(this.CONST_POPUP_DATA)),this.setNewItemData(v),this.subHandleQuestView=null,_.isUndefined(b.retry_quest_info)===!1&&_.isNull(b.retry_quest_info)===!1?(this.showRetryBtnFlg=!0,this.setRetryQuestInfo(b.retry_quest_info,Z),_.isUndefined(b.appearance)===!1&&b.appearance&&(this.hellQuestType=b.appearance.quest_type,this.hellEventTitle=b.appearance.title)):_.isUndefined(b.appearance)===!1&&b.appearance&&require(["view/result/_sub_handle_quest"],function(c){a.hellQuestType=b.appearance.quest_type,a.hellEventTitle=b.appearance.title,a.subHandleQuestView=new c({questType:a.hellQuestType,collectItemData:null}),a.addSubView(a.subHandleQuestView)}),this.setOpenExPose(),this.contents_comp(this.result_data),this},blackenBG:function(){this.$el.find(".prt-result-cnt").css({display:"none"})},popGetScore:function(a){this.popView=new d({className:"pop-get-score",title:t.getMessage("get_score_1"),body:_.template($("#tpl-pop-get-score").html(),a),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.get_score_check_flag=!1},popArcadeResult:function(){var a=this.result_data.get("arcade"),b=$("#cnt-result").data("job-image"),c={userImage:b,enemyImage:a.boss_cjs,resultComment:a.message.win_comment},e=_.template($("#tpl-pop-arcade-result").html());this.popView=new d({className:"pop-arcade-result sf-result",title:"",body:e(c),flagBtnClose:0,flagBtnOk:1}),this.popView.render().popShow(1,50),this.trigger("xhrEnd")},popArcadeBonus:function(){var a=this.result_data.get("arcade"),b=$("#cnt-result").data("job-image"),c={userImage:b,bonusScore:{attack:a.score.attack,time:a.score.time,perfect:a.score.perfect,total:a.score.total,score:a.score.score}},e=_.template($("#tpl-pop-arcade-bonus").html());this.popView=new d({className:"pop-arcade-bonus sf-result",title:"",body:e(c),flagBtnClose:0,flagBtnOk:1}),this.popView.render().popShow(1,50),this.trigger("xhrEnd")},popDataError:function(a){var b=t.getMessage("result_2"),c=t.getMessage("result_3"),e=[0,1,0],f=null;switch(a){case this.postStatusConcurrent:b=t.getMessage("result_4"),c=t.getMessage("result_5"),e=[0,0,0],f='<div class="btn-usual-text location-href" data-location-href="mypage">'+t.getMessage("result_6")+"</div>"}this.popView=new d({className:"pop-data-error",title:b,body:c,flagBtnCancel:e[0],flagBtnClose:e[1],flagBtnOk:e[2]}),this.popView.render(),null!=f&&$(".pop-data-error .prt-popup-footer").append(f),this.popView.popShow(),this.trigger("loadEnd")},popRemoveToSkip:function(){this.popView&&this.popView.popRemove(),this.skip_new(10)},preparePopCharacterMessage:function(){this.characterMsgToShow=_.clone(this.result_data.get("character_message").common),this.checkNextCharacterMessage()},popCharacterMessage:function(){this.popView=new d({className:"pop-character-message",title:t.getMessage("result_aliza_1"),body:_.template($("#tpl-pop-character-message").html(),this.characterMsgToShow[0]),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow(),this.setNamedTimeout("result:get:charactermessage",function(){n.playSE("se/bingo_se_8.mp3")},250)},checkNextCharacterMessage:function(){this.popView&&this.popView.popRemove(),_.size(this.characterMsgToShow)>0?(this.popCharacterMessage(),this.characterMsgToShow.shift()):this.preparePopAbilityitems()},preparePopAbilityitems:function(){this.abilityitemsToShow=_.clone(this.result_data.get("character_message").ability_item_info),this.checkNextAbilityitem()},checkNextAbilityitem:function(){n.stopVoice(),this.popView&&this.popView.popRemove(),_.size(this.abilityitemsToShow)>0?(this.popGetAbilityitem(this.abilityitemsToShow[0]),this.abilityitemsToShow.shift()):this.result_data.attributes.character_message.treasure_flag_151?(this.popRank250Treasure({name:t.getMessage("rank_250_treasure_1"),itemId:P.RANK_250_TREASURE_1}),this.result_data.attributes.character_message.treasure_flag_151=!1,this.result_data.attributes.character_message.treasure_151_progress=!1):this.result_data.attributes.character_message.treasure_flag_152?(this.popRank250Treasure({name:t.getMessage("rank_250_treasure_2"),itemId:P.RANK_250_TREASURE_2}),this.result_data.attributes.character_message.treasure_flag_152=!1):this.result_data.attributes.character_message.treasure_151_progress?(this.popRank250Hint(),this.result_data.attributes.character_message.treasure_151_progress=!1):this.gotNoExpFlg?(this.exp_level_input(),this.skip_new(10)):this.prepareGauge()},popGetAbilityitem:function(a){var b;b=""!==a.popup_style_type?"pop-get-abilityitem pop-season-event"+a.popup_style_type:"pop-get-abilityitem",this.popView=new d({className:b,title:a.title,body:_.template($("#tpl-pop-get-abilityitem").html(),a),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),""===a.char_image&&this.popView.$el.find(".prt-msg-box").addClass("adjust"),this.popView.popShow(),""!==a.voice&&n.playVoice(a.voice),""!==a.se&&this.setNamedTimeout("result:get:abilityitem",function(){n.playSE(a.se)},250)},prepareGauge:function(){var a=this;this.setNamedTimeout("result:prepare:gauge",function(){a.gaugeDataSet(),a.pop_opened_flg=!1},200)},popRemoveOnly:function(a){this.popView.popRemove(),a&&a.type&&this.stopEventPropagation(a,!0),this.popup_check()||this.navigate()},popRemoveHell:function(){this.redisplayHellAppearanceFlag=!1,this.popRemoveOnly()},popRemoveOrigin:function(){this.popView.popRemove()},popRemoveSecond:function(){this.secondPopView&&(this.secondPopView.popRemove(1),this.popView.$el.find(".pop-usual").css("z-index",this.popZindexVal))},popRemoveBeforeExp:function(){this.popView&&this.popView.popRemove(),this.gainExp()},displayControl:function(a){this.navigateToUnclaimedFlag=!1,a!==!0&&(this.retryTapEvent=null),this.popup_check()||this.navigate()},onTapRetryQuest:function(a){this.retryTapEvent=a,this.displayControl(!0)},setRetryQuestInfo:function(a,b){var c=this,d={};require(["view/result/_sub_handle_quest"],function(d){c.subHandleQuestView=new d({questType:a.quest_type,collectItemData:b}),c.addSubView(c.subHandleQuestView)}),d={"data-chapter-id":a.chapter_id,"data-quest-id":a.quest_id,"data-type":a.quest_type,"data-chapter-name":a.chapter_name,"data-ap":a.action_point,"data-start-at-once":a.start_at_once,"data-retry-quest":1,"data-duplicate-key":1},this.$el.find(".prt-button-area").find(".btn-retry").attr(d)},setOpenExPose:function(){var a=this,b=[],c=this.result_data.get(this.CONST_POPUP_DATA).open_additional_pose;_.each(c,function(c){a.popExPoseOpenFlag===!1&&(a.popExPoseOpenFlag=!0),b.push(c)}),this.popExPoseOpenFlag===!0&&b.length>0&&(this.exPoseOpen=_.flatten(b))},btnBookmarkRegister:function(a){var b=$(a.currentTarget),c=b.data("chapter-name");this.bookmarkChapterId=b.data("chapter-id"),this.bookmarkLocationId=b.data("location-id"),this.bookmarkPageCount=+b.data("bookmark-count"),this.bookmarkPageMax=+b.data("bookmark-max-count"),5!==+this.bookmarkLocationId.length&&(this.bookmarkLocationId=this.bookmarkLocationId.toString().substr(0,5)),this.popBookmarkRegister(c)},popBookmarkRegister:function(a){var b=t.replaceMessage("bookmark_3",{"%s1":a,"%s2":this.bookmarkPageCount,"%s3":this.bookmarkPageMax}),c=1;this.bookmarkPageCount>=this.bookmarkPageMax&&(b=t.getMessage("bookmark_2"),c=0),this.popView=new d({className:"pop-bookmark-register",title:t.getMessage("bookmark_1"),body:b,flagBtnCancel:1,flagBtnOk:c}),this.popView.render().popShow()},btnBookmarkRegisterResult:function(){this.insertBookmarkQuest()},insertBookmarkQuest:function(){var a=new(p.extend({urlRoot:Game.baseUri+"rest/bookmark/insert_bookmark_quest"}));this.stopListening(a,"sync"),this.listenToOnce(a,"sync",this.renderInsertBookmarkQuest),a.set({location_id:+this.bookmarkLocationId,chapter_id:+this.bookmarkChapterId}),a.save()},renderInsertBookmarkQuest:function(a){var b=a.toJSON().result;b!==!1&&this.popBookmarkRegisterResult()},popBookmarkRegisterResult:function(){this.popView=new d({className:"pop-bookmark-register-result",title:t.getMessage("bookmark_1"),body:t.replaceMessage("bookmark_4",{"%s1":this.bookmarkPageCount+1,"%s2":this.bookmarkPageMax}),flagBtnClose:1,flagBtnOk:0}),this.popView.render().popShow(),this.$el.find(".btn-register").css("display","none")},navigateToUnclaimed:function(){this.navigateToUnclaimedFlag=!0,this.retryTapEvent=null,this.popup_check()||this.navigate()},playerLevelUp:function(){$(".cnt-result").hasClass("skip-area")&&$(".cnt-result").removeClass("skip-area");var a=this.result_data.get(this.CONST_VALUES).pc_levelup,b=this.result_data.get(this.CONST_VALUES).pc,c=(b.param.base.level,b.param["new"].level,this.result_data.get(this.CONST_VALUES).pc.param.base),e=this.result_data.get(this.CONST_VALUES).pc.param["new"],f={name:a.name,is_levelup:a.is_levelup,baseActionpoint:c.action_point,newActionpoint:e.action_point,baseFriend:c.max_friend_number,newFriend:e.max_friend_number,base_rank:c.level,new_rank:e.level,baseJobpoint:c.job_point,newJobpoint:e.job_point,baseHp:c.hp,newHp:e.hp};f.is_levelup&&(this.popView=new d({className:"pop-player-up",title:t.getMessage("result_14"),body:_.template($("#tpl-pop-player").html(),f),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playRankUpSE()}}),this.popView.render(),this.popView.popShow()),this.rankup_pop_flg=!1},popZenithBonusOpen:function(a){var b=this,c=_.size(a),e=0,f=function(e){b.popView=new d({className:"pop-zenith-bonus-open",title:t.getMessage("result_zenith_1"),body:_.template($("#tpl-pop-zenith-bonus-open").html(),a[e]),flagBtnClose:1}),b.popView.render().popShow(),b.listenToOnce(b.popView,"close",function(){b.popView.popRemove(),e++,e===+c?(b.isCheckedUsableZenithType=!0,b.skip_new(10)):f(e)})};f(e)},popZcUp:function(){var a=this.result_data.get(this.CONST_VALUES).pc,b=a.param.zenith_class_up,c={base_class:b.before_class,new_class:b.after_class,base_cost:b.before_cost,new_cost:b.after_cost};this.popView=new d({className:"pop-zc-up",title:t.getMessage("result_15"),body:_.template($("#tpl-pop-zc-up").html(),c),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.zc_pop_flg=!1},gainExp:function(){if(this.pop_opened_flg)return!1;this.pop_opened_flg=!0;var a=this.result_data.toJSON(),b=a[this.CONST_VALUES].get_exp,c=a[this.CONST_ARCARUM_INFO],e={isSoloTreasure:a.is_solotreasure,eventData:a.event.data},f={rankpt:b.exp,exppt:b.job_exp,temexppt:b.temporary_point,temexpNames:b.temporary_npc_names,summonTemexppt:b.summon_temporary_point,summonTemexpName:b.summon_temporary_name,weaponTemexpName:b.temporary_weapon_name,experience_point:b.experience_point,progress_pt:b.progress_point,complete_progress_pt:b.complete_progress_point,exp_bonus:b.exp_bonus,job_exp_bonus:b.job_exp_bonus,host_exp_bonus:b.host_exp_bonus,host_job_exp_bonus:b.host_job_exp_bonus,pp:b.pp,hint_pt:b.hint_point,soloTreasureData:e,isSidestory:a.is_story_contribution||!1,sidestoryData:a.story_contribution||{},arcarumInfo:c,expSoloBonus:b.exp_solo_bonus,jobExpSoloBonus:b.job_exp_solo_bonus,commuGaugePoint:b.commu_gauge_point,passportGaugePoint:b.passport_gauge_point,passportNum:b.passport_num,isMaxPassport:b.is_max_passport||!1,isAddPassport:b.is_add_passport||!1,sequencePoint:this.sequencePointData},g=this.result_data.get(this.CONST_MBP_INFO)||null;null===g||1>g.length?g={hasMbp:!1}:(g.hasMbp=!0,g.hasArticleRemain=_.some(g.article_remain,function(a){return a.remain>0})),f.mbpInfo=g;var h=this.result_data.get(this.CONST_DOP_INFO)||[];0<_.size(h)?f.defendPointData=h:f.defendPointData={number:0,is_max:!1};var i=null;null!==this.sequencePointData&&(i=function(){n.playSE(E)}),this.popView=new d({className:"pop-exp",title:t.getMessage("result_16"),body:_.template($("#tpl-pop-exp").html(),f),flagBtnCancel:0,flagBtnOk:1,showEndCallback:i}),this.popView.render(),this.popView.popShow(),this.trigger("loadEnd")},itemClick:function(a){if(this.pop_opened_flg)return!1;this.pop_opened_flg=!0;var b=$(a.currentTarget),c=b.data("box"),d=b.data("key");this.bonus_value=b.data("bonus")&&b.data("bonus")>0?b.data("bonus"):0,this.autoSellRewardFlg=!1,this.autoCustomRewardFlg=!1,this.autoRecycleRewardFlg=!1,this.isAutoUseTreasure=!1;var e;b.hasClass("auto-sell-reward")?(this.autoSellRewardFlg=!0,e=this.result_data.get(this.CONST_REWARDS).auto_sell_list[c][d]):b.hasClass("auto-custom-reward")?(this.autoCustomRewardFlg=!0,
e=this.result_data.get(this.CONST_REWARDS).auto_custom_list[c][d]):b.hasClass("auto-recycle-reward")===!0?(this.autoRecycleRewardFlg=!0,e=2===+d.slice(0,1)?this.result_data.get(this.CONST_REWARDS).auto_recycling_summon_list[c][d]:this.result_data.get(this.CONST_REWARDS).auto_recycling_weapon_list[c][d]):e=this.result_data.get(this.CONST_REWARDS).reward_list[c][d],b.hasClass("btn-auto-use-treasure")&&(this.isAutoUseTreasure=!0);var f=[7,22,26,27,28,63,79,80,81,82];return _.contains(f,+e.item_kind)===!0||43===+e.item_kind&&7===+e.id?void(this.pop_opened_flg=!1):($("#loading").css("display","block"),this.itemDetailKind=e.item_kind,void this.getDetail(e.id))},onTapTreasureInUncapPU:function(a){var b=$(a.currentTarget).data("key"),c=this.evolutionRequirementModel.toJSON().evolution_requirements_info.requirements[b];this.itemDetailKind=c.item_kind.id,this.getDetail(c.item_id,"uncap")},articleClick:function(a){if(this.pop_opened_flg)return!1;this.pop_opened_flg=!0,$("#loading").css("display","block");var b=$(a.currentTarget),c=b.data("index"),d=this.result_data.get(this.CONST_REWARDS).article_list[c];this.itemDetailKind=d.kind,this.getDetail(d.id)},getDetail:function(a,b){var c=this,d="tutorial"===this.controller?"rest/tutorial":this.controller,e=new(p.extend({urlRoot:Game.baseUri+d+"/detail"}));this.listenToOnce(e,"sync",function(a){c.popRewardDetail(a,b)}),e.set({item_id:a,item_kind:this.itemDetailKind}).save()},popRewardDetail:function(a,b){var c=a.toJSON().data,e=null;if("weapon"==c.type){var f=null==c.skill1?null:c.skill1.name,g=null==c.skill2?null:c.skill2.name,h=null==c.skill3?null:c.skill3.name,i=null==c.skill1?null:+c.skill1.masterable_level,j=null==c.skill2?null:+c.skill2.masterable_level,k=null==c.skill3?null:+c.skill3.masterable_level;e={name:c.name,rarity:c.rarity,hp:c.default_hp,atk:c.default_attack,special:c.special_skill.name,skill_1:f,skill_2:g,skill_3:h,skill_1_masterable_level:i,skill_2_masterable_level:j,skill_3_masterable_level:k,bonus:this.bonus_value}}else if("summon"==c.type){var f=null==c.skill1?null:c.skill1.name;e={name:c.name,rarity:c.rarity,hp:c.default_hp,atk:c.default_attack,special:c.special_skill.name,skill_1:f,bonus:this.bonus_value}}else e="item/article"==c.type?{name:c.name,comment:c.comment,id:c.id,kind:this.itemDetailKind,disable:c.disable,unique_article_id:c.unique_article_id}:{name:c.name,comment:c.comment};var l,m={type:c.type,id:c.id,detail:e};if(this.isAutoUseTreasure||!this.autoSellRewardFlg&&!this.autoCustomRewardFlg&&this.autoRecycleRewardFlg!==!0){var n="pop-reward-detail";_.isString(b)?(n+=" "+b,l=t.getMessage("result_uncap_treasure_pu_title")):l=t.getMessage("result_23"),this.popView=new d({className:n,title:l,body:_.template($("#tpl-reward-detail").html(),m),flagBtnClose:0,flagBtnOk:1,btnTreasure:1,treasureId:Game.footer&&Game.footer.mainView.validateTreasure(m.detail),treasureName:e.name}),this.popView.render().popShow()}else l=this.autoSellRewardFlg?t.getMessage("result_auto_sell_4"):this.autoCustomRewardFlg?t.getMessage("result_auto_custom_2"):t.getMessage("result_auto_recycle_4"),this.secondPopView=new d({el:"#pop-second",className:"pop-reward-detail is-auto-setting",title:l,body:_.template($("#tpl-reward-detail").html(),m),flagBtnClose:1,flagBtnOk:0}),this.changeMaskZindexVal(this.popView.$el.find(".pop-usual")),this.secondPopView.render().popShow();$("#loading").css("display","none"),this.pop_opened_flg=!1},onCloseTreasureDetailPUInUncap:function(){this.popView&&this.popView.popDelete(),this.popUncapExec()},job_master_pop:function(a,b){var c={};_.each(b,function(a,b){var d='<span class="txt-name">'+a.name+"</span>+"+a.param_max;1===+a.is_percent_master&&(d+="%"),c[b]={master_bonus_name:d,master_bonus_kind:a.kind}}),this.popView=new d({className:"pop-job-master",title:t.getMessage("result_24"),body:_.template($("#tpl-pop-jobmaster").html(),{job_name:a,data:c}),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.master_job_name=a},zenith_open_pop:function(){this.popRemoveOrigin(),this.popView=new d({className:"pop-zenith-open",title:t.getMessage("result_25"),body:_.template($("#tpl-zenith-first-time").html(),{jobName:this.master_job_name}),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.job_master_pop_flg=!1},skin_open_pop:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).skin_num;if(a>1){var b=this.master_job_name+t.getMessage("result_26")+t.getMessage("result_27")+t.getMessage("result_28");this.popRemoveOrigin(),this.popView=new d({className:"pop-skin-open",title:t.getMessage("result_29"),body:b,flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow()}else this.popRemoveToSkip()},player_ability_pop:function(a,b,c){var e={job_name:a,ability_name:b,ability_acquire_img:c};this.popView=new d({className:"pop-job-ability",title:t.getMessage("result_30"),body:_.template($("#tpl-pop-jobability").html(),e),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.job_ability_pop_flg=!1},npcRankup:function(){if(!this.isNpcRankup){this.isNpcRankup=!0;var a=this.npcRankupList[0],b=("00"+a.base.rank).slice(-3).split(""),c=("00"+a["new"].rank).slice(-3).split(""),d=b.reverse().concat(c.reverse()),e=$("#tpl-animation").html();window.scrollTo(0,1);var g=this.$el.find(".cnt-result");g.append(e),this.cjsRankup=new f({npcImgId:a.npc_img,npcVoice:a.lp_rankup_voice,npcRankArray:d}),this.cjsRankup.render()}},onSkipNpcRankup:function(){this.$el.find(".onm-anim-parts").find(".onm-anim-mask").css({animation:"none","-webkit-animation":"none",opacity:1,display:"block"})},onPlayEndNpcRankup:function(){var a=this,b=this.$el.find(".onm-anim-parts"),c=200;b.oneAnimationEnd(function(){a.isNpcRankup!==!1&&(a.cjsRankup.removeEvent(),a.cjsRankup.removeChildren(),a.cjsRankup.destroy(),b.remove(),a.npcRankupList.shift(),a.isNpcRankup=!1,a.skip_new(10))},c).addClass("onm-anim-fadeout")},event_item_pop:function(a){var b=0,c=this.result_data.toJSON(),e={default_point:0,is_over_limit:!1},f=c[this.CONST_POPUP_DATA].daily_mission||null,g=!!f&&+f.num===+f.max_num,h=c[this.CONST_POPUP_DATA].clear_reward.special_rewards;"undefined"!=typeof c.advent_info&&(e=c.advent_info);var i={advent:{isWithInPeriod:e&&(e.default_point>0||e.is_over_limit),isOverLimit:e.is_over_limit,isOrdealQuest:e.is_ordeal_quest,defaultPoint:+e.default_point},soloTreasure:{isWithInPeriod:c.is_solotreasure||!1,isFinished:c.event.data[0].solotreasure_finished||!1,isExtraQuest:"undefined"==typeof c.quest_type||5===+c.quest_type}},j=i.advent,k=i.soloTreasure;if(_.each(a,function(a){a.get_num>0&&(b=1)}),k.isWithInPeriod&&(b=0,k.isFinished&&k.isExtraQuest&&(b=1)),j.isWithInPeriod&&j.isOverLimit&&(b=1),(j.isOrdealQuest||j.isOverLimit&&g||_.findWhere(h,{item_id:P.FOUR_SYMBOLS_PENDANT})&&0===j.defaultPoint)&&(b=0),1==b){var l={item:a,adventData:j,isSoloTreasureFinished:c.event.data[0].solotreasure_finished};this.popView=new d({className:"pop-event-item",title:t.getMessage("result_31"),body:_.template($("#tpl-pop-eventbonus").html(),l),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),this.event_item_pop_flg=!1}else this.event_item_pop_flg=!1,this.skip_new(10)},popEventBonus:function(a){var b=this.result_data.get("advent_info");a.item_dir="event/defeat/copper",a.item_image="5001",a.item_name=t.getMessage("result_32"),a.is_advent=b&&(b.default_point>0||b.is_over_limit),a.is_over_limit=b.is_over_limit,this.popView=new d({className:"pop-event-item",title:t.getMessage("result_33"),body:_.template($("#tpl-event-rate").html(),a),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playGetTreasureSE()}}),this.popView.render(),this.popView.popShow(),this.event_bonus_check_flag=!1},popGetStoneInfo:function(a){this.popView=new d({className:"pop-get-stone-info",title:t.getMessage("result_get_stone_title"),body:_.template($("#tpl-pop-get-stone-info").html(),{num:a}),flagBtnOk:1}),this.popView.render().popShow(),this.shouldCheckGetStonePopup=!1},npc_ability_change_pop:function(){var a=this;if(this.popView&&this.popView.popRemove(),this.change_pop_count>=this.npc_count_data)return this.npc_ability_pop_flg=!1,this.skip_new(10);var b=this.ability_change_data[this.change_pop_count];if(b.is_change||b.is_support_acquire||b.is_acquire){if(b.is_change&&!this.isAcquireBoth){var c=0,e=function(f){var g={npc_name:b.name,npc_image:b.image,before_ability_name:f.ability_change_before,after_ability_name:f.ability_change_after,after_ability_image:f.ability_change_after_img};a.popView=new d({className:"pop-npc-change-ability",title:t.getMessage("result_35"),body:_.template($("#tpl-pop-change-ability").html(),g),flagBtnCancel:0,flagBtnOk:1}),a.popView.render().popShow(),a.$el.find(".pop-npc-change-ability .btn-usual-ok").on("tap",function(){$(this).off(),c++,c<b.ability_change.length?e(b.ability_change[c]):(b.is_support_acquire?a.isAcquireBoth=!0:a.change_pop_count++,a.npc_ability_change_pop())})};e(b.ability_change[c])}else if(b.is_acquire&&!this.isAcquireBoth){var f=0,g=function(c){var e={npcId_image:b.image,npcName:b.name,ability_img:c.ability_acquire_img,abilityName:c.ability_acquire};a.popView=new d({className:"pop-get-ability",title:t.getMessage("result_36"),body:_.template($("#tpl-pop-ability").html(),e),flagBtnCancel:0,flagBtnOk:1}),a.popView.render().popShow(),a.$el.find(".pop-get-ability .btn-usual-ok").on("tap",function(){$(this).off(),f++,f<b.ability_acquire.length?g(b.ability_acquire[f]):(b.is_support_acquire?a.isAcquireBoth=!0:a.change_pop_count++,a.npc_ability_change_pop())})};g(b.ability_acquire[f])}else if(b.is_support_acquire){var h={npcId_image:b.image,npcName:b.name,ability_img:b.support_ability_acquire_img,abilityName:b.support_ability_acquire};this.popView=new d({className:"pop-get-support-ability",title:t.getMessage("result_37"),body:_.template($("#tpl-pop-support-ability").html(),h),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow(),this.change_pop_count++,this.isAcquireBoth=!1}return!1}return this.change_pop_count=this.change_pop_count+1,this.npc_ability_change_pop(),!1},popTrajectoryInfo:function(a){this.popView=new d({className:"pop-trajectory-info",title:t.getMessage("result_trajectory_title"),body:_.template($("#tpl-pop-trajectory-info").html(),a),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow(),this.shouldCheckTrajectoryPopup=!1},popHellAppearance:function(a){var b=this,c=this.result_data.get(this.CONST_APPEARANCE);if(void 0==c||c.length<1)return!1;this.redisplayHellAppearanceFlag=!0,a&&(this.hellSkipSettingFlg=!!+c.quest_skip.quest_skip_status);var e="angel-halo",f=_.template($("#tpl-angel-halo-hell").html()),g=1,h=null,i=null;if("undefined"!=typeof c.is_normal_hell&&0!==+c.is_normal_hell.type)switch(+c.is_normal_hell.type){case 1:e="angel-halo",f=_.template($("#tpl-angel-halo-hell").html())}else switch(c.hellSkipSettingFlg=this.hellSkipSettingFlg,c.selectHellEventTypes=Q,+c.event_type){case 1:e="treasureraid",f=_.template($("#tpl-event-hell").html());break;case 2:e="extra",f=_.template($("#tpl-event-hell").html()),i=function(){b.popView.$el.find(".prt-image").html(b.getHellImageHtml())};break;case 6:6013==c.event_id?(g="ja"===Game.lang?0:1,e="biography samurai",f=_.template($("#tpl-event-hell-samurai").html())):(e="biography",f=_.template($("#tpl-event-hell").html()),c.isChangeTitle=this.getIsHellPopChangeTitle(c.event_id),i=function(){b.popView.$el.find(".prt-image").html(b.getHellImageHtml())});break;case 11:e="solotreasure",f=_.template($("#tpl-event-hell").html());break;case r.EVENT_TYPE.ADVENT:e="advent",f=_.template($("#tpl-event-advent-boss").html()),h=t.getMessage("quest_135"),this.subHandleQuestView.treasureId=c.event_id}return this.popView=new d({className:"pop-hell-appearance "+e,title:h||t.getMessage("result_38"),body:f(c),showStartCallback:i,flagBtnClose:g,showEndCallback:function(){n.playSE(F)}}),this.popView.render().popShow(),6013==c.event_id&&"ja"===Game.lang&&this.popView.$el.find(".prt-popup-footer").append($("#tpl-pop-hell-samurai-button").html()),this.setHellAppearanceInfo(c),!0},getIsHellPopChangeTitle:function(a){return _.contains([6026],+a)},getHellImageHtml:function(){var a=this.resultJsonData[this.CONST_APPEARANCE];return _.template($("#tpl-event-hell-image").html(),{isSkip:this.hellSkipSettingFlg,eventId:a.event_id,eventType:a.event_type,eventName:a.event_name,chapterId:this.hellSkipSettingFlg?a.quest_skip.chapter_id:a.chapter_id})},setHellAppearanceInfo:function(a){this.listenToOnce(this.subHandleQuestView,"popRemoveRestart",this.redisplayHellAppearance);var b=!!+a.quest_skip.quest_skip_status,c=b?a.quest_skip.chapter_id:a.chapter_id,d=b?a.quest_skip.quest_id:a.quest_id,e={chapterId:c,questId:d,type:a.quest_type,chapterName:a.quest_name,eventId:a.event_id||"",eventType:a.event_type||"",groupId:a.group_id||"",ap:a.action_point||0};this.popView.$el.find(".prt-popup-footer").append(_.template($("#tpl-pop-hell-appearance-button").html(),e)),this.hellSkipSettingFlg===!0&&this.changeHellSkipOkBtnLabel()},redisplayHellAppearance:function(){this.redisplayHellAppearanceFlag===!0&&this.popHellAppearance(!1)},onPushHellStart:function(a){var b=$(a.currentTarget),c=+b.data("event-type"),d=null;if(this.subHandleQuestView.hellQuestType=this.hellQuestType,this.subHandleQuestView.hellEventTitle=this.hellEventTitle,!this.hellSkipSettingFlg&&_.contains(Q,c)){var e=b.data("event-id"),f=b.data("group-id");this.subHandleQuestView.getExtraEventDetailList(e,f)}else d=this.resultJsonData[this.CONST_APPEARANCE],d&&d.quest_skip&&d.quest_skip.is_quest_skip&&this.hellSkipSettingFlg?this.subHandleQuestView.processSkipHell(a,{questId:d.quest_skip.quest_id,questType:d.quest_type,eventName:d.event_name}):c!==r.EVENT_TYPE.ADVENT||_.isUndefined(d.hell_quest_list)?this.subHandleQuestView.checkNextPlay(a,!0):(this.subHandleQuestView.hellEventTitle=t.getMessage("ex_plus_group_title"),this.subHandleQuestView.popAdventHellDetail(d.hell_quest_list))},changeHellSkipOkBtnLabel:function(){var a=this.hellSkipSettingFlg?t.getMessage("hell_skip_button_1"):t.getMessage("hell_skip_button_2");this.popView.$el.find(".btn-usual-next").html(a)},hellSkipSetting:function(a){var b=this.resultJsonData[this.CONST_APPEARANCE];Game.loading.xhrStart();var c=$(a.currentTarget),d=$("#"+c.attr("for"));d.prop("disabled",!0),c.addClass("disabled");var e=new(p.extend({urlRoot:Game.baseUri+b.event_name+"/rest/quest/set_quest_skip_status"}));this.stopListening(e,"sync");var f=this;this.listenToOnce(e,"sync",function(a){f.hellSkipSettingFlg=!!a.attributes.status,f.changeHellSkipOkBtnLabel(),_.contains(Q,+b.event_type)&&f.popView.$el.find(".prt-image").html(f.getHellImageHtml()),d.prop("checked",this.hellSkipSettingFlg),c.removeClass("disabled"),d.prop("disabled",!1),Game.loading.xhrEnd()}),e.save({status:this.hellSkipSettingFlg?0:1})},popCommuMessage:function(){var a=this.result_data.get(this.CONST_COMMU_POP_MESSAGE),b="result_82";return _.isUndefined(a)||_.isEmpty(a)?!1:("treasureraid089"===a[0].event_name&&(b="result_commu_title_1"),this.popView=new d({className:"pop-commu-message",title:t.getMessage(b),body:_.template($("#tpl-pop-commu-message").html(),a[0]),flagBtnClose:0,flagBtnOk:1,showEndCallback:function(){n.playSE("se/itemget_01_se_1.mp3")}}),this.popView.render().popShow(),!0)},popTreasureItemInfo:function(){var a="pop-treasure-item-info",b=this.result_data.get("character_message").treasure_item_info;return _.isUndefined(b)||_.isEmpty(b)?!1:(""!==b.popup_style_type&&(a+=" pop-escort-"+b.popup_style_type),this.popView=new d({className:a,title:b.title,body:_.template($("#tpl-pop-get-abilityitem").html(),b),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),""===b.char_image&&this.popView.$el.find(".prt-msg-box").addClass("adjust"),this.popView.popShow(),""!==b.voice&&n.playVoice(b.voice),""!==b.se&&this.setNamedTimeout("result:get:abilityitem",function(){n.playSE(b.se)},250),!0)},locationEventTop:function(){var b=this.result_data.get(this.CONST_COMMU_POP_MESSAGE)[0];this.content_close(),a.history.navigate("event/"+b.event_name,!0)},setPopJournalData:function(a){var b=this;this.popJournalData=[],"undefined"!=typeof a.archive_story&&a.archive_story&&this.popJournalData.push(_.extend({type:1},a.archive_story)),"undefined"!=typeof a.archive_npc&&a.archive_npc&&_.each(a.archive_npc,function(a){b.popJournalData.push(_.extend({type:2},a))}),"undefined"!=typeof a.archive_topic&&a.archive_topic&&this.popJournalData.push({type:3,topic:a.archive_topic})},popJournalUpdate:function(a){this.popView&&this.popView.popRemove();var b={},c=1999999999;switch(b.type=+a.type,+a.type){case 1:default:b.isEvent=a.is_event===!0,b.title=a.title,b.chapterTitle=a.chapter_title,b.isSidestory=_.isUndefined(a.is_sidestory)===!1&&a.is_sidestory===!0,b.isArcarum=_.isUndefined(a.is_arcarum)===!1&&a.is_arcarum===!0,b.isFreeQuest=_.isUndefined(a.is_free_quest)===!1&&a.is_free_quest===!0;break;case 2:b.id=a.npc_id||c,b.name=a.npc_name||"";break;case 3:b.topic=a.topic||[]}this.popView=new d({className:"pop-journal-update"+this.popupStyleTypeClassName,title:t.getMessage("result_journal_update"),body:_.template($("#tpl-pop-journal-update").html(),b),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playSE(z)}}),this.popView.render().popShow()},setNewItemData:function(a){var b=this;_.each(a.new_item_list,function(a,c){_.each(a,function(a){b.newItemList.push(_.defaults(a,{kindName:c}))})})},popNewItem:function(a){var b=t.getMessage("result_17"),c=t.getMessage("result_18"),e=t.getMessage("result_19"),f=t.getMessage("result_19");"summon"==a.kindName&&(b=t.getMessage("result_20"),c=t.getMessage("result_21"),e="",f="");var g={kind_name:a.kindName,id:a.id,rarity:a.rarity,name:a.name,hp:a.hp,atk:a.attack,special:a.special_skill_name,skill_1:a.skill1_name,skill_2:a.skill2_name,skill_3:a.skill3_name,special_skill_label:b,skill_1_label:c,skill_2_label:e,skill_3_label:f,skill_1_masterable_level:a.skill1_masterable_level,skill_2_masterable_level:a.skill2_masterable_level,skill_3_masterable_level:a.skill3_masterable_level,type:a.type};this.popView=new d({className:"pop-newitem",title:t.getMessage("result_22"),body:_.template($("#tpl-pop-newitem").html(),g),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playGetTreasureSE()}}),this.popView.render().popShow()},gaugeDataSet:function(){this.popView&&this.popView.popRemove();var a=this.result_data.get(this.CONST_VALUES).pc,b=this.result_data.get(this.CONST_VALUES).npc,c=this;$(".cnt-result").addClass("skip-area"),this.RankGaugeDeferred=new $.Deferred,this.jobGaugeDeferred=new $.Deferred,this.npcGaugeDeferred=new $.Deferred,this.npcLpGaugeDeferred=new $.Deferred,$.when(this.RankGaugeDeferred,this.jobGaugeDeferred,this.npcGaugeDeferred,this.npcLpGaugeDeferred).done(function(){c.exe_skip!==!0&&c.skip_new(1e3)});var d=a.param["new"].level-a.param.base.level;if(this.gaugeRenderRank(a.param["new"].level,a.param.base.level,a.param["new"].exp_width,a.param.base.exp_width,d,a.param.is_max,0),a.param["new"].level>a.param.base.level){if(this.rankup_flg=!0,a.param.base.level<10&&a.param["new"].level>=10){var e=$("#wrapper, #submenu");e.find(".prt-global-coopraid").removeClass("disable"),e.find(".btn-global-coopraid").removeClass("disable")}a.param.zenith_class_up?this.zc_up_flag=!0:this.zc_up_flag=!1}if(a.job.is_max&&Number(a.job.base.level)==Number(a.job["new"].level))this.showZpGauge=!0,this.gaugeRenderZp(a.job.zenith.after_lp,a.job.zenith.before_lp,a.job.zenith.after_exp_gauge,a.job.zenith.before_exp_gauge,a.job.zenith.append_lp,a.job.zenith.is_max,0);else{var f=a.job["new"].level-a.job.base.level;this.gaugeRenderJob(a.job["new"].level,a.job.base.level,a.job["new"].exp_width,a.job.base.exp_width,f,a.job.is_max,0)}this.completeGaugeMoveCount=0,this.completeLpGaugeMoveCount=0,this.npcDataLength=_.size(b),this.npcRankupList=this.getNpcRankupList(b),this.npcDataLength>0?_.each(b,function(a,b){var d=a["new"].level-a.base.level;a.is_max_npczenith_point&&(a.base.lp_width_for_next_point=a["new"].lp_width_for_next_point=100,c.$el.find(".prt-party-npc .img-npc-point-max"+b).css("display","block"));var e=(+a["new"].rank-a.base.rank)*a.defined_remain_for_next_rank+ +a.base.remain_for_next_rank-a["new"].remain_for_next_rank;c.gaugeRenderNpc(a["new"].level,a.base.level,a["new"].exp_width,a.base.exp_width,d,a.is_max,0,b),c.gaugeRenderNpcLp(a["new"].remain_for_next_rank,a.base.remain_for_next_rank,a["new"].lp_width_for_next_point,a.base.lp_width_for_next_point,a.defined_remain_for_next_rank,e,0,b)}):(this.npcGaugeDeferred.resolve(),this.npcLpGaugeDeferred.resolve())},gaugeRenderRank:function(a,b,c,d,e,f,g){if(!this.exe_skip){var h=this,i=this.$el.find(".prt-party-player"),j=i.find(".txt-player-nextlv"),k=i.find(".img-rankup"),l=i.find(".txt-player-level"),m=i.find(".prt-exp-gauge-inner");if(e>=g){k.css("display","none"),l.hasClass("lvup")&&l.removeClass("lvup"),g>0?(m.css("width","0%"),d=0):m.css("width",d+"%");var n=100;g==e&&(n=c);var o=function(){if(e>0){if(g==e&&f)j.html("→MAX").addClass("max-color");else if(e>g){var i=Number(b)+Number(g)+1;j.html("→"+i)}k.css("display","block"),l.addClass("lvup")}h.gaugeRenderRank(a,b,c,d,e,f,g+1)},p=function(){h.setNamedTimeout(G.rp,function(){o()},J)};this.setGaugeMoveInterval(d,n,i.find(".prt-exp-gauge-inner-new"),"rp",!0,null,p)}else this.RankGaugeDeferred.resolve()}},gaugeRenderJob:function(a,b,c,d,e,f,g){if(!this.exe_skip){var h=this,i=this.$el.find(".prt-party-player"),j=i.find(".txt-player-nextjoblv"),k=i.find(".txt-player-joblevel"),l=i.find(".prt-jobexp-gauge-inner"),m=i.find(".img-job-levelup");if(e>=g){m.css("display","none"),k.hasClass("lvup")&&k.removeClass("lvup"),g>0?(l.css("width","0%"),d=0):l.css("width",d+"%");var n=100;g==e&&(n=c);var o=function(){if(e>0){if(g!=e||f){if(g==e)j.html("→MAX").addClass("max-color");else if(e>g){var i=Number(b)+Number(g)+1;j.html("→"+i)}h.playLevelUpSE()}else;m.css("display","block"),k.addClass("lvup")}h.gaugeRenderJob(a,b,c,d,e,f,g+1)},p=function(){h.setNamedTimeout(G.jp,function(){o()},J)};this.setGaugeMoveInterval(d,n,i.find(".prt-jobexp-gauge-inner-new"),"jp",!1,null,p)}else this.jobGaugeDeferred.resolve()}},gaugeRenderZp:function(a,b,c,d,e,f,g){if(!this.exe_skip){var h=this,i=this.$el.find(".prt-party-player"),j=i.find(".txt-player-next-zp"),k=i.find(".img-zp-get"),l=i.find(".txt-player-zp"),m=i.find(".prt-zp-gauge-inner");if(e>=g){k.css("display","none"),l.hasClass("lvup")&&l.removeClass("lvup"),g>0?(m.css("width","0%"),d=0):m.css("width",d+"%");var n=100;g==e&&(n=c);var o=function(){if(e>0){if(g!=e||f){if(g==e)j.html("→MAX").addClass("max-color");else if(e>g){var i=Number(b)+Number(g)+1;j.html("→"+i)}h.playGetLBSE()}else;k.css("display","block"),l.addClass("lvup")}h.gaugeRenderZp(a,b,c,d,e,f,g+1)},p=function(){h.setNamedTimeout(G.zp,function(){o()},J)};this.setGaugeMoveInterval(d,n,i.find(".prt-zp-gauge-inner-new"),"zp",!1,null,p)}else this.jobGaugeDeferred.resolve()}},gaugeRenderNpc:function(a,b,c,d,e,f,g,h){if(!this.exe_skip){var i=this,j=this.$el.find(".prt-party-npc"),k=j.find(".txt-npc-nextlv"+h),l=j.find(".img-npc-levelup"+h),m=$("#npc"+h);if(e>=g){l.css("display","none"),g>0?(m.css("width","0%"),d=0):m.css("width",d+"%");var n=100;g==e&&(n=c);var o=function(){if(e>0)if("none"==k.css("display")&&k.css("display","inline"),l.css("display","block"),g!=e||f){if(g==e&&f)k.html("→MAX").addClass("max-color");else if(e>g){var j=Number(b)+Number(g)+1;k.html("→"+j)}i.playLevelUpSE()}else;i.gaugeRenderNpc(a,b,c,d,e,f,g+1,h)},p=function(){i.setNamedTimeout(G.npc+h,function(){o()},J)};this.setGaugeMoveInterval(d,n,$("#npc"+h+"_new"),"npc",!1,h,p)}else this.completeGaugeMoveCount++,+this.npcDataLength===+this.completeGaugeMoveCount&&this.npcGaugeDeferred.resolve()}},gaugeRenderNpcLp:function(a,b,c,d,e,f,g,h){if(!this.exe_skip){var i=this;if(f>=g){var j=this.$el.find(".prt-party-npc .img-npc-pointup"+h),k=$(".prt-party-npc #npc-lp"+h);if(j.css("display","none"),g>0?(k.css("width",0),d=0):k.css("width",d+"%"),g==f)var l=c;else var l=100;var m=function(){f>0&&(j.css("display","block"),f>g&&i.playGetLBSE()),i.gaugeRenderNpcLp(a,b,c,d,e,f,g+1,h)},n=function(){i.setNamedTimeout(G.npcLp+h,function(){m()},J)};this.setGaugeMoveInterval(d,l,$("#npc-lp"+h+"-new"),"npcLp",!1,h,n)}else this.completeLpGaugeMoveCount++,+this.npcDataLength===+this.completeLpGaugeMoveCount&&this.npcLpGaugeDeferred.resolve()}},setGaugeMoveInterval:function(a,b,c,d,e,f,g){var h=this,i=_.clone(a),j=H[d];_.isNull(f)===!1&&(j=H[d]+f),this.setNamedInterval(j,function(){b>=i?(c.css("width",i+"%"),e===!0&&n.playExpGaugeSE(),i++):(g(),h.clearIntervalOne(j))},I)},getNpcRankupList:function(a){return _.filter(a,function(a){return+a["new"].rank-a.base.rank>0})},skip_new:function(a){this.exe_skip=!0,$(".cnt-result").hasClass("skip-area")&&($(".cnt-result").removeClass("skip-area"),this.exp_level_input());var a=a||10,b=this,c=this.result_data.toJSON(),d=this.result_data.get(this.CONST_POPUP_DATA);this.clearTimeoutOne("skipNewTimeout"),this.setNamedTimeout("skipNewTimeout",function(){if(b.rankup_flg&&b.rankup_pop_flg)return b.playerLevelUp(),!1;if(!b.isCheckedUsableZenithType){var a=d.usable_zenith_type||null;if(a&&0<_.size(a))return b.popZenithBonusOpen(a),!1;b.isCheckedUsableZenithType=!0}if(b.zc_up_flag&&b.zc_pop_flg)return b.popZcUp(),!1;var e=b.result_data.get(b.CONST_VALUES).pc_job_levelup;if(e.is_master&&b.job_master_pop_flg)return b.job_master_pop(e.name,e.master_bonus),!1;if(e.is_acquire&&b.job_ability_pop_flg)return b.player_ability_pop(e.name,e.ability_acquire,e.ability_acquire_img),!1;if("undefined"!=typeof b.npcRankupList&&b.npcRankupList.length>0)return void b.npcRankup();delete window.npcVoice;var f=b.result_data.get(b.CONST_EVENT);if(f.is_get&&b.event_item_pop_flg)return b.event_item_pop(f.data),!1;var f=b.result_data.get("advent_info");if("undefined"!=typeof f&&f.default_point>0&&b.event_bonus_check_flag)return b.popEventBonus(f),!1;var f=b.result_data.get("survival_info");if("undefined"!=typeof f&&f.score_point>=0&&b.get_score_check_flag)return b.popGetScore(f),b.$el.find(".cnt-get-treasure").children(".txt-treasure-title").text(t.getMessage("get_score_2")),!1;var g=b.result_data.get(b.CONST_STONE_INFO)||{};if(_.size(g)>0&&b.shouldCheckGetStonePopup)return b.popGetStoneInfo(g.amount),!1;if(b.openFateCheckFlag)return b.openFateCheckFlag=!1,b.popOpenFate(),!1;if(b.open_next_fate_check_flag)return b.open_next_fate_check_flag=!1,b.popOpenNextFate(),!1;if(b.npc_ability_pop_flg){var h=b.result_data.get(b.CONST_VALUES).npc_levelup;if(!h)return b.npc_ability_pop_flg=!1,b.skip_new(10),!1;var i=Object.keys(h).length,j=0;return _.each(h,function(a){(a.is_change||a.is_acquire||a.is_support_acquire)&&(j=1)}),1==j?(b.ability_change_data=h,b.npc_count_data=i,b.npc_ability_change_pop()):(b.npc_ability_pop_flg=!1,b.skip_new(10)),!1}if(b.popExPoseOpenFlag===!0)return b.popExPoseOpen(),!1;var k=b.result_data.get(b.CONST_ARCARUM_INFO)||b.result_data.get(b.CONST_BOARD_INFO);if("undefined"!=typeof k&&k.notice_effect&&b.isArcarumResult===!1)return b.arcarumResult(k),!1;if(b.shouldCheckTrajectoryPopup){var l={};if(l=b.isStageOnly?b.result_data.get(b.CONST_POPUP_DATA).cross_fate_bonus.trajectory:b.result_data.get(b.CONST_POPUP_DATA).trajectory,!_.isEmpty(l)&&l.is_trajectory)return b.popTrajectoryInfo(l),!1;b.shouldCheckTrajectoryPopup=!1}return b.popJournalData&&"undefined"!=typeof b.popJournalData[b.popJournalIndex]?(b.popJournalUpdate(b.popJournalData[b.popJournalIndex]),void b.popJournalIndex++):b.newItemList&&"undefined"!=typeof b.newItemList[b.popNewItemIndex]?(b.popNewItem(b.newItemList[b.popNewItemIndex]),void b.popNewItemIndex++):b.promoteUncappingFlag?(b.promoteUncappingFlag=!1,b.popConfirmUncap(),!1):b.hasAnyBattleRewards?(b.$el.find(".btn-control").css("display","block"),_.isNull(c.campaign_quest_comment)===!1&&b.$el.find(".prt-button-area.upper").addClass("has-notice-text").after(_.template($("#tpl-txt-notice-campaign-ap").html(),{comment:c.campaign_quest_comment})),1==b.$el.find(".btn-register").data("bookmark")&&b.$el.find(".btn-register").css("display","block"),"undefined"!=typeof b.result_data.get(b.CONST_DUNGEON)?(b.$el.find(".btn-control").css("display","none"),b.$el.find(".btn-register").css("display","none"),b.$el.find(".btn-dungeon").css("display","block")):b.result_data.get("is_arcade")&&null!=b.result_data.get("arcade").next_raid_id&&(b.$el.find(".prt-button-area .btn-control").css("display","none"),b.$el.find(".prt-button-area .btn-control-arcade").css("display","block")),b.result_data.get("has_not_receive_reward")&&!b.result_data.get(b.CONST_POPUP_DATA).deal?b.$el.find(".btn-unclaimed").addClass("active"):b.showRetryBtnFlg===!0?(b.showRetryBtnFlg=!1,b.$el.find(".prt-button-area").find(".btn-retry").css("display","block")):"undefined"!=typeof c.next_sequence_quest_info?b.$el.find(".btn-continue").css("display","block"):"undefined"!=typeof c.retry_sequence_quest_info&&b.$el.find(".btn-retry-sequence").css("display","block"),b.$el.find(".cnt-get-treasure").css("display","block"),_.size(b.result_data.get(b.CONST_REWARDS).auto_sell_list)>0&&b.$el.find(".cnt-auto-sell-reward").css("display","block"),_.size(b.result_data.get(b.CONST_REWARDS).auto_custom_list)>0&&b.$el.find(".cnt-auto-custom-reward").css("display","block"),void(b.showRecyclingItemFlag===!0&&b.$el.find(".cnt-auto-recycle-reward").css("display","block"))):void b.displayControl()},Number(a))},getSequenceraidPartyDetail:function(){var a=this,b=this.result_data.toJSON().next_sequence_quest_info;_.isUndefined(this.subHandleQuestSequenceraidView)?require(["view/result/_sub_handle_quest_sequenceraid"],function(c){a.subHandleQuestSequenceraidView=new c,a.addSubView(a.subHandleQuestSequenceraidView),a.stopListening(a.subHandleQuestSequenceraidView,"triggerDisplayControl"),a.listenToOnce(a.subHandleQuestSequenceraidView,"triggerDisplayControl",a.displayControl),a.subHandleQuestSequenceraidView.getSequenceraidPartyDetail(b)}):this.subHandleQuestSequenceraidView.getSequenceraidPartyDetail(b)},locationSequenceraidSupporter:function(){var a=this.result_data.toJSON();this.content_close(),s.hash("event/"+a.event.event_code+"/supporter/"+a.retry_sequence_quest_info.sequence_quest_id,{refresh:!1})},exp_level_input:function(){var a,b,c=this,d=this.$el.find(".txt-player-nextlv"),e=this.$el.find(".prt-exp-gauge-inner"),f=this.$el.find(".txt-player-nextjoblv"),g=this.$el.find(".prt-jobexp-gauge-inner"),h=this.$el.find(".txt-player-next-zp"),i=this.$el.find(".prt-zp-gauge-inner");this.clearIntervalAll(),this.clearTimeoutAll();var j=this.result_data.get(this.CONST_VALUES).pc;+j.param["new"].level>+j.param.base.level?(j.param.is_max?d.html("→MAX").addClass("max-color"):d.html("→"+j.param["new"].level),this.$el.find(".prt-rankup .img-rankup").css("display","block"),this.$el.find(".txt-player-level").addClass("lvup"),e.css("width","0%")):e.css("width",j.param.base.exp_width+"%"),this.$el.find(".prt-exp-gauge-inner-new").css("width",j.param["new"].exp_width+"%"),this.showZpGauge===!1?(+j.job["new"].level>+j.job.base.level?(j.job.is_max?f.html("→MAX").addClass("max-color"):f.html("→"+j.job["new"].level),this.$el.find(".prt-player-jobexp .img-job-levelup").css("display","block"),this.$el.find(".txt-player-joblevel").addClass("lvup"),g.css("width","0%")):g.css("width",j.job.base.exp_width+"%"),this.$el.find(".prt-jobexp-gauge-inner-new").css("width",j.job["new"].exp_width+"%")):(+j.job.zenith.after_lp>+j.job.zenith.before_lp?(j.job.zenith.is_max===!0?h.html("→MAX").addClass("max-color"):h.html("→"+j.job.zenith.after_lp),this.$el.find(".prt-player-zp .img-zp-get").css("display","block"),this.$el.find(".txt-player-zp").addClass("lvup"),i.css("width","0%")):i.css("width",j.job.zenith.before_exp_gauge+"%"),this.$el.find(".prt-zp-gauge-inner-new").css("width",j.job.zenith.after_exp_gauge+"%"));var k=this.result_data.get(this.CONST_VALUES).npc;_.each(k,function(d,e){if(d){a=c.$el.find(".txt-npc-nextlv"+e),b=$("#npc"+e),+d["new"].level>+d.base.level?(d.is_max?a.html("→MAX").show().addClass("max-color"):a.html("→"+d["new"].level).show(),
b.css("width","0%"),c.$el.find(".prt-party-npc .img-npc-levelup"+e).css("display","block")):b.css("width",d.base.exp_width+"%"),c.$el.find("#npc"+e+"_new").css("width",d["new"].exp_width+"%");var f=(+d["new"].rank-d.base.rank)*d.defined_remain_for_next_rank+ +d.base.remain_for_next_rank-d["new"].remain_for_next_rank,g=$("#npc-lp"+e);f>0?(g.css("width","0%"),c.$el.find(".prt-party-npc .img-npc-pointup"+e).css("display","block")):g.css("width",d.base.lp_width_for_next_point+"%"),c.$el.find("#npc-lp"+e+"-new").css("width",d["new"].lp_width_for_next_point+"%")}})},popRewardItemNormal:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).clear_reward.item;return this.popRewardItem(a,!0)},popRewardItemSpecial:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).clear_reward.special_item;return this.popRewardItem(a,!0)},popRewardItemPlural:function(){var a=this.result_data.get(this.CONST_POPUP_DATA),b=a.clear_reward.special_rewards,c=a.is_complete_clear;return this.popRewardItem(b,c)},_replaceExceptionNames:function(a){var b={"Sharom Pollen":"Sharom pollen","Sharom pollens":"Sharom pollens","Restless Klesha":"restless Klesha","Restless Kleshas":"restless Kleshas","Premium draw ticket":"Premium draw ticket","Handsome Gorilla TA":"Handsome Gorilla TA","Handsome Gorilla TAs":"Handsome Gorilla TAs","Halloween Character Weapon Draw Ticket":"Halloween character weapon draw ticket","Speaker's Bangle":"Speaker's bangle","Four Symbols Pendant":"Four Symbols pendant","Zhuque Seal":"Zhuque seal","Xuanwu Seal":"Xuanwu seal","Baihu Seal":"Baihu seal","Qinglong Seal":"Qinglong seal","Huanglong Omega Anima":"Huanglong omega anima","Qilin Omega Anima":"Qilin omega anima","AME Crystal":"AME crystal"},c={isException:!1,itemName:a};return _.has(b,a)===!0&&(c.itemName=b[a],c.isException=!0),c},popRewardItem:function(a,b){var c=this,e=[],f="",g=!1,h={},i=b===!1?"reward_pop_title_1":"result_39";if(Array.isArray(a)){if(!a||a.length<=0)return!1;a.forEach(function(a){"en"===Game.lang?(h=c._replaceExceptionNames(a.name),f=h.itemName,g=h.isException):(f=a.name,g=!1),e.push({is_item:a.is_item,itemType:a.type,itemId:a.item_id?a.item_id:"gem",itemName:a.item_id?t.pluralMessage(f,a.amount):f,count:a.amount,isException:g,countType:a.count_type,treasureraidContribution:a.treasureraid_contribution,specialRewardsComment:a.special_rewards_comment,isSendPresent:a.is_send_present})})}else{if(!a||!a.is_item)return!1;var j=[20011];g="en"===Game.lang&&("weapon"===a.type||"summon"===a.type||_.include(j,Number(a.id))),"en"===Game.lang&&(h=this._replaceExceptionNames(a.name),f=h.itemName,g=h.isException||g),e.push({is_item:a.is_item,itemType:a.type,itemId:a.id,itemName:f||a.name,count:a.amount,isException:g,countType:a.count_type,treasureraidContribution:a.treasureraid_contribution,isSendPresent:a.is_send_present})}var k=this.result_data.get("event"),l=(k?k.event_code:null)||null,m="advent"===l;return this.popView=new d({className:"pop-reward-item"+this.popupStyleTypeClassName,title:t.getMessage(i),body:_.template($("#tpl-pop-item").html(),{item:e,isStyleAdjust:m}),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playGetTreasureSE()}}),this.popView.render(),this.popView.popShow(),!0},popRewardAbility:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).npc_ability;if(!a.is_npc_ability)return!1;if(a.ability_levelup){var b={npc_name:a.name,npc_image:a.image_id,before_ability_name:a.before_ability_name,after_ability_name:a.ability_name,after_ability_image:a.ability_img_name};this.popView=new d({className:"pop-reward-ability-change",title:t.getMessage("result_40"),body:_.template($("#tpl-pop-change-ability").html(),b),flagBtnCancel:0,flagBtnOk:1})}else{var c={is_npc_ability:a.is_npc_ability,npcId:a.id,npcId_image:a.image_id,npcName:a.name,ability_img:a.ability_img_name,abilityName:a.ability_name};this.popView=new d({className:"pop-reward-ability",title:t.getMessage("result_41"),body:_.template($("#tpl-pop-ability").html(),c),flagBtnCancel:0,flagBtnOk:1})}return this.popView.render(),this.popView.popShow(),!0},popMaxEvolution:function(){var a=this.result_data.get(this.CONST_POPUP_DATA),b=a.npc_release_me,c=a.is_complete_clear,d=[];return b.is_release_me===!0?(d=b.list,this.renderPopMaxEvolution(d,0,"npc",c),!0):!1},popMaxEvolutionWeapon:function(){var a=this.result_data.get(this.CONST_POPUP_DATA),b=a.weapon_release_me,c=[];return b.is_release_me===!0?(c=b.list,this.renderPopMaxEvolution(c,0,"weapon",!0),!0):!1},popMaxEvolutionSummon:function(){var a=this.result_data.get(this.CONST_POPUP_DATA),b=a.summon_release_me,c=[];return b.is_release_me===!0?(c=b.list,this.renderPopMaxEvolution(c,0,"summon",!0),!0):!1},renderPopMaxEvolution:function(a,b,c,e){var f=a.length,g=a[b],h="result_42";switch(c){case"npc":g.name=g.npc_name,g.imageDir="npc/qm",e===!1&&(h="reward_pop_title_1");break;case"weapon":g.image_id=g.id,g.imageDir="weapon/m",1==g.evolution_type;break;case"summon":g.image_id=g.id,g.imageDir="summon/m",1==g.evolution_type}g.is_release_me=!0,g.Id=g.id,g.imageId=g.image_id,g.name=g.name,g.maxEvolution=g.max_evolution,g.imageDir=g.imageDir,g.evolution_type=g.evolution_type,g.type=c,this.popView=new d({className:"pop-reward-max-evolution",title:t.getMessage(h),body:_.template($("#tpl-pop-max-evolution").html(),g),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow();var i=this;this.popView.$el.find(".btn-usual-ok").on("tap",function(){var d=b+1;f>d?(i.popView.popRemove(),i.renderPopMaxEvolution(a,d,c)):i.popRemoveOnly(),$(this).off()})},popOpenHardPlus:function(){var a=this,b=this.result_data.get(this.CONST_POPUP_DATA).pair_quest;if(_.isEmpty(b)===!0)return!1;var c=new d({className:"pop-open-hard-plus",title:t.getMessage("result_39"),body:_.template($("#tpl-pop-open-hard-plus").html(),b),flagBtnCancel:0,flagBtnOk:1});return c.render().popShow(),this.listenToOnce(c,"ok",function(){a.popRemoveOnly()}),!0},popOpenFate:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).open_fate_episode;if("undefined"==typeof a||!a.do_open)return void this.popRemoveToSkip();var b=a.episode_list,c=b.length;if(c>0){var e=this.openFatePopCnt,f={npcIdImg:b[e].image_id,npcName:b[e].npc_name,type:b[e].fate_type};this.popView=new d({className:"pop-open-fate",title:t.getMessage("result_43"),body:_.template($("#tpl-pop-open-fate").html(),f),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow();var g=this;this.popView.$el.find(".btn-usual-ok").one("tap",function(){e+1>=c?g.popRemoveToSkip():(g.openFatePopCnt++,g.popOpenFate())})}else this.popRemoveToSkip()},popRewardCrossFate:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).cross_fate_bonus;if("undefined"==typeof a||!a.is_cross_fate_bonus)return!1;var b=[];if(_.each(a.bonus_contents,function(a,c){"ability"!=a.type&&b.push({type:a.type,character:a.character,kind:a.kind_name,percent:a.percent,value:a.value,ability:a.ability_name})}),!(b.length>0))return!1;var c=this.crossFateMessageCount;this.popCrossFate(b,c);var d=this;return this.popView.$el.find(".btn-usual-ok").on("tap",function(){return d.crossFateMessageCount>=b.length-1?(d.popView.popRemove(),!0):(d.crossFateMessageCount++,void d.popRewardCrossFate())}),!0},popCrossFate:function(a,b){var c={type:a[b].type,character:a[b].character,kind:a[b].kind,percent:a[b].percent,value:a[b].value,ability:a[b].ability};return this.popView=new d({className:"pop-reward-ability",title:t.getMessage("result_44"),body:_.template($("#tpl-pop-crossfate").html(),c),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),!0},popOpenNextFate:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).open_next_fate_info;if("undefined"==typeof a||!a.do_open)return void this.popRemoveToSkip();var b=a.episode_list,c=b.length;if(c>0){var e=this.open_next_fate_pop_count,f={image:b[e].thumbnail_image,name:b[e].chapter_name};this.popView=new d({className:"pop-open-next-fate",title:t.getMessage("result_43"),body:_.template($("#tpl-open-next-fate").html(),f),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow();var g=this;this.popView.$el.find(".btn-usual-ok").on("tap",function(){e+1>=c?g.popRemoveToSkip():(g.open_next_fate_pop_count++,g.popOpenNextFate())})}else this.popRemoveToSkip()},popConfirmUncap:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).npc_evolution;if(_.isEmpty(a))return void this.popRemoveToSkip();var b=a.length;if(this.promotionUncappngPopCnt<b){var c=a[this.promotionUncappngPopCnt],e=this,f=k.listStarHtml("prt-star","prt-ultimate-star","prt-archaic-star","prt-temporary-summon-star",c.evolution,c.max_evolution_level,c.release_max_evolution_level,0,0,"npc");this.dataUncap={image:c.thumbnail_image,name:c.name,starHtml:f,npcId:a[this.promotionUncappngPopCnt].npc_id},this.popView=new d({className:"pop-confirm-uncap",title:t.getMessage("result_pop_title_uncap"),body:_.template($("#tpl-confirm-uncap").html(),this.dataUncap),flagBtnClose:1,showStartCallback:function(){e.popView.$el.find(".prt-popup-footer").append(_.template($("#tpl-btn-uncap").html(),{npcId:e.dataUncap.npcId,isConfirm:!0}))},showEndCallback:function(){n.playSE("se/itemget_01_se_1.mp3")}}),this.popView.render().popShow(),this.popView.$el.find(".btn-usual-close").one("tap",function(){e.promotionUncappngPopCnt+=1,e.popConfirmUncap()})}else this.popRemoveToSkip()},onConfirmUncap:function(a){this.trigger("xhrStart");var b=$(a.currentTarget).data("npc-id"),c=this;this.checkIfTreasuresAreEnough(b).done(function(a){a?c.popUncapExec():s.hash("evolution/npc/confirm/"+b,{refresh:!1})})},checkIfTreasuresAreEnough:function(a){var b=$.Deferred(),c=this;return this.evolutionRequirementModel=new(p.extend({urlRoot:Game.baseUri+"result/evolution_requirements/"+a})),this.listenToOnce(this.evolutionRequirementModel,"sync",function(a){return c.trigger("xhrEnd"),b.resolve(a.has("evolution_requirements_info"))}),this.evolutionRequirementModel.fetch(),b.promise()},popUncapExec:function(){var a=this,b=this.evolutionRequirementModel.toJSON().evolution_requirements_info,c={image:this.dataUncap.image,name:this.dataUncap.name,level:b.param.level,requirements:b.requirements,cost:b.cost,starHtml:this.dataUncap.starHtml};this.popView=new d({className:"pop-exec-uncap",title:t.getMessage("result_pop_title_uncap"),body:_.template($("#tpl-exec-uncap").html(),c),flagBtnClose:1,showStartCallback:function(){a.popView.$el.find(".prt-popup-footer").append(_.template($("#tpl-btn-uncap").html(),{npcId:null,isConfirm:!1}))}}),this.popView.render().popShow()},onTapExecUncap:function(){this.popView.popRemove(),this.trigger("xhrStart");var a=new(p.extend({urlRoot:Game.baseUri+"evolution_npc/item_evolution"}));this.listenTo(a,"sync",this.execUncap),a.set({base:this.dataUncap.npcId,duplicate_key:1}).save()},onCloseExecUncap:function(){this.promotionUncappngPopCnt+=1,this.popConfirmUncap()},execUncap:function(){this.trigger("xhrEnd");var a=this,b=this.evolutionRequirementModel.toJSON().evolution_requirements_info;b.param.max_level=b.param.level,b.param.image_id=this.dataUncap.image,this.fetchBaseData().then(function(c){return a.playCjsEvolution(c.toJSON(),b)}).then(function(b){if(b.hasNewPose){var c={name:b.master.name,lvMax:b.param.max_level,currentEvoLv:+b.param.evolution,maxEvoLv:+b.master.max_evolution_level,dataId:b.id,masterId:b.master.id};a.popNewPose(c)}else a.popNextUncap()})},popNextUncap:function(){this.promotionUncappngPopCnt+=1,this.popConfirmUncap()},fetchBaseData:function(){var a=$.Deferred(),b=new(p.extend({urlRoot:Game.baseUri+"npc/npc_base"}));return this.listenToOnce(b,"sync",a.resolve),b.set({base_id:this.dataUncap.npcId}).save(),a},playCjsEvolution:function(a,b){var c,d=$.Deferred();return+a.param.evolution===+b.master.awakening1||+a.param.evolution===+b.master.awakening2?($cntResult=$("#cnt-result"),$cntResult.css("display","none"),c=new m(this.createAwakingCjsParams(a,b)),this.listenToOnce(c,"endCjsRemove",function(){$cntResult.css("display","block"),c.content_close(),d.resolve(_.defaults(a,{hasNewPose:!0}))}),d):(c=new l(this.createCjsParams(a,b)),this.listenToOnce(c,"endCjsRemove",function(){c.content_close(),d.resolve(_.defaults(a,{hasNewPose:!1}))}),d)},createCjsParams:function(a,b){return{star_gold:+a.master.max_evolution_level-+a.master.release_max_evolution_level,star_blue:+a.master.release_max_evolution_level,star_after:+a.param.evolution,max:0,lv1:+b.param.max_level,lv2:+a.param.max_level,is_after_lv_max:0}},createAwakingCjsParams:function(a,b){return _.extend(this.createCjsParams(a,b),{type:"npc",beforeImage:b.param.image_id,afterImage:a.param.image_id})},popNewPose:function(a){this.popView&&this.popView.popDelete(),this.popView=new d({className:"pop-pose-unlocked-detail",title:t.getMessage("new_pose_1"),body:_.template($("#tpl-new-pose-unlocked").html(),a),flagBtnClose:1,showEndCallback:function(){n.playSE("se/journal_se.mp3")}}),this.popView.render().popShow()},checkSkinWeaponExperience:function(){if(!this.result_data.get(this.CONST_VALUES))return!1;var a=this.result_data.get(this.CONST_VALUES).experience;return a&&a.is_experience&&a[0]&&a[0].is_max?(this.popSkinWeaponExperience(a),!0):!1},popSkinWeaponExperience:function(a){var b={rate:100,name:a[0].name};this.popView=new d({className:"pop-reward-ability",title:t.getMessage("result_skin_exp_1"),body:_.template($("#tpl-pop-skin-experience").html(),b),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow()},popMemorial:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).clear_reward.memorial;if(!a.is_memorial)return!1;var b={is_item:a.is_memorial,itemType:a.type,itemId:a.id,itemName:a.name,resultMessage:a.result_message||null,count:0};if(0==a.memorial_type){var c=[];c.push(b),this.popView=new d({className:"pop-reward-item",title:t.getMessage("result_46"),body:_.template($("#tpl-pop-item").html(),{item:c}),flagBtnCancel:0,flagBtnOk:1})}else this.popView=new d({className:"pop-reward-item",title:t.getMessage("result_47"),body:_.template($("#tpl-pop-item-limitbreak").html(),b),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playSE("se/itemget_03_se_1.mp3")}});return this.popView.render(),this.popView.popShow(),!0},popCheckMission:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).coop_daily_mission;if(!a||a.length<1)return!1;var b=_(a).any(function(a){return a.is_complete}),c=_.some(a,function(a){return 1==a.is_complete_popup});return this.popView=new d({className:"pop-mission-check",title:t.getMessage("result_48"),body:_.template($("#tpl-pop-mission-check").html(),{coop_daily_mission:a,isAllComplete:c}),flagBtnCancel:1,flagBtnOk:0,showEndCallback:function(){b&&n.playRankUpSE()}}),this.popView.render(),$(".pop-mission-check .btn-usual-cancel").addClass("btn-usual-close").removeClass("btn-usual-cancel"),this.popView.popShow(),!0},popMissionCheckTreasureraid:function(){var a=this,b=this.result_data.get(this.CONST_POPUP_DATA);if(!b.is_daily_mission)return!1;var c=b.daily_mission;c.is_over_limit=c.is_over_limit;var e=this.result_data.get("advent_info");c.is_advent=e&&(e.default_point>0||e.is_over_limit);var f={},g="",h=!1;return _.each(c.item_list,function(b,d){"en"===Game.lang?(f=a._replaceExceptionNames(b.item_name),g=f.itemName,h=f.isException):(g=b.item_name,h=!1),c.item_list[d].item_name=g,c.item_list[d].isException=h}),this.popView=new d({className:"pop-mission-check-treasureraid",title:t.getMessage("result_48"),body:_.template($("#tpl-pop-mission-check-treasureraid").html(),c),flagBtnClose:1,showEndCallback:function(){var a=c.is_complete?C:B;n.playSound(a)}}),this.popView.render().popShow(),!0},popBeginnerMissionTeamraid:function(){function a(c){var g=new d({className:"pop-update-beginner-mission-teamraid",title:t.getMessage("beginner_mission_teamraid_1"),body:f(c),flagBtnClose:1,showStartCallback:function(){var a=c.is_complete?C:B;n.playSound(a)}});return g.render().popShow(),b.listenToOnce(g,"close",function(){e.length>0?(g.popDelete(),b.popView=a(e.shift())):b.popRemoveOnly()}),g}var b=this,c=this.result_data.get(this.CONST_POPUP_DATA),e=_.flatten(c.teamraid_mission_beginner);if(0===e.length)return!1;var f=_.template($("#tpl-pop-update-beginner-mission-teamraid").html());return this.popView=a(e.shift()),!0},popOpenSideStory:function(a){return this.popView=new d({className:"pop-open-sidestory",title:t.getMessage("result_sidestory_1"),body:_.template($("#tpl-pop-open-sidestory").html(),a),flagBtnClose:1,showEndCallback:function(){n.playSE(D)}}),this.popView.render().popShow(),!0},popEventCoopReward:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).event_coop_reward||null;return a&&a.has_reward?(this.popView=new d({className:"pop-event-coop-reward",title:t.getMessage("result_49"),body:_.template($("#tpl-pop-event-coop-reward").html(),a),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow(),!0):!1},popEventCoopBoost:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).event_coop_boost||null;return a?a.is_not_opened?(this.popView=new d({className:"pop-event-coop-boost",title:t.getMessage("result_50"),body:t.getMessage("result_51"),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow(),!0):a.is_boost_up?(this.popView=new d({className:"pop-event-coop-boost",title:t.getMessage("result_52"),body:_.template($("#tpl-pop-event-coop-boost").html(),a),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playSE("se/itemget_01_se_1.mp3")}}),this.popView.render().popShow(),!0):!1:!1},popGetTitle:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).got_title_list;if("undefined"==typeof a||a.length<1)return!1;var b=a,c=0,e="";a.length>2&&(c=a.length-2,b=a.splice(0,2),e=t.replaceMessage("result_81",[c],c));var f={title_list:b,other_number:c,got_other_message:e};return this.popView=new d({className:"pop-notification-title"+this.popupStyleTypeClassName,title:t.getMessage("result_53"),body:_.template($("#tpl-pop-notification-title").html(),f),flagBtnCancel:1,flagBtnOk:0}),this.popView.render(),$(".pop-notification-title .btn-usual-cancel").addClass("btn-usual-close").removeClass("btn-usual-cancel"),this.popView.popShow(),!0},getJoinedNpcData:function(a){var b=this.result_data.get(this.CONST_POPUP_DATA).npc_join;return this.getJoinedNpcData=function(a){return"undefined"==typeof b||_.size(b)<=a?null:b[a]},this.getJoinedNpcData(a)},popNpcJoin:function(a){this.popView=new d({className:"pop-npc-join",title:t.getMessage("result_54"),body:_.template($("#tpl-pop-npc-join").html(),a),flagBtnCancel:0,flagBtnOk:1,showEndCallback:function(){n.playSE(z)}}),this.popView.render().popShow()},popFriendRequest:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).supporter_user;if(!a.is_request)return!1;if(a.is_frined_max)return!1;if(a.is_wait_approve)return!1;if(a.is_blacklist)return!1;if(a.is_send)return!1;if(!a.is_allow)return!1;if(1===+$("#cnt-result").data("is-defendorder"))return!1;var b={is_request:a.is_request,name:a.name,rank:a.level,leaderId:a.image,summonId:a.summon,summonImageId:a.summon_image,viewer_id:a.viewer_id,login_date:a.date,quality:a.summon_quality?a.summon_quality:0,summon_name:a.summon_name};return this.popView=new d({className:"pop-friend-request",title:t.getMessage("result_55"),body:_.template($("#tpl-pop-friend").html(),b),flagBtnCancel:1,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),!0},friendRequest:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).supporter_user;this.friend_model=new(p.extend({urlRoot:Game.baseUri+"result/friend_request"})),this.listenToOnce(this.friend_model,"sync",this.friendRequestComplete),this.friend_model.set({user_id:a.request_user_id}),this.friend_model.save()},friendRequestComplete:function(){0==this.friend_model.get("success")?this.popFriendLimit():this.popFriendComplete()},popFriendLupi:function(a){var b={is_request:a.is_request,name:a.name,rank:a.level,leaderId:a.image,summonId:a.summon,summonImageId:a.summon_image,viewer_id:a.viewer_id,login_date:a.date,get_lupi:a.get_lupi,lupi:a.lupi,quality:a.quality?a.quality:0,summon_name:a.summon_name};return this.popView=new d({className:"pop-friend-lupi",title:t.getMessage("result_56"),body:_.template($("#tpl-pop-friend-lupi").html(),b),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),!0},popFriendLimit:function(){this.popView.popRemove();var a=this.friend_model.toJSON(),b={massage:a.massage,nickname:a.nickname,viewer_id:a.viewer_id};return this.popView=new d({className:"pop-friend-limit",title:t.getMessage("result_58"),body:_.template($("#tpl-pop-friend-limit").html(),b),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),!0},popFriendComplete:function(a){return this.popView.popRemove(),this.popView=new d({className:"pop-friend-complete",title:t.getMessage("result_59"),body:t.getMessage("result_60"),flagBtnCancel:0,flagBtnOk:1}),this.popView.render(),this.popView.popShow(),!0},popDeal:function(){var a=this.result_data.get(this.CONST_POPUP_DATA).deal;if("undefined"==typeof a||!a)return!1;var b={className:"pop-deal",title:t.getMessage("result_80"),body:_.template($("#tpl-pop-deal").html(),{isDeal:!0}),flagBtnOk:0,showEndCallback:function(){n.playSE("se/itemget_03_se_1.mp3")}};return this.popView=new d(b).render().popShow(),!0},popExPoseOpen:function(){var a=this.exPoseOpen[0];a.showButtonFlag=!1;var b=new(p.extend({urlRoot:Game.baseUri+"npc/save_expose_notify"}));b.set({user_npc_id:+a.user_npc_id,awakening_level_list:[a.awakening_level]}).save(),this.popView=new d({className:"pop-ex-pose-open",title:t.getMessage("pop_ex_pose_open_1"),body:_.template($("#tpl-pop-ex-pose-open").html(),a),flagBtnClose:1,showEndCallback:function(){n.playSE("se/journal_se.mp3")}}),this.popView.render().popShow()},popRemoveExPose:function(){this.popView&&this.popView.popRemove(),this.exPoseOpen.shift(),this.exPoseOpen.length>0?this.popExPoseOpen():(this.popExPoseOpenFlag=!1,this.skip_new(10))},popup_check:function(){var a=!1;if(this.item_check_flag&&0==a&&(a=this.popRewardItemNormal(),this.item_check_flag=!1),this.special_item_check_flag&&0==a&&(a=this.popRewardItemSpecial(),this.special_item_check_flag=!1),this.plural_item_check_flag&&0==a&&(a=this.popRewardItemPlural(),this.plural_item_check_flag=!1),this.ability_check_flag&&0==a&&(a=this.popRewardAbility(),this.ability_check_flag=!1),this.max_evolution_check_flag&&0==a&&(a=this.popMaxEvolution(),this.max_evolution_check_flag=!1),this.max_evolution_check_weapon_flag&&0==a&&(a=this.popMaxEvolutionWeapon(),this.max_evolution_check_weapon_flag=!1),this.max_evolution_check_summon_flag&&0==a&&(a=this.popMaxEvolutionSummon(),this.max_evolution_check_summon_flag=!1),this.shouldCheckOpenHardPlus===!0&&a===!1&&(a=this.popOpenHardPlus(),this.shouldCheckOpenHardPlus=!1),this.cross_fate_check_flag&&0==a&&(a=this.popRewardCrossFate(),this.cross_fate_check_flag=!1),this.experience_check_flag&&0==a&&(a=this.checkSkinWeaponExperience(),this.experience_check_flag=!1),this.memorial_flag&&0==a&&(a=this.popMemorial(),this.memorial_flag=!1),this.daily_mission_flag&&0==a&&(a=this.popCheckMission(),this.daily_mission_flag=!1),this.hellSkipCheckFlg&&0==a&&(a=this.popHellSkipProgress(),this.hellSkipCheckFlg=!1),this.isCheckedTreasureraidDailyMission&&0==a&&(a=this.popMissionCheckTreasureraid(),this.isCheckedTreasureraidDailyMission=!1),this.shouldCheckTeamraidBeginnerMission&&0==a&&(a=this.popBeginnerMissionTeamraid(),this.shouldCheckTeamraidBeginnerMission=!1),this.shouldCheckOpenSideStory===!0&&0==a){var b=this.result_data.get(this.CONST_POPUP_DATA).open_sidestory||[];this.sidestoryOpenPopCount<b.length?(a=this.popOpenSideStory(b[this.sidestoryOpenPopCount]),this.sidestoryOpenPopCount++):this.shouldCheckOpenSideStory=!1}if(this.eventCoopReward&&0==a&&(a=this.popEventCoopReward(),this.eventCoopReward=!1),this.eventCoopBoost&&0==a&&(a=this.popEventCoopBoost(),this.eventCoopBoost=!1),this.title_flag&&0==a&&(a=this.popGetTitle(),this.title_flag=!1),this.join_check_flag&&0==a){var c=this.getJoinedNpcData(this.joinedNpcDataIndex);_.isNull(c)?(a=!1,this.join_check_flag=!1):(a=!0,this.popNpcJoin(c),this.joinedNpcDataIndex++)}return this.friend_check_flag&&0==a&&(a=this.popFriendRequest(),this.friend_check_flag=!1),this.adventProudFlag&&!a&&(a=this.popAdventProudAppearance(),this.adventProudFlag=!1),this.appearance_flg&&0==a&&"event/biography002"!=this.result_data.get("url")&&"event/biography005"!=this.result_data.get("url")&&"event/biography006"!=this.result_data.get("url")&&(a=this.popHellAppearance(!0),this.appearance_flg=!1),this.commuPopMessageFlag&&0==a&&(a=this.popCommuMessage(),this.commuPopMessageFlag=!1),this.treasureItemInfoFlag&&0==a&&(a=this.popTreasureItemInfo(),this.treasureItemInfoFlag=!1),this.deal_check_flag&&0==a&&(a=this.popDeal(),this.deal_check_flag=!1),a},navigate:function(){var a=this,b=this.result_data.get("cjs_data");if(_.isEmpty(b)===!1){Game.get$ScrollParent().scrollTop(0),this.popView&&this.popView.popRemove();var c=n.getPlayingBGM();h.setParams({message:{0:b.text,get_voice:b.voice_name,join_cjs:b.join_cjs,chara_id:b.join_npc_id}}),$("#cjs-npc_get").one("completeCjsPlay",function(){n.playBGM(c),a._navigate()})}else this._navigate()},_navigate:function(){if(_.isNull(this.retryTapEvent)===!1&&_.isNull(this.subHandleQuestView)===!1)return void this.subHandleQuestView.checkNextPlay(this.retryTapEvent,!1);var b;b=this.navigateToUnclaimedFlag?"quest/assist/unclaimed":this.result_data.get("url"),this.content_close(),a.history.navigate(b,!0)},locationPresent:function(){this.content_close(),a.history.navigate("present",!0)},locationReward:function(){this.content_close(),a.history.navigate("quest/assist",!0)},location_title:function(){this.content_close(),a.history.navigate("title",!0)},locationScreen:function(){this.cjsResult.removeEvent(),this.cjsResult=null,this.navigate()},locationHref:function(a){var b=$(a.currentTarget).data("location-href");s.hash(b,{refresh:!0})},locationDeal:function(b){var c=$(b.currentTarget).data("location-href");a.history.navigate(c,!0)},playLevelUpSE:function(){var a=Date.now();a>u+w&&(n.playLevelUpSE(),u=a)},playGetLBSE:function(){var a=Date.now();a>v+x&&(n.playSound(A),v=a)},popDungeon:function(){var a=this.result_data.attributes.dungeon,b=a.current_ap-a.consume_ap;0>b&&(b=0),this.popView=new d({className:"pop-dungeon",title:"NEXT BATTLE",body:_.template($("#tpl-pop-dungeon").html(),_.defaults(this.result_data.attributes.dungeon,{afterAp:b})),flagBtnCancel:0,flagBtnOk:0}),this.popView.render(),$(".prt-popup-footer").append('<div class="btn-return">'+t.getMessage("result_61")+'</div><div class="btn-go">'+t.getMessage(34)+"</div>"),this.popView.popShow(),this.ppCjs&&this.ppCjs.remove(),window.getRateNum=String(10*Number(a.point_rate)),this.ppCjs=new e({canvas:{elementId:"canv",width:150,height:150},cjs:{name:"raid_nextbattle_001",x:0,y:0}})},popConfirmReturn:function(){this.popView=new d({className:"pop-confirm-return",title:t.getMessage("result_62"),body:_.template($("#tpl-pop-confirm-return").html(),this.result_data.attributes.dungeon),flagBtnCancel:1,flagBtnOk:0}),this.popView.render(),$(".prt-popup-footer").append('<div class="btn-usual-text quest-end">'+t.getMessage("result_63")+"</div>"),this.popView.popShow()},dungeonReturn:function(){this.trigger("xhrStart");var a=new(p.extend({urlRoot:Game.baseUri+this.controller+"/return_from_dungeon"}));this.listenToOnce(a,"sync",this.popDungeonReturn),a.set({raid_id:this.param.raid_id,next_raid_id:this.result_data.attributes.dungeon.next_raid_id}),a.save()},popDungeonReturn:function(a){this.trigger("loadEnd"),this.popView=new d({className:"pop-return",title:t.getMessage("result_64"),body:_.template($("#tpl-pop-dungeon-return").html(),a.attributes),flagBtnCancel:0,flagBtnOk:0}),this.popView.render(),$(".prt-popup-footer").append('<div class="btn-control">'+t.getMessage("result_65")+"</div>"),this.popView.popShow(),n.playSE("se/rankup_se_1.mp3")},checkContinue:function(){this.continueModel=new(p.extend({urlRoot:Game.baseUri+this.controller+"/continue_dungeon"})),this.listenToOnce(this.continueModel,"sync",this.checkApResult),this.continueModel.set({raid_id:this.param.raid_id,next_raid_id:this.result_data.attributes.dungeon.next_raid_id}),this.continueModel.save(),this.trigger("xhrStart")},checkApResult:function(){this.trigger("xhrEnd");var b=this.continueModel.toJSON();b.continue_flag&&("undefined"==typeof window.dungeonCount?(window.dungeonCount=1,this.content_close(),a.history.navigate("raid/"+this.result_data.attributes.dungeon.next_raid_id,!0)):(window.dungeonCount++,window.dungeonCount>=5?(this.content_close(),s.hash("raid/"+this.result_data.attributes.dungeon.next_raid_id,{refresh:!0})):(this.content_close(),a.history.navigate("raid/"+this.result_data.attributes.dungeon.next_raid_id,!0))))},locationArcadeNext:function(b){this.content_close(),a.history.navigate("raid/"+this.result_data.get("arcade").next_raid_id,!0)},arcarumResult:function(a){$("#cnt-result").append($("#tpl-arcarum-result").html()),window.scrollTo(0,1),"undefined"!=typeof window.stage&&window.stage&&(window.stage.removeAllEventListeners("tick"),window.stage.removeAllChildren(),window.stage.clear(),delete window.stage);var b=a.notice_effect.show_result_clear_condition||null;if(b){var c=this.result_data.get("event"),d=(c?c.event_code:null)||null,e={seCount:d?"se/"+d+"_count_se_1.mp3":null,seComplete:d?"se/"+d+"_mission_comp_se_1.mp3":null};this.clearArcarumResult(b,e)}else this.isArcarumResult=!0,$cjsArcarumResult.css("display","none"),this.skip_new(10)},clearArcarumResult:function(a,b){var c=b||{},d={cjsName:"arcarum_result_clear",canvasName:"cjs-arcarum_result_clear",clear:a,seCount:c.seCount||null,seComplete:c.seComplete||null},e=this.$el.find(".cjs-arcarum-result"),f=$("#btn-cjs-skip");f.css("display","block"),this.cjsArcarumResult=new g(d),L=this.cjsArcarumResult;var h=this;$("#"+d.canvasName).off("playEnd").on("playEnd",function(){L=null,f.css("display","none"),h.isArcarumResult=!0,e.css("display","none"),h.cjsArcarumResult.removeChildren(),h.cjsArcarumResult.destroy(),h.skip_new(10)})},onTapBtnCjsSkip:function(){null!=L&&"function"==typeof L.skipCjs&&this.skipCjs()},skipCjs:function(){L.skipCjs()},popAutoSellRewardList:function(){this.popView=new d({className:"pop-auto-sell-reward-list",title:t.getMessage("result_auto_sell_3"),body:_.template($("#tpl-auto-sell-reward-list").html(),{autoSellRewardList:this.result_data.get(this.CONST_REWARDS).auto_sell_list}),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow()},popAutoCustomRewardList:function(){this.popView=new d({className:"pop-auto-custom-reward-list",title:t.getMessage("result_auto_custom_1"),body:_.template($("#tpl-auto-custom-reward-list").html(),{autoCustomRewardList:this.result_data.get(this.CONST_REWARDS).auto_custom_list}),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow()},popAutoRecycleRewardList:function(){var a=this.result_data.get(this.CONST_REWARDS),b={autoRecyclingWeaponList:a.auto_recycling_weapon_list,autoRecyclingSummonList:a.auto_recycling_summon_list};this.popView=new d({className:"pop-auto-recycle-reward-list",title:t.getMessage("result_auto_recycle_3"),body:_.template($("#tpl-auto-recycle-reward-list").html(),b),flagBtnCancel:0,flagBtnOk:1}),this.popView.render().popShow()},getAutoRecycleSetting:function(){this.trigger("xhrStart");var a=this,b=new(o.extend({urlRoot:Game.baseUri+"setting/auto_recycling_setting"}));this.listenToOnce(b,"sync",function(b){a.autoRecycleSetting=b.toJSON(),a.popAutoRecycleListSetting()}),b.fetch()},popAutoRecycleListSetting:function(){var a={autoRecyclingWeaponList:this.autoRecycleSetting.auto_recycling_weapon_list,autoRecyclingSummonList:this.autoRecycleSetting.auto_recycling_summon_list,recycleWeaponDisableFlag:!0,recycleSummonDisableFlag:!0},b=this.autoRecycleSetting.auto_recycling_weapon,c=this.autoRecycleSetting.auto_recycling_summon;a.recycleWeaponDisableFlag=!_.some(b,function(a){return+a===N}),a.recycleSummonDisableFlag=!_.some(c,function(a){return+a===N}),this.popView=new d({className:"pop-auto-recycle-list-setting",title:t.getMessage("result_auto_recycle_5"),body:_.template($("#tpl-pop-auto-recycle-list-setting").html(),a),
flagBtnClose:1,flagBtnOk:1}),this.popView.render().popShow(),this.stopListening(this.autoSettingView,"popRemoveAutoSetting"),this.listenToOnce(this.autoSettingView,"popRemoveAutoSetting",this.getAutoRecycleSetting),this.trigger("xhrEnd")},popAutoRecycleSetting:function(){var a={autoRecyclingWeapon:this.autoRecycleSetting.auto_recycling_weapon,autoRecyclingSummon:this.autoRecycleSetting.auto_recycling_summon};this.popView=new d({className:"pop-auto-recycle-setting",title:t.getMessage("result_auto_recycle_6"),body:_.template($("#tpl-pop-auto-recycle-setting").html(),a),flagBtnCancel:1,flagBtnOk:1}),this.popView.render().popShow()},changeRecycleSettingText:function(a){var b=$currentTarget.data("type");$("#recycle-"+b+"-setting-text").html($("#recycle-"+b+"-setting option:selected").html())},toggleRecycleSetting:function(a){$(a.currentTarget).toggleClass("active")},resetRecycleItemSetting:function(){this.popView.$el.find(".btn-recycle-weapon, .btn-recycle-summon").removeClass("active")},setAutoRecycleListSetting:function(){var a={auto_recycling_weapon_list:$("#recycle-weapon-setting").children("option:selected").val(),auto_recycling_summon_list:$("#recycle-summon-setting").children("option:selected").val()};this.postAutoRecycleSetting(a)},setAutoRecycleSetting:function(){var a=this.popView.$el.find(".prt-recycle-weapon"),b=this.popView.$el.find(".prt-recycle-summon"),c={normal:a.find(".type-1").hasClass("active")===!0?N:M,rare:a.find(".type-2").hasClass("active")===!0?N:M,rare_angel:a.find(".angel-type-1").hasClass("active")===!0?N:M,super_rare_angel:a.find(".angel-type-2").hasClass("active")===!0?N:M},d={normal:b.find(".type-1").hasClass("active")===!0?N:M,rare:b.find(".type-2").hasClass("active")===!0?N:M,rare_angel:b.find(".angel-type-1").hasClass("active")===!0?N:M,super_rare_angel:b.find(".angel-type-2").hasClass("active")===!0?N:M,super_special_rare_angel:b.find(".angel-type-3").hasClass("active")===!0?N:M},e={auto_recycling_weapon:c,auto_recycling_summon:d};this.postAutoRecycleSetting(e)},postAutoRecycleSetting:function(a){this.trigger("xhrStart");var b=this,c=new(p.extend({urlRoot:Game.baseUri+"setting/save"}));this.listenToOnce(c,"sync",function(){b.popRemoveOrigin(),b.trigger("xhrEnd")}),c.set(a).save()},changeMaskZindexVal:function(a){this.popZindexVal=a.css("z-index"),a.css("z-index",$(".mask").css("z-index"))},popRank250Treasure:function(a){this.popView=new d({className:"pop-rank-250-treasure",title:t.getMessage("rank_250_treasure_popup"),body:_.template($("#tpl-pop-rank-250-treasure").html(),{itemName:a.name,itemId:a.itemId}),flagBtnOk:1,showEndCallback:function(){n.playSE("se/bingo_se_9.mp3")}}),this.popView.render().popShow()},popRank250Hint:function(){this.popView=new d({className:"pop-rank-250-hint",title:t.getMessage("rank_250_treasure_1"),body:t.getMessage("rank_250_hint_1"),flagBtnOk:1,showEndCallback:function(){n.playSE("se/itemget_01_se_1.mp3")}}),this.popView.render().popShow()},popAdventProudAppearance:function(){var a=this.result_data.toJSON().popup_data.advent_proud_data;if(!a)return!1;var b=a.is_advent_proud_flag,c=a.is_advent_proud_plus_flag;if(!b&&!c)return!1;var e=new d({className:"pop-advent-proud-appearance",title:t.getMessage("quest_135"),body:_.template($("#tpl-event-proud-boss").html(),_.defaults({difficulty:b?"proud":"proud_plus"},a.reward_data)),flagBtnClose:1,showEndCallback:function(){n.playSE(F)}});return e.render().popShow(),!0},displayCollectItem:function(a){var b=_.clone(a),c=b.url.split("/");switch(b.numClass=+b.item_possesed>=+b.need_number?"enough":"",c[0]){case"evolution":switch(b.returnType=1,c[1]){case"npc":b.returnViewHash=c[0]+"/"+c[1]+"/confirm/"+c[3];break;case"weapon":case"summon":b.returnViewHash=c[0]+"/"+c[1]+"/material/"+c[3]}break;case"shop":b.returnType=2,b.returnViewHash=_.initial(c,3).join("/");break;case"archaic":b.returnType=3,b.returnViewHash=_.initial(c,3).join("/");break;case"arcarum2":b.returnType=4,b.returnViewHash=_.initial(c,3).join("/")}$("#prt-collect-item").html(_.template($("#tpl-prt-collect-item").html(),b)).addClass("show")},popHellSkipProgress:function(){var a=this.resultJsonData[this.CONST_POPUP_DATA].quest_skip;return!a||a.is_complete?!1:(this.popView=new d({className:"pop-hell-skip-progress",title:a.chapter_name,body:_.template($("#tpl-pop-hell-skip-progress").html(),a),flagBtnClose:1,showStartCallback:this.creatHellSkipStarCjs.bind(this)}),this.popView.render().popShow(),!0)},creatHellSkipStarCjs:function(){var a=this.resultJsonData[this.CONST_POPUP_DATA].quest_skip,b=this;this.removeHellSkipStarCjs();var c=["dead_count","recovery_count","turn_count"],d=0;_.each(c,function(c){a[c]&&(b.setNamedTimeout("cjs-hell-skip-star-"+c,function(){var a=new e({canvas:{elementId:"cjs-hell-skip-star-"+c,width:85,height:64},cjs:{name:"hell_appear",x:0,y:0}});b.hellSkipStarCjsList||(b.hellSkipStarCjsList=[]),b.hellSkipStarCjsList.push(a)},d),d+=300)})},removeHellSkipStarCjs:function(){_.each(this.hellSkipStarCjsList,function(a){a.remove()}),this.hellSkipStarCjsList=null},removeHellSkipProgressPop:function(){this.removeHellSkipStarCjs(),this.popRemoveOnly()}});return R});
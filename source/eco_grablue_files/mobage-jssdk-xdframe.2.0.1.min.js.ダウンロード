/* build env: jpse, client version: 3.2.1, xdframe version: 2.0.1, date: 2016-02-08 10:43, tag: 20160208_01 */!function(a,b,c,d,e){"use strict";function f(a){if(Error.captureStackTrace)Error.captureStackTrace(this,this.constructor);else{var b=new Error;b.stack&&(this.stack=b.stack)}this.message=a||""}function g(a){f.call(this,a.body),this.status=a.status,this.headers=a.headers||{},this.body=a.body||""}function h(a){f.call(this,a.detail),this.httpStatus=a.httpStatus,this.title=a.title,this.detail=a.detail}function i(a){this.target=a;var b={};b[I]={},b[J]={},b[K]={},this.listeners=b,this.channelId=d.origin+":"+n.util.nextSequence("channel"),H.channels[this.channelId]=this}function j(a,b,c){i.call(this,a),this.targetOrigin=b,this.sourceWindow=c,c.addEventListener("message",this)}function k(a){i.call(this,a),a.addEventListener("message",this)}function l(){this.store=a.localStorage}function m(){n.storage.Storage.call(this),this.namespace="xdframe"}var n={SDK_NAME:"mobage-jssdk",SDK_VERSION:"3.2.1"};a.mobage=n;var o={},p={debug:1,info:2,warn:3,crit:4},q=o.LOG_LEVEL_DEBUG=1,r=o.LOG_LEVEL_INFO=2,s=o.LOG_LEVEL_WARN=3,t=o.LOG_LEVEL_CRIT=4;o.logLevel=p.info,o.setLogLevel=function(a){this.logLevel=p[a]};for(var u=["log","debug","error","warn"],v=0;v<u.length;v++){var w=u[v];console[w]&&!console[w].bind&&(console[w].bind=function(){return function(){console[w].apply(console,arguments)}})}o.debug=function(){return console.debug&&o.logLevel<=q?console.debug.bind(console):console.log.bind(console)}(),o.info=function(){return console.log&&o.logLevel<=r?console.log.bind(console):void 0}(),o.warn=function(){return console.warn&&o.logLevel<=s?console.warn.bind(console):void 0}(),o.crit=function(){return console.error&&o.logLevel<=t?console.error.bind(console):void 0}(),o.error=function(){return console.error?console.error.bind(console):void 0}(),n.log=o;var x={visibilityPrefix:function(){return"undefined"!=typeof c.hidden?"":"undefined"!=typeof c.webkitHidden?"webkit":null}()};x.getInformation=function(){return x.information?x.information:(x.isiOSChrome()?x.information={os:{name:"ios"},application:{name:"chrome"},unsupported:!0}:x.isUIWebView()&&!x.isiOSShellAppSDK()?x.information={os:{name:"ios"},application:{name:"others"},unsupported:!0}:x.isFacebookWebView()?x.information={os:{name:"android"},application:{name:"others"},unsupported:!0}:x.information={unsupported:!1},x.information)},x.isSandbox=function(){return!1},x.getEnvironment=function(){return x.isAndroidShellAppSDK()?"android-shellapp":x.isiOSShellAppSDK()?"ios-shellapp":"browser"},x.getSDKName=function(){return x.isAndroidShellAppSDK()?"mobage-shellapp-sdk-android":x.isiOSShellAppSDK()?"mobage-shellapp-sdk-ios":x.isChromeappWebView()?"mobage-chromeapps-sdk":"mobage-jssdk"},x.isAndroidShellAppSDK=function(){return navigator.userAgent.match(/Mobage-ShellApp-SDK-Android/)},x.isiOSShellAppSDK=function(){return navigator.userAgent.match(/Mobage-ShellApp-SDK-iOS/)},x.isiOSChrome=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|).*CriOS/)},x.isUIWebView=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)},x.isFacebookWebView=function(){return navigator.userAgent.match(/FBAV/)},x.isSafariPrivateMode=function(){if(navigator.userAgent.match(/Safari/)){try{localStorage.setItem("mobageJssdkTest",1)}catch(a){return!0}return localStorage.removeItem("mobageJssdkTest"),!1}},x.isChromeappWebView=function(){return navigator.userAgent.match(/ChromeApp/)},x.isIE=function(){return navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/rv:11.0/)},x.isFirefox=function(){return navigator.userAgent.match(/Firefox/)},x.isEdge=function(){return navigator.userAgent.match(/Edge/)},"undefined"==typeof d.origin&&(d.origin=d.protocol+"//"+d.host),n.platform=x;var y={};y.inherits=function(a,b){a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})},n.core=y;var z={sequences:{}},A=Math.pow(2,53),B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",C=B.length,D=c.createElement("a");z.getContentURL=function(a){D.href=a;var b=D.pathname;return 0!==b.indexOf("/")&&(b="/"+b),(n.clientConfig.contentOrigin||d.origin)+b},z.ensure=function(a,b){return function(){try{a.apply(null,arguments)}catch(c){}finally{b.apply(null,arguments)}}},z.encodeQuery=function(b){return Object.keys(b).filter(function(a){return b[a]}).map(function(c){return a.encodeURIComponent(c)+"="+a.encodeURIComponent(b[c])}).join("&")},z.decodeQuery=function(b){return b.split("&").map(function(a){return a.split("=",2)}).reduce(function(b,c){return c[0].length>0&&(b[a.decodeURIComponent(c[0])]=a.decodeURIComponent(c[1])),b},{})},z.randomString=function(a){for(var b="",c=0;a>c;c++)b+=B.charAt(Math.floor(Math.random()*C));return b},z.nextSequence=function(a){return this.sequences[a]||(this.sequences[a]=0),++this.sequences[a]===A&&(this.sequences[a]=1),this.sequences[a]},z.resetSequence=function(a){this.sequences[a]=0},z.getOriginFromUrl=function(a){var b=c.createElement("a");return b.href=a,b.origin||b.protocol+"//"+b.host},z.decodeBase64URL=function(a){try{var b=a.replace(/-/g,"+").replace(/_/g,"/");return atob(b)}catch(c){return null}},z.stringifyWindowFeatures=function(a){var b="";if(a&&"object"==typeof a){var c=a.location||0,d=a.menubar||0,e=a.toolbar||0,f=a.scrollbars||0,g=a.center||0,h=a.status||0,i=a.width||0,j=a.height||0,k=screen.width/2-i/2,l=screen.height/2-j/2;b="location="+c+",menubar="+d+",toolbar="+e+",scrollbars="+f+",center="+g+",status="+h+",width="+i+",height="+j+",left="+k+",top="+l}return b},n.util=z;var E={};E.DEVICE_ID_PC="2",E.DEVICE_ID_SPWEB="4",E.DEVICE_ID_IOS="8",E.DEVICE_ID_ANDROID="16",E.DISPLAY_TOUCH="touch",E.DISPLAY_TOUCH_POPUP="touch_popup",E.DISPLAY_PAGE="page",E.DISPLAY_PAGE_POPUP="page_popup",n.constants=E;var F={};n.core.inherits(f,Error),f.prototype.name="CustomError",n.core.inherits(g,f),g.prototype.name="HTTPError",n.core.inherits(h,f),h.prototype.name="APIError",F.HTTPError=g,F.APIError=h,n.error=F;var G={connect:{origin:"https://connect.mobage.jp",logout:"https://connect.mobage.jp/logout",authorize:"https://connect.mobage.jp/connect/1.0/services/authorize",uninstall:"https://connect.mobage.jp/connect/1.0/services/uninstall",jsonp_revoke:"https://connect.mobage.jp/connect/1.0/jsonp/revoke",check_session:"https://connect.mobage.jp/connect/1.0/jssdk/session_iframe",heartbeat:"https://connect.mobage.jp/connect/1.0/jssdk/heartbeat_iframe",redirect:function(a){return"https://connect.mobage.jp/connect/1.0/clients/"+a+"/jssdk/redirect"},fire_install_api:"https://connect.mobage.jp/connect/1.0/api/fire_install",session_token_api:"https://connect.mobage.jp/connect/1.0/api/session_token",session_api:"https://connect.mobage.jp/connect/1.0/api/session",easy_registration_api:"https://connect.mobage.jp/connect/1.0/api/easy_account_registration",user_upgrade:"https://connect.mobage.jp/user_upgrade/new",client_updates_api:function(a){return"https://connect.mobage.jp/connect/1.0/api/clients/"+a+"/updates"},user_purchase_limit_api:"https://connect.mobage.jp/connect/1.0/api/users/{user_id}/purchase_limit",account_manager:"https://connect.mobage.jp/account_manager",session_check:"https://connect.mobage.jp/connect/1.0/shellappsdk/session_check_form",xasm_proxy:"https://connect.mobage.jp/connect/1.0/api/xasm_proxy",easy_registration:"https://connect.mobage.jp/connect/1.0/shellappsdk/easy_account_registration",account_setting:"https://connect.mobage.jp/account_setting"},widget:{origin:"https://widget.mobage.jp",debug_authorized:"https://widget.mobage.jp/debug/authorized",debug_anomymous:"https://widget.mobage.jp/debug/anonymous",coin_purchase:"https://widget.mobage.jp/ui/1.0/me/coin/purchases/new",coin_passbook:"https://widget.mobage.jp/ui/1.0/me/coin/passbook/new",vc_purchase:"https://widget.mobage.jp/ui/1.0/me/vc/purchases/new",payment:"https://widget.mobage.jp/ui/1.0/me/payments/new",inquiry:"https://widget.mobage.jp/ui/1.0/me/inquiries",user_upgrade:"https://widget.mobage.jp/ui/1.0/me/wuff/user_upgrades/new",invitation:"https://widget.mobage.jp/ui/1.0/me/invitations",client_configuration:"https://widget.mobage.jp/ui/1.0/me/client_configuration/edit",redirect:"https://widget.mobage.jp/ui/1.0/redirect",shortcut_icon:"https://widget.mobage.jp/ui/1.0/shortcut_icon",commercial_transaction:"https://widget.mobage.jp/ui/1.0/commercial_transaction",client_agreement:"https://widget.mobage.jp/ui/1.0/client_agreement",browser_switch_guide:"https://widget.mobage.jp/ui/1.0/browser_switch_guide",choose_product:"https://widget.mobage.jp/ui/1.0/choose_product",client_community:"https://widget.mobage.jp/ui/1.0/legacy/client_community",mygame:"https://widget.mobage.jp/ui/1.0/legacy/mygame",mypage:"https://widget.mobage.jp/ui/1.0/legacy/mypage",portal:"https://widget.mobage.jp/ui/1.0/legacy/portal",chat_channel:"https://widget.mobage.jp/ui/1.0/legacy/chat_channel",arbitrarily:"https://widget.mobage.jp/ui/1.0/legacy/arbitrarily"},api:{v2:{origin:"https://app.mobage.jp",restful:"https://app.mobage.jp/social/api/restful/v2",jsonrpc:"https://app.mobage.jp/social/api/jsonrpc/v2",proxy:"https://app.mobage.jp/static/proxy2.0.1.html"},"v2.02":{origin:"https://app.mobage.jp",restful:"https://app.mobage.jp/social/api/restful/v2.02",jsonrpc:"https://app.mobage.jp/social/api/jsonrpc/v2.02",proxy:"https://app.mobage.jp/static/proxy2.0.1.html"}},menu:{application:"https://widget.mobage.jp/api/1.0/menu/application",mymenu:"https://widget.mobage.jp/api/1.0/menu/mymenu",currency:"https://widget.mobage.jp/api/1.0/menu/currency"},currency:{origin:"https://iap.mbga.jp",product_base:"https://iap.mbga.jp/_nbpf_get_product_",begin_purchase_base:"https://iap.mbga.jp/_nbpf_begin_purchase_",purchase_base:"https://iap.mbga.jp/_nbpf_purchase_"},mobage:{origin:"http://sp.mbga.jp",term:"http://sp.mbga.jp/payment/coin/kiyaku",coin_notes:"http://sp.mbga.jp/payment/coin/notes.html",vc_notes:"http://sp.mbga.jp/_coin_vc_notes",vca_notes:"http://sp.mbga.jp/_coin_vca_notes",tokushouhou:"http://sp.mbga.jp/character/faq12.html",coin_faq:"http://sp.mbga.jp/_cs_faq_categ?id=1267",vc_faq:"http://sp.mbga.jp/_coin_vc_faq",vca_faq:"http://sp.mbga.jp/_coin_vca_faq",heartbeat:"https://ssl.sp.mbga.jp/_heartbeat_iframe",ssl_origin:"https://ssl.sp.mbga.jp"},mocha:{origin:"https://ava-a.sp.mbga.jp",widget_script:"https://ava-a.sp.mbga.jp/mobage/js/game-chat-connect/1.28/widgets.production.service.js"},forum:{origin:"https://forum.mobage.jp"}};n.endpoints=G;var H={channels:{}},I=H.MESSAGE_TYPE_NOTIFICATION="notification",J=H.MESSAGE_TYPE_REQUEST="request",K=H.MESSAGE_TYPE_RESPONSE="response";i.prototype.addRequestListener=function(a,b){this.listeners[J][a]=b},i.prototype.removeRequestListener=function(a){this.listeners[J][a]=null},i.prototype.addNotifyListener=function(a,b){this.listeners[I][a]=b},i.prototype.removeNotifyListener=function(a){this.listeners[I][a]=null},i.prototype.notify=function(a,b){this.postMessage({type:I,topic:a,extra:b})},i.prototype.request=function(a,b,c){var d=n.util.nextSequence("channel:"+this.channelId);this.listeners[K][d]=c,this.postMessage({type:J,topic:a,id:d,parameters:b})},i.prototype.response=function(a,b,c){this.postMessage({type:K,topic:a,id:b,result:c})},i.prototype.dispatch=function(a){var b=a.data,c=b.topic,d=!1;b.type===I&&this.listeners[I][c]?(this.listeners[I][c](b),d=!0):b.type===J&&this.listeners[J][c]?(this.listeners[J][c](b),d=!0):b.type===K&&this.listeners[K][b.id]&&(this.listeners[K][b.id](b),delete this.listeners[K][b.id],d=!0),d&&"function"==typeof a.stopImmediatePropagation&&a.stopImmediatePropagation()},n.core.inherits(j,i),j.prototype.dispose=function(){this.sourceWindow.removeEventListener("message",this),this.target=null,delete H.channels[this.channelId]},j.prototype.handleEvent=function(a){a.origin===this.targetOrigin?this.dispatch(a):0===a.origin.indexOf("chrome-extension://")&&this.dispatch(a)},j.prototype.postMessage=function(a){this.target&&("undefined"==typeof this.target.postMessage||this.target.postMessage(a,this.targetOrigin))},n.core.inherits(k,i),k.prototype.dispose=function(){this.target.removeEventListener("message",this),this.target=null,delete H.channels[this.channelId]},k.prototype.handleEvent=function(a){this.dispatch(a)},k.prototype.postMessage=function(a){this.target.postMessage(a)},n.channel=H,n.channel.Channel=i,n.channel.WindowChannel=j,n.channel.WorkerChannel=k,n.storage={},l.prototype.prefix=function(){return this.namespace?this.namespace+":":""},l.prototype.unixtime=function(){return Date.now()/1e3|0},l.prototype.setItem=function(a,b,c){var d=this.prefix()+a,e={value:b};if(c){var f=this.unixtime()+c;e.expire=f}try{this.store.setItem(d,JSON.stringify(e))}catch(g){throw g}},l.prototype.getItem=function(a){var b,c=this.prefix()+a,d=this.store.getItem(c);if(null===d)return null;try{b=JSON.parse(d)}catch(e){return null}return b&&(!b.expire||b.expire>this.unixtime())?b.value:null},l.prototype.removeItem=function(a){var b=this.prefix()+a;this.store.removeItem(b)},n.storage.Storage=l,n.core.inherits(m,n.storage.Storage),m.prototype.key=function(a){return"tokenData:"+a},m.prototype.setTokens=function(b){var c=a.parseInt(b.expires_in),d={};b.scope&&b.scope.forEach(function(a){d[a]=!0});var e={access_token:b.access_token,scopes:d};this.setItem(this.key(b.storage_suffix+b.parentOrigin),e,c)},m.prototype.getTokens=function(a){var b=this.getItem(this.key(a.storage_suffix+a.parentOrigin));return b?a.scope&&a.scope.some(function(a){return!b.scopes[a]})?null:b:null},m.prototype.removeTokens=function(a){this.removeItem(this.key(a.storage_suffix+a.parentOrigin))},n.storage.token=new m;var L={};L.modalIframeOpen=!1,L.createIframe=function(a,b){b=b||function(){};var d=c.createElement("iframe");return b.done=!1,b&&(d.onload=function(){d.onload=null,b.done||(b.done=!0,b(d))}),d.src=a,d},L.createInvisibleIframe=function(a,b){var d=L.createIframe(a,b);return L.css(d,{display:"none",width:0,height:0}),c.body.appendChild(d),{window:d.contentWindow,iframe:d,dispose:function(){c.body.removeChild(d),d=null}}},L.createModalIframe=function(a,d){if(L.modalIframeOpen)return null;n.event.emit("modal.beforeOpen"),L.modalIframeOpen=!0;var e=a.url,f=a.id,g=a.display&&a.display===n.constants.DISPLAY_PAGE_POPUP,h=g?"710px":"90%",i=g?"560px":"90%",j=a.width||h,k=a.height||i,l="undefined"!=typeof a.opacity?a.opacity:1,m=c.createElement("div"),o=c.createElement("div"),p=L.createIframe(e,d),q=n.util.getOriginFromUrl(e);m.setAttribute("id",f+"_overlay"),m.setAttribute("name",f+"_overlay"),o.setAttribute("id",f+"_container"),o.setAttribute("name",f+"_container"),p.setAttribute("id",f),p.setAttribute("name",f),L.css(m,{position:"absolute",height:L.getDocumentHeight()+"px",width:c.body.scrollWidth+"px",top:0,left:0,"background-color":"transparent",opacity:.2,"z-index":9e3});var r,s={opacity:0,"-webkit-box-sizing":"border-box","background-color":"transparent","box-sizing":"border-box",height:k,width:j,top:"50%",left:"50%",position:"fixed","-webkit-transition":"opacity 0.3s ease-in-out",transition:"opacity 0.3s ease-in-out","z-index":1e4},t={};g&&(s.zoom="reset",t={maxWidth:h,maxHeight:i,maxWindowWidthRate:.9,maxWindowHeightRate:.9},r=function(){L.adjust(m,{maxWidth:"10000px",maxHeight:"10000px",maxWindowWidthRate:1,maxWindowHeightRate:1,ignoreMargin:!0})}),L.css(o,s),L.css(p,{border:"none","-webkit-boz-sizing":"border-box","box-sizing":"border-box",height:"100%",width:"100%"}),c.body.appendChild(m),o.appendChild(p),c.body.appendChild(o),n.event.emit("modal.afterOpen"),L.adjust(o,t),setTimeout(function(){L.css(o,{opacity:l})},0);var u=function(){L.modalIframeOpen=!1,n.event.emit("modal.beforeClose"),v.dispose(),c.body.removeChild(o),c.body.removeChild(m),n.event.emit("modal.afterClose"),m.removeEventListener("click",u),c.removeEventListener("click",u)};g&&(n.platform.isFirefox()||n.platform.isEdge()?setTimeout(function(){c.addEventListener("click",u)},0):m.addEventListener("click",u),b.addEventListener("message",function(a){a&&"close"===a.data&&u()}));var v=L.setupModalEvents(o,p.contentWindow,q,t,r);return{window:p.contentWindow,iframe:p,rootElement:o,dispose:u}},L.createWindow=function(a){var c=b.open(a.url,a.id);return{window:c,dispose:function(){c&&(c.close(),c=null)}}},L.adjust=function(a,d){if(d=d||{},d.maxWidth&&d.maxHeight&&d.maxWindowWidthRate&&d.maxWindowHeightRate){var e={},f=d.maxWidth.lastIndexOf("px")==d.maxWidth.length-"px".length?d.maxWidth.substring(0,d.maxWidth.indexOf("px")):d.maxWidth,g=d.maxHeight.lastIndexOf("px")==d.maxHeight.length-"px".length?d.maxHeight.substring(0,d.maxHeight.indexOf("px")):d.maxHeight,h=b.innerWidth||c.documentElement.clientWidth||0,i=b.innerHeight||c.documentElement.clientHeight||0;h<(2-d.maxWindowWidthRate)*f?e.width=h*d.maxWindowWidthRate+"px":e.width=d.maxWidth,i<(2-d.maxWindowHeightRate)*g?e.height=i*d.maxWindowHeightRate+"px":e.height=d.maxHeight,L.css(a,e)}d.ignoreMargin||L.css(a,{"margin-top":"-"+(a.offsetHeight/2+(d.marginTop||0))+"px","margin-left":"-"+(a.offsetWidth/2+(d.marginLeft||0))+"px"})},L.setupModalEvents=function(a,d,e,f,g){f=f||{};var h=new n.channel.WindowChannel(d,e,self),i=function(){L.adjust(a,f),"function"==typeof g&&g()},j=function(a){var b,d=n.platform.visibilityPrefix;"string"==typeof d?b=0===d.length?c.visibilityState:c[d+"VisibilityState"]:"focus"===a.type?b="visible":"blur"===a.type&&(b="hidden"),h.notify("visibilitychange",{state:b})},k=b.innerHeight,l=1,m=setInterval(function(){b.innerHeight!==k&&(k=b.innerHeight,f.marginTop=l,L.adjust(a,f),l=-1*l)},500);return h.addNotifyListener("adjust_modal_visibility",function(b){var c=b.extra.visibility?1:0;setTimeout(function(){L.css(a,{opacity:c})},0)}),b.addEventListener("orientationchange",i),b.addEventListener("resize",i),"string"==typeof n.platform.visibilityPrefix?c.addEventListener(n.platform.visibilityPrefix+"visibilitychange",j):(b.addEventListener("focus",j),b.addEventListener("blur",j)),{dispose:function(){b.removeEventListener("orientationchange",i),b.removeEventListener("resize",i),"string"==typeof n.platform.visibilityPrefix?c.removeEventListener(n.platform.visibilityPrefix+"visibilitychange",j):(b.removeEventListener("focus",j),b.removeEventListener("blur",j)),clearInterval(m),h.dispose()}}},L.requestWithIframe=function(a){var b=c.createElement("iframe");b.src=a,c.body.appendChild(b),c.body.removeChild(b)},L.throttle=function(a,b){var c,d=Date.now(),e=function(){var f=Date.now(),g=f-d;clearTimeout(c),g>=b?(d=f,a()):c=setTimeout(function(){e(a,b)},b-g)};return e},L.css=function(a,b){var c=" ";Object.keys(b).forEach(function(a){c+=a+": "+String(b[a])+";"}),a.style.cssText+=c},L.addClass=function(a,b){""===a.className?a.className=b:a.className+=" "+b},L.getDocumentHeight=function(){var a=c;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))},n.chrome=L;var M={jsonpCallbacks:{},jsonpScriptElements:{},requestCount:0,tooManyRequestsThreshold:50};setInterval(function(){M.requestCount=0},1e3),M.reset=function(){this.jsonpCallbacks={},this.jsonpScriptElements={},n.util.resetSequence("http")},M.randomUniqueString=function(){return n.util.randomString(10)+n.util.nextSequence("http")},M.request=function(a,b){if(M.requestCount++>M.tooManyRequestsThreshold)return void b(new n.error.HTTPError({status:429,body:"Too many requests"}));var c=new XMLHttpRequest;if(c.onload=function(){var a,d=M.parseResponseHeaders(c.getAllResponseHeaders());if(!(200<=c.status&&c.status<=299)){try{a=JSON.parse(c.responseText)}catch(f){return void b(new n.error.HTTPError({status:c.status,headers:d,body:c.responseText}))}return void b(new n.error.HTTPError({status:c.status,headers:d,body:a}))}try{a=JSON.parse(c.responseText)}catch(f){return void b(e,{status:c.status,headers:d,body:c.responseText})}b(e,{status:c.status,headers:d,body:a})},c.onerror=function(a){var d,e=M.parseResponseHeaders(c.getAllResponseHeaders());try{d=JSON.parse(c.responseText)}catch(f){return void b(new n.error.HTTPError({status:a.target.status,headers:e,body:c.responseText}))}b(new n.error.HTTPError({status:a.target.status,headers:e,body:d}))},c.open(a.method,a.url,!0),a.withCredentials&&(c.withCredentials=a.withCredentials),Object.keys(a.headers).forEach(function(b){c.setRequestHeader(b,a.headers[b])}),c.setRequestHeader("X-Mobage-SDK-Name",n.SDK_NAME),c.setRequestHeader("X-Mobage-SDK-Version",n.SDK_VERSION),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"===a.method||"DELETE"===a.method)c.send();else{var d;try{d=JSON.stringify(a.parameters)}catch(f){return void b(new n.error.HTTPError({status:400,headers:null,body:"Invalid JSON request"}))}c.setRequestHeader("Content-Type","application/json"),c.send(d)}},M.parseResponseHeaders=function(a){return a.split("\n").map(function(a){var b=a.indexOf(":");return[a.substring(0,b),a.substring(b+1)]}).reduce(function(a,b){return b[0].length>0&&(a[b[0]]=b[1].trim()),a},{})},M.jsonp=function(a,b,c){var d=n.chrome.createInvisibleIframe("about:blank"),e=n.util.ensure(c,function(){d.dispose()}),f=d.window.document;d.iframe.onload=function(){"undefined"!=typeof f.x?(Array.prototype.unshift.call(f.x,null),e.apply(null,f.x)):e(new n.error.HTTPError({status:500,headers:{},body:"JSONP request failed for "+a}))},b.callback="cb";var g=a+"?"+n.util.encodeQuery(b);f.open().write('<script>function cb() { document.x = arguments; }</script><script src="'+g+'"></script>'),f.close()},n.http=M;var N={_q:[]};N.enqueue=function(a,b){this._q.push({req:a,cb:b})},N.dequeue=function(){return this._q.shift()},N.processAll=function(a){for(;this._q.length>0;){var b=this.dequeue(),c=n.storage.token.getTokens(a);c&&(b.req.headers.Authorization="Bearer "+c.access_token),n.http.request(b.req,b.cb)}},N.clear=function(){this._q=[]},n.apiqueue=N,b.addEventListener("load",function(){var a=n.util.decodeQuery(d.hash.substring(1)),c=a.parent_origin,e=new n.channel.WindowChannel(b.parent,a.parent_origin,b);e.addNotifyListener("provide_token",function(a){a.extra.parentOrigin=c,n.storage.token.setTokens(a.extra),n.apiqueue.processAll(a.extra)}),e.addNotifyListener("remove_token",function(a){a.extra.parentOrigin=c,n.storage.token.removeTokens(a.extra)}),e.addRequestListener("revoke_token",function(a){a.parameters.parentOrigin=c;var b=n.storage.token.getTokens(a.parameters);b?n.http.jsonp(n.endpoints.connect.jsonp_revoke,{token:b.access_token},function(b,c){e.response("revoke_token_response",a.id,{error:b,response:c})}):e.response("revoke_token_response",a.id,{error:{}})}),e.addRequestListener("api_request",function(a){var b,d=a.parameters;b=function(c,f){0===d.retryCount&&c&&401===c.code&&c.headers["WWW-Authenticate"]?(d.retryCount++,n.apiqueue.enqueue(d,b),e.notify("refresh_token")):e.response("api_response",a.id,{error:c,response:f})};var f=n.storage.token.getTokens({storage_suffix:d.options.storage_suffix,parentOrigin:c});return f||0!==d.retryCount?(d.headers.Authorization="Bearer "+f.access_token,void n.http.request(d,b)):(d.retryCount++,n.apiqueue.enqueue(d,b),void e.notify("refresh_token"))}),e.addNotifyListener("process_queued_requests",function(a){n.apiqueue.processAll(a.extra)}),e.addRequestListener("check_token_request",function(a){a.parameters.parentOrigin=c;var b=!!n.storage.token.getTokens(a.parameters);e.response("check_token_response",a.id,{haveToken:b})})})}(window,window,document,location);
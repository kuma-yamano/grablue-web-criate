define(["underscore","util/language"],function(a,b){var c=window.Game,d=window.createjs,e=function(){return c.imgUri+"/sp/"},f=function(a,b){var c=new d.Shape;return c.graphics.beginFill("#000000").drawRect(0,0,a,b),c},g=function(a){this.initialize(a)};g.prototype=new d.Bitmap,g.prototype.initialize=function(a){d.Bitmap.prototype.initialize.call(this,a);var b=this;this.image.onload=function(){var a=b.image;a&&(b.hitArea=f(a.width,a.height))}};var h=function(a,b){this.initialize(a,b)};h.prototype=new d.Sprite,h.prototype.initialize=function(a,b){d.Sprite.prototype.initialize.call(this,a,b);var c=this,e=c.getBounds();c.hitArea=f(e.width,e.height)};var i=function(){function a(a,b,c,d){this.initialize(a,b,c,d)}var b=32,e="FOT-ニューロダン Pro M, FOT-筑紫オールド明朝 Pro R, Average Sans, sans-serif",f="#FFD700",g="#a8fbff",h="#FFFF40",i="#d8d8d8",j="#150f0f",k=1,l=2,m=3,n=7,o="dispel",p=2,q=2,r=1,s=0,t=0,u=3,v=64,w=100,x=200,y=13,z=400,A=400,B="miss",C="resist",D="noeffect",E="dodge",F=a.prototype=new d.Container;return F.Container_initialize=F.initialize,F.initialize=function(a,b,d,e){this.Container_initialize(),this.spriteSheet=a,this.alpha=0,this.createIcon(b);var f;if(this.isMissStatus(b))f=b===D?x:w;else{this.createText(d,e);var g=this.getChildByName("text").getBounds()?this.getChildByName("text").getBounds().width:0;f=g/c.cjsScale+v}this.setBounds(0,0,f,null)},F.createIcon=function(a){if(null!==a){var b;if(this.isMissStatus(a))b=new d.Sprite(this.spriteSheet,a);else{var e=window.images["icon_status_"+a]||c.imgUri+"/sp/ui/icon/status/x64/status_"+a+".png";b=new d.Bitmap(e),b.name="bitmap"}this.addChild(b)}},F.isMissStatus=function(a){return a===B||a===C||a===D||a===E},F.createText=function(a,b){var c=this.instantiateText(!1,a,b);c.name="text";var d=this.instantiateText(!0,a,b);this.addChild(d),this.addChild(c)},F.instantiateText=function(a,c,f){var g="bold "+b+"px "+e;if(d.denaVersion){var h=a?j:this.getTextColor(f),i=new d.Text(c,g,h);return i.x=a?v+p:v,i.y=a?y+q:y,i._redraw=0,i}var h=a?"transparent":this.getTextColor(f),i=new d.Text(c,g,h);return i.x=v,i.y=y,i.lineWidth=null,a?i.shadow=new d.Shadow(j,s,t,u):i.shadow=new d.Shadow(j,p,q,r),i},F.getTextColor=function(a){var b;switch(a){case k:case n:b=f;break;case l:b=g;break;case m:b=h;break;case o:b=i;break;default:b=g}return b},F.show=function(){var a=this;a.alpha=1,a.visible=!0,d.Tween.get(a).wait(z).to({alpha:0},A).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])},a}(),j=function(){function f(a,b,c,d){this.initialize(a,b,c,d)}function i(a){return a/=100,a*=k,a=Math.round(a),a/=k}var j=0,k=1e3,l="l",m=20,n="FOT-ニューロダン Pro M, FOT-筑紫オールド明朝 Pro R, Average Sans, sans-serif",o="#f2eee2",p="#000",q=2,r=2,s=2,t=-1,u=-1,v=6,w=0,x=0,y=62,z=4,A=12,B=17,C=490,D=32,E=28,F=16,G=b.isJapanese()?258:235,H=34,I=54,J=7,K=62,L=32,M=28,N=32,O=62,P=105,Q=-5,R=5,S=55,T=92,U=2,V=5,W=-18,X=-12,Y=-8,Z=-7,_=-10,aa=3,ba=f.prototype=new d.Container;ba.Container_initialize=ba.initialize,ba.initialize=function(a,b,c,d){this.Container_initialize(),this.spriteSheet=a,this.isTarget=!1,this.isAlive=!0,this.pos=c,this.rare_flag=b.rare_flag;var e=b.enemy_id,f=aa===parseInt(b.modechange,10)&&!("enemy_8102203"===b.cjs&&0===+b.modeflag);this.hide(),this.createTarget(b.type,b.modeflag),this.createThumbnail(e),b.is_semi===!0&&b.switching_hp_gauge?this.createHPGauge(b.type,b.modeflag,b.hp,b.hpmax,b.type,4):this.createHPGauge(b.type,b.modeflag,b.hp,b.hpmax,b.type),this.createModeGauge(b.type,b.modeflag,b.modegauge,b.overdrive_image,b.modechange,b.isSamurai),this.createRecast(b.type,b.modeflag,b.recast,b.recastmax,f,b.no_special_flag),this.createCondition(b.type,b.condition.debuff,b.condition.buff,b.modechange,d)},ba.show=function(){this.isAlive&&(this.visible=!0,$("#enemy-name"+this.pos).show())},ba.hide=function(){this.visible=!1,$("#enemy-name"+this.pos).hide()},ba.remove=function(){this.removeAllChildren()},ba.createThumbnail=function(a){this.thumbnail=new g(e()+"assets/enemy/s/"+a+".png"),this.thumbnail.x=w,this.thumbnail.y=x,this.addChild(this.thumbnail),"1"===this.rare_flag&&(this.rareIcon=new h(this.spriteSheet,"rm_battle"),this.rareIcon.y=W,this.rareIcon.x=V,this.addChild(this.rareIcon))},ba.createHPGauge=function(a,b,c,d,a,e){this.hp=new ca(this.spriteSheet,c,d,a,e);var f=this.hp.getCurrentBarNumber(c,d);this.multiHpGaugeIndicator=new da(this.spriteSheet,e,f),this.hp.setMultiHpGaugeIndicator(this.multiHpGaugeIndicator),this.hp.createGauge(c,d,a),this.hp.x=y,this.setUIPositionY(a,b,this.hp,[B,z,A]),this.addChild(this.hp),this.multiHpGaugeIndicator.x=C,this.setUIPositionY(a,b,this.multiHpGaugeIndicator,[F,D,E]),this.addChild(this.multiHpGaugeIndicator)},ba.createModeGauge=function(a,b,c,d,e,f){void 0===b&&(b=0),j!==parseInt(b,10)&&(f===!0?this.mode=new fa(this.spriteSheet,c,d,e,a):this.mode=new ea(this.spriteSheet,c,d,e,a),this.setUIPositionY(a,b,this.mode,[H,J,0]),this.setUIPositionX(a,b,this.mode,[G,I,0]),this.addChild(this.mode))},ba.createRecast=function(a,b,c,d,e,f){this.recast=new ga(this.spriteSheet,parseInt(c,10),parseInt(d,10),e,f,a),this.recast.x=K,this.setUIPositionY(a,b,this.recast,[N,L,M]),this.addChild(this.recast)},ba.createCondition=function(a,b,c,d,e){var f=b.concat(c);this.condition=new ha(a,f,d,e),l===a?(this.condition.x=e?P:O,this.condition.y=Q):(this.condition.x=R,this.condition.y=S),this.addChild(this.condition)},ba.createText=function(a){var b=this.instantiateText(!0,a);this.addChild(b);var c=this.instantiateText(!1,a);this.text=c,this.addChild(c)},ba.instantiateText=function(a,b){var c=new d.Text(b,m+"px "+n,o);return c.lineWidth=null,c.x=T,c.y=U,a?c.shadow=new d.Shadow(p,t,u,v):c.shadow=new d.Shadow(p,q,r,s),c},ba.createTarget=function(a,b){var c,d;this.targeting=new ia(this.spriteSheet,a,b),l===a?(c=X,d=Y):(c=Z,d=_),this.targeting.x=c,this.targeting.y=d,this.targeting.hide(),this.addChild(this.targeting)},ba.markTarget=function(){this.isTarget=this.targeting.show()},ba.unmarkTarget=function(){null!==this.targeting&&(this.isTarget=this.targeting.hide())},ba.toggleTarget=function(){this.isTarget=this.targeting.toggle()},ba.setUIPositionY=function(a,b,c,d){l===a?c.y=d[0]:j!==parseInt(b,10)?c.y=d[1]:c.y=d[2]},ba.setUIPositionX=function(a,b,c,d){l===a?c.x=d[0]:j!==parseInt(b,10)?c.x=d[1]:c.x=d[2]},ba.changeThumbnail=function(a){this.removeChild(this.thumbnail),this.thumbnail=new g(e()+"assets/enemy/s/"+a+".png"),this.addChild(this.thumbnail)};var ca=function(){var b=416,e=135,f=8,g=100,j="#C2C2C2",k="#c7cebd",m=["#ee0000","#ffbb00","#0033ff","#770088"],n=-7,o=-12,p=6,q=4,r=6,s=4,t=2,u=[[100],[50,50],[33,34,33],[25,25,25,25]],v=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},w=v.prototype=new d.Container;return w.Container_initialize=w.initialize,w.initialize=function(a,b,c,d,e,f){this.Container_initialize(),this.spriteSheet=a,this.maxBarNum=e||1,this.currentBarNum=this.getCurrentBarNumber(b,c),this.hpBarDiff=[],this.hpBar=[],this.hpAddFlag=[],this.hpBarDiffChangeQueue=[],this.isChangingDiffBar=!1},w.setMultiHpGaugeIndicator=function(a){this.multiHpGaugeIndicator=a},w.createGauge=function(c,i,u){var v,w;l===u?(w="l",v=b):(w="s",v=e),this.hpBarBack=new h(this.spriteSheet,"gauge_hp_base_"+w),this.hpBarBack.y=o,this.hpBarBack.x=n;var x=this;a.each(a.range(x.maxBarNum),function(a){var b,c;c=new d.Graphics,c.beginFill(j).drawRect(0,0,v,f),x.hpBarDiff[a]=new d.Shape(c),x.hpBarDiff[a].setTransform(0,0,1,1,0,0,0,0,0),b=new d.Graphics,b.beginLinearGradientFill([k,m[a]],[0,1],0,0,0,f).drawRect(0,0,v,f),x.hpBar[a]=new d.Shape(b),x.hpBar[a].setTransform(0,0,1,1,0,0,0,0,0),x.hpBarDiff[a].y=q,x.hpBarDiff[a].x=p,x.hpBar[a].y=s,x.hpBar[a].x=r,x.hpBar[a].setScaleX(x.getScaleX(g)),x.hpBarDiff[a].setScaleX(x.getScaleX(g)),x.hpAddFlag[a]=!0});var y=l===u?b:e;this.indicationIconS1=new h(this.spriteSheet,"icon_gauge_s"),this.indicationIconS1.x=this.getIndicationIconX(y,25),this.indicationIconS2=new h(this.spriteSheet,"icon_gauge_s"),this.indicationIconS2.x=this.getIndicationIconX(y,75)-2,this.indicationIconL=new h(this.spriteSheet,"icon_gauge_l"),this.indicationIconL.x=this.getIndicationIconX(y,50),this.indicationIconS1.y=this.indicationIconS2.y=this.indicationIconL.y=t,l===u?(this.indicationIconS1.x=this.indicationIconS1.x-2,this.indicationIconS2.x=this.indicationIconS2.x-1,this.indicationIconL.x=this.indicationIconL.x-6):(this.indicationIconS1.x=this.indicationIconS1.x-2,this.indicationIconS2.x=this.indicationIconS2.x-2,this.indicationIconL.x=this.indicationIconL.x-5),this.show();var z=this.getPercent(c,i),A=this.getTargetBarPercent(c,i,this.currentBarNum);this.changeBar(z,A)},w.getPercent=function(a,b){return Math.min(Math.ceil(100*a/b,10),g)},w.getCurrentBarNumber=function(b,c){var d=u[this.maxBarNum-1],e=100*b/c,f=[],g=0;return a.each(d,function(a,b){g+=a,e>g&&f.push(a)}),f.length},w.getTargetBarPercent=function(b,c,d){var e=u[this.maxBarNum-1],f=100*b/c,h=0;return a.some(a.range(this.maxBarNum),function(a){return a===d?(h=e[a],!0):(f=f-=e[a],0>f&&(f=0),!1)}),Math.min(Math.ceil(100*f/h,10),g)},w.getIndicationIconX=function(a,b){var c=.01*b;return parseInt(a*c,10)},w.show=function(){this.addChild(this.hpBarBack);var b=this;a.each(a.range(b.maxBarNum),function(a){b.addChild(b.hpBarDiff[a],b.hpBar[a])}),this.addChild(this.indicationIconS1,this.indicationIconS2,this.indicationIconL)},w.getScaleX=i,w.change=function(b,e,f,g,h){var i=this.getPercent(b,e),j=this.getTargetBarPercent(b,e,this.currentBarNum),k=this.getScaleX(j),l=h||!1;(0===j||100===j)&&(this.changeBar(i,j),k=this.getScaleX(this.getTargetBarPercent(b,e,this.currentBarNum)));var m=$("#enemy-hp"+g);if(m.text(i),this.hpBar[this.currentBarNum].setScaleX(k),l===!1){var n=this.hpBar[this.currentBarNum].scaleX,o=this;d.Tween.get(this.hpBarDiff[this.currentBarNum]).to({scaleX:a.clone(n)},300,d.Ease.linear).call(function(){f&&1!=c.setting.cjs_mode&&d.Tween.get(o.hpBarDiff[o.currentBarNum]).to({scaleX:a.clone(n)},300,d.Ease.linear)})}else this.hpBarDiff[this.currentBarNum].setScaleX(k)},w.changeBar=function(b,c){var d=u[this.maxBarNum-1],e=0,f=!1,g=this;a.each(a.range(d.length),function(a){e+=d[a],e>=b&&!f?(f=!0,g.currentBarNum=a):f&&(g.hpAddFlag[a]=!1,g.removeChild(g.hpBar[a],g.hpBarDiff[a]),g.multiHpGaugeIndicator.removeEnemyMultiHPGaugeIndicator(g.multiHpGaugeIndicator,g.currentBarNum))})},v}(),da=function(){var b=20,c="hp_cell_on",e="hp_cell_off",f=function(a,b,c){this.initialize(a,b,c)},g=f.prototype=new d.Container;return g.Container_initialize=g.initialize,g.initialize=function(a,b,c){this.Container_initialize(),this.spriteSheet=a,this.maxBarNum=b,this.createEnemyMultiHPGaugeIndicator(b,c)},g.createEnemyMultiHPGaugeIndicator=function(d,f){this.hpIndicators=[];var g=this;this.colorIndex=f;var i=c,j=e;a.each(a.range(d-1),function(a,c){g.spriteHpIndicator=new h(g.spriteSheet,c<=g.colorIndex-1?i:j),g.spriteHpIndicator.x=a*b,g.hpIndicators.push(g.spriteHpIndicator),g.addChild(g.spriteHpIndicator)})},g.removeEnemyMultiHPGaugeIndicator=function(d,f){self=d;var g=c,i=e;a.each(a.range(self.maxBarNum-1),function(a,c){self.spriteHpIndicator=new h(self.spriteSheet,f-1>=c?g:i),self.spriteHpIndicator.x=a*b,self.hpIndicators.push(self.spriteHpIndicator),self.addChild(self.spriteHpIndicator)})},f}(),ea=function(){var c=2,f=72,j=6,k=b.isJapanese()?76:85,m=5,n=b.isJapanese()?76:85,o=7,p=b.isJapanese()?64:73,q=64,r=17,s=-15,t=-34,u=-15,v=-34,w=-32,x=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},y=x.prototype=new d.Container;return y.Container_initialize=y.initialize,y.initialize=function(a,b,c,d,e){this.Container_initialize(),this.spriteSheet=a,this.createGauge(b,c,d,e)},y.createGauge=function(b,c,d,i){var x,y,z,A,B,C,D,E,F;l===i?(x="",A="mode_gauge_yel.png",z=f,y=j,E=k,F=m,C=n,D=o):(x="_s",A="mode_gauge_yel_s.png",z=q,y=r,E=s,F=t,C=u,D=v),B="enemy_text_od",a.isEmpty(c)||(A="special_gauge_01.png",B="special_gauge_01_text",C=l===i?p:w),this.modeBack=new h(this.spriteSheet,"mode_gauge"+x),this.modeGauge=new g(e()+"raid/parts/"+A),this.modeGauge.x=this.modeBack.x+z,this.modeGauge.y=this.modeBack.y+y,this.modeGauge.scaleX=this.getScaleX(b),this.modeOverDrive=new h(this.spriteSheet,B),this.modeOverDrive.x=this.modeBack.x+C,this.modeOverDrive.y=this.modeBack.y+D,this.modeBreak=new h(this.spriteSheet,"enemy_text_break"),this.modeBreak.x=this.modeBack.x+E,this.modeBreak.y=this.modeBack.y+F,this.show(),this.changeMode(d)},y.show=function(){this.addChild(this.modeBack),this.addChild(this.modeGauge)},y.getScaleX=i,y.changeGauge=function(a){this.modeGauge.scaleX=this.getScaleX(a)},y.changeMode=function(a){a=parseInt(a,10),c===a?this.addChild(this.modeOverDrive):aa===a?(this.removeChild(this.modeOverDrive),this.addChild(this.modeBreak)):(this.removeChild(this.modeBreak),this.removeChild(this.modeOverDrive))},x}(),fa=function(){var b=2,c=40,f=8,j=42,k=8,l=220,m=0,n=65,o=7,p=50,q=80,r=.5,s=0,t=1,u=2,v=3,w=4,x=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},y=x.prototype=new d.Container;return y.Container_initialize=y.initialize,y.initialize=function(a,b,c,d,e){this.Container_initialize(),this.displayGauges=[],this.displayIcons=[],this.currentGaugeNum=null,this.currentGaugeType=s,this.spriteSheet=a,this.createGauge(b,c,d,e)},y.createGauge=function(a,b,d,i){this.modeGaugeNormal1=new g(e()+"raid/ui_modegauge_ss/gauge_normal_1.png"),this.modeGaugeNormal1.x=j,this.modeGaugeNormal1.y=k,this.modeGaugeNormal2=new g(e()+"raid/ui_modegauge_ss/gauge_normal_2.png"),this.modeGaugeNormal2.x=j,this.modeGaugeNormal2.y=k,this.modeGaugeOverDrive1=new g(e()+"raid/ui_modegauge_ss/gauge_od_1.png"),this.modeGaugeOverDrive1.x=j,this.modeGaugeOverDrive1.y=k,this.modeGaugeOverDrive2=new g(e()+"raid/ui_modegauge_ss/gauge_od_2.png"),this.modeGaugeOverDrive2.x=j,this.modeGaugeOverDrive2.y=k,this.modeBack=new g(e()+"raid/ui_modegauge_ss/gauge_base.png"),this.modeBack.x=c,this.modeBack.y=f,this.modeIconNormal=new g(e()+"raid/ui_modegauge_ss/icon_normal.png"),this.modeIconNormal.x=l,this.modeIconNormal.y=m,this.modeIconOverDrive1=new g(e()+"raid/ui_modegauge_ss/icon_od_1.png"),this.modeIconOverDrive1.x=l,this.modeIconOverDrive1.y=m,this.modeIconOverDrive2=new g(e()+"raid/ui_modegauge_ss/icon_od_2.png"),this.modeIconOverDrive2.x=l,this.modeIconOverDrive2.y=m,this.modeIconOverDrive3=new g(e()+"raid/ui_modegauge_ss/icon_od_3.png"),this.modeIconOverDrive3.x=l,this.modeIconOverDrive3.y=m,this.modeIconBreak=new g(e()+"raid/ui_modegauge_ss/icon_break.png"),this.modeIconBreak.x=l,this.modeIconBreak.y=m,this.modeBreak=new h(this.spriteSheet,"enemy_text_break"),this.modeBreak.x=n,this.modeBreak.y=o,this.show(d)},y.show=function(a){this.changeMode(a)},y.getScaleX=i,y.changeGauge=function(b){var c=this;this.currentGaugeNum=this.getScaleX(b),this.currentGaugeType!==v&&this.currentGaugeType!==w&&this.setNormalGauge(!0),a.each(this.displayGauges,function(a){a.scaleX=c.currentGaugeNum})},y.setNormalGauge=function(a){this.currentGaugeNum<r&&this.currentGaugeType!==t?(a&&this.removeGaugeBitmap(),this.displayGauges=[this.modeGaugeNormal1],this.addGaugeBitmap(),this.currentGaugeType=t):this.currentGaugeNum>=r&&this.currentGaugeType!==u&&(a&&this.removeGaugeBitmap(),this.displayGauges=[this.modeGaugeNormal2],this.addGaugeBitmap(),this.currentGaugeType=u)},y.changeMode=function(c){c=parseInt(c,10),this.removeIconBitmap(),this.removeChild(this.modeBreak),b===c?(this.removeGaugeBitmap(),this.displayGauges=[this.modeGaugeOverDrive1,this.modeGaugeOverDrive2],this.displayIcons=[this.modeIconOverDrive1,this.modeIconOverDrive2,this.modeIconOverDrive3],this.addGaugeBitmap(),this.currentGaugeType=v,this.addIconBitmap(),this.blinkIcons(),this.blinkGauges()):aa===c?(this.removeGaugeBitmap(),this.displayGauges=[this.modeGaugeNormal1],this.addGaugeBitmap(),this.currentGaugeType=w,this.displayIcons=[this.modeIconBreak],this.addIconBitmap(),this.addChild(this.modeBreak)):(a.isNull(this.currentGaugeNum)||this.setNormalGauge(!1),this.displayIcons=[this.modeIconNormal],this.addIconBitmap())},y.addGaugeBitmap=function(){var b=this;a.each(this.displayGauges,function(a){b.addChild(a)}),this.removeChild(this.modeBack),this.addChild(this.modeBack)},y.removeGaugeBitmap=function(){if(!(this.displayGauges.length<1)){var b=this;a.each(this.displayGauges,function(a){b.removeChild(a)}),this.displayGauges=[]}},y.blinkGauges=function(){var b=[[1,0],[0,1]];a.each(this.displayGauges,function(a,c){d.Tween.removeTweens(a),d.Tween.get(a,{loop:!0}).wait(1).to({alpha:b[c][0]},15).wait(p).to({alpha:b[c][1]},15).wait(p)})},y.addIconBitmap=function(){var b=this;a.each(this.displayIcons,function(a){b.addChild(a)})},y.removeIconBitmap=function(){if(!(this.displayIcons.length<1)){var b=this;a.each(this.displayIcons,function(a){b.removeChild(a)}),this.displayIcons=[]}},y.blinkIcons=function(){var b=[[1,0,0],[0,1,0],[0,0,1]];a.each(this.displayIcons,function(a,c){d.Tween.removeTweens(a),d.Tween.get(a,{loop:!0}).wait(1).to({alpha:b[c][0]},15).wait(q).to({alpha:b[c][1]},15).wait(q).to({alpha:b[c][2]},15).wait(q)})},x}(),ga=function(){var e=b.isJapanese()?19:20,f="enemy_cell_on",g="enemy_cell_off",i="enemy_cell_light",j="cell_on_break",k="cell_off_break",m=200,n=1,o=1,p=16,q="enemy_cell_on_s",r="enemy_cell_off_s",s="enemy_cell_light_s",t="cell_on_break_s",u="cell_off_break_s",v="text_ct",w="text_ct_s",x=2,y=4,z=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},A=z.prototype=new d.Container;return A.Container_initialize=A.initialize,A.initialize=function(a,c,d,h,m,n){this.Container_initialize(),this.spriteSheet=a,this.currentRecast=c,this.maxRecast=d,this.isDisable=h,this.noSpecialFlag=m,this.imgWidth=e,this.recastOn=f,this.recastOff=g,this.recastLight=i,this.recastBreakOn=j,this.recastBreakOff=k,this.labelChargeTurn=v,b.isJapanese()&&n!==l&&(this.imgWidth=p,this.recastOn=q,this.recastOff=r,this.recastLight=s,this.recastBreakOn=t,this.recastBreakOff=u,this.labelChargeTurn=w),this.isProcessing()&&this.createRecast(c)},A.changeRecast=function(a,b){return this.isProcessing()&&(a>this.currentRecast||b!==this.maxRecast)?(this.removeAllChildren(),this.currentRecast=a,this.maxRecast=b,this.createRecast(a),!0):!1},A.createRecast=function(e){this.recasts=[],this.alreadyBlinked=!1;var f,g,i=this,j=this.maxRecast-e-1;this.isDisable?(f=this.recastBreakOn,g=this.recastBreakOff):(f=this.recastOn,g=this.recastOff);var k=0;if(b.isJapanese()){var l=new d.Sprite(this.spriteSheet,this.labelChargeTurn);this.labelChargeTurn===v&&(l.y=x),this.addChild(l);var m=l.getBounds(),n=d.denaVersion?1:c.cjsScale;k=m.width/n-y}a.each(a.range(this.maxRecast-1),function(a,b){var c=new h(i.spriteSheet,j>=b?f:g);c.x=k+a*i.imgWidth,i.recasts.push(c),i.addChild(c)}),this.isBlink(e)&&!1===this.isDisable&&this.blinkRecast()},A.colorRecast=function(a,b){if(this.isProcessing()){var c;if(a=parseInt(a,10),b=parseInt(b,10),!this.changeRecast(a,b))if(this.currentRecast=a,this.isBlink(a)&&!1===this.isDisable)this.blinkRecast();else{if(c=this.maxRecast-this.currentRecast-1,0>c)this.clearRecast();else for(var e=c;e>=0;e--)d.denaVersion&&d.Tween.removeTweens(this),"undefined"!=typeof this.recasts[e]&&this.recasts[e].gotoAndStop(this.isDisable?this.recastBreakOn:this.recastOn);this.alreadyBlinked=!1}}},A.isBlink=function(a){return this.isProcessing()?n===a?!0:!1:void 0},A.blinkRecast=function(){if(this.isProcessing()&&!this.alreadyBlinked){if(d.denaVersion)return d.Tween.removeTweens(this),d.Tween.get(this,{loop:!0}).wait(m).call(function(){if(n==this.currentRecast)for(var a=this.recasts.length,b=0;a>b;++b)this.recasts[b].gotoAndStop(this.recastLight)}).wait(m).call(function(){if(n==this.currentRecast)for(var a=this.recasts.length,b=0;a>b;++b)this.recasts[b].gotoAndStop(this.recastOn)}),void(this.alreadyBlinked=!0);var b=this;a.each(this.recasts,function(a){d.Tween.get(a,{loop:!0}).wait(m).call(function(){this.gotoAndStop(b.recastLight)}).wait(m).call(function(){this.gotoAndStop(b.recastOn)})}),this.alreadyBlinked=!0}},A.enableRecast=function(){if(this.isProcessing()){var b=this.maxRecast-this.currentRecast;if(d.denaVersion){d.Tween.removeTweens(this);for(var c=this.recasts.length,e=0;c>e;++e)this.recasts[e].gotoAndStop(b>e?this.recastOn:this.recastOff);return n===this.currentRecast&&this.blinkRecast(),void(this.isDisable=!1)}var f=this;a.each(this.recasts,function(a,c){d.Tween.removeTweens(a),a.gotoAndStop(b>c?f.recastOn:f.recastOff)}),n===this.currentRecast&&this.blinkRecast(),this.isDisable=!1}},A.disableRecast=function(){if(this.isProcessing()){var b=this.maxRecast-this.currentRecast;if(d.denaVersion){d.Tween.removeTweens(this);for(var c=this.recasts.length,e=0;c>e;++e)this.recasts[e].gotoAndStop(b>e?this.recastBreakOn:this.recastBreakOff);return this.isDisable=!0,void(this.alreadyBlinked=!1)}var f=this;a.each(this.recasts,function(a,c){d.Tween.removeTweens(a),a.gotoAndStop(b>c?f.recastBreakOn:f.recastBreakOff)}),this.isDisable=!0,this.alreadyBlinked=!1}},A.clearRecast=function(){if(this.isProcessing()){if(this.currentRecast=this.maxRecast,d.denaVersion){d.Tween.removeTweens(this);for(var b=this.recasts.length,c=0;b>c;++c)this.recasts[c].gotoAndStop(this.isDisable?this.recastBreakOff:this.recastOff);return void(this.alreadyBlinked=!1)}var e=this;a.each(this.recasts,function(a){d.Tween.removeTweens(a),a.gotoAndStop(this.isDisable?e.recastBreakOff:e.recastOff)}),this.alreadyBlinked=!1}},A.isProcessing=function(){return o===this.noSpecialFlag?!1:!0},z}(),ha=function(){var b=.4,c=.4,f=24,h=24,i=1e3,j=8,k=18,m=16,n=[1055,1056],o=2,p=1,q=function(a,b,c,d){this.initialize(a,b,c,d)},r=q.prototype=new d.Container;return r.Container_initialize=r.initialize,r.initialize=function(a,b,c,d){this.Container_initialize();var e=d?m:k;this.maxLen=l===a?e:j,this.rowNum=l===a?p:o,this.showConditionGroupNum=0,this.beforeConditionGroupNum=0,this.setCondition(b,c),this.setConditionGroupList(),this.show(),this.blinkCondition()},r.setCondition=function(b,c){var d,e,f,g=c||0,h=[];a.isEmpty(b)?(e=[],f=[]):(e=a.isNull(b.buff)?[]:b.buff,f=a.isNull(b.debuff)?[]:b.debuff,d=void 0===b.buff||void 0===b.debuff?b:f.concat(e)),a.each(d,function(b){var c=!0;a.every(h,function(a){return a.status===b.status?(c=!1,!1):!0}),c&&h.push(b)}),aa!=g&&(h=a.reject(h,function(b){return a.some(n,function(a){return+a==+b.status})})),this.conditions=h,this.removeAllChildren(),this.setConditionGroupList()},r.setConditionGroupList=function(){var d=this.maxLen-1,f=[];this.conditionGroupList=[];var h=this;a.each(this.conditions,function(a,i){var j=new g(e()+"ui/icon/status/x64/status_"+a.status+".png");j.scaleX=b,j.scaleY=c,f.push(j),(1===h.maxLen||i%h.maxLen===d)&&(h.conditionGroupList.push(f),f=[])}),f.length&&this.conditionGroupList.push(f)},r.show=function(){if(!(this.conditionGroupList.length<=0)){var b=this;a.each(a.range(b.rowNum),function(c){if(b.conditionGroupList[b.showConditionGroupNum+c]){var d=c*h;a.each(b.conditionGroupList[b.showConditionGroupNum+c],function(a,c){a.y=d,a.x=c*f,b.addChild(a)})}})}},r.showBlinkCondition=function(){var b=this;a.each(a.range(b.rowNum),function(a){b.removeChild.apply(b,b.conditionGroupList[b.beforeConditionGroupNum+a])}),this.show()},r.blinkCondition=function(){if(!(this.conditionGroupList.length<=1)){d.Tween.removeTweens(this);var a=this;d.Tween.get(this,{loop:!0}).wait(i).call(function(){a.beforeConditionGroupNum=a.showConditionGroupNum,a.showConditionGroupNum+=a.rowNum,a.showConditionGroupNum>=a.conditionGroupList.length&&(a.showConditionGroupNum=0),a.showBlinkCondition()})}},q}(),ia=function(){var a=220,b=-15,c=80,e=-17,f=function(a,b,c){this.initialize(a,b,c)},g=f.prototype=new d.Container;return g.Container_initialize=g.initialize,g.initialize=function(a,b,c){this.Container_initialize(),this.spriteSheet=a,this.type=b,this.modeflag=c,this.createSprite(b)},g.createSprite=function(){var f,g,h;l===this.type?(f="gauge_target_l",g=a,h=b):(f="gauge_target_s",g=c,h=e);var i=new d.Sprite(this.spriteSheet,f);this.addChild(i),this.IndicatorSprite=new d.Sprite(this.spriteSheet,"deco_target"),this.IndicatorSprite.x=g,this.IndicatorSprite.y=h,this.addChild(this.IndicatorSprite)},g.show=function(){return this.visible=!0,!0},g.hide=function(){return this.visible=!1,!1},g.showIndicator=function(){l!==this.type&&j!==parseInt(this.modeflag,10)&&(this.IndicatorSprite.visible=!0)},g.hideIndicator=function(){l!==this.type&&j!==parseInt(this.modeflag,10)&&(this.IndicatorSprite.visible=!1)},g.toggle=function(){var a;return a=this.visible?this.hide():this.show()},f}();return f}(),k=function(){var b=.5,c=.5,f=32,h=32,i=2,j=[{x:6,y:100},{x:6,y:126},{x:6,y:210}],k=2,l=function(a){this.initialize(a)},m=l.prototype=new d.Container;return m.Container_initialize=m.initialize,m.initialize=function(a){this.Container_initialize(),this.positionNum=+a-1,this.x=j[this.positionNum].x,this.y=j[this.positionNum].y},m.setCondition=function(d){var f=[],h=this;this.fieldConditionList=[],a.isEmpty(d)||(a.each(d,function(b){var c=!0;a.every(f,function(a){return+a.status===+b.status?(c=!1,!1):!0}),c&&f.push(b)}),this.removeAllChildren(),a.each(f,function(a){var d=new g(e()+"ui/icon/field_effect/status_"+a.status+".png");d.scaleX=b,d.scaleY=c,h.fieldConditionList.push(d)}),this.addConditionIcons())},m.addConditionIcons=function(){if(!(1>this.fieldConditionList.length)){var b=this;a.each(this.fieldConditionList,function(a,c){if(i>b.positionNum)if(c>1){var d=c%2!==0?1:0,e=Math.floor(c/k);a.x=d*f,a.y=e*h}else a.x=c*f,a.y=0;else a.x=0,a.y=c*h;b.addChild(a)}),this.show()}},m.removeCondition=function(){this.removeAllChildren(),this.hide()},m.show=function(){this.visible=!0},m.hide=function(){this.visible=!1},l}(),l=function(){var b=.5,c=.5,f=32,h={x:78,y:145},i=function(){this.initialize()},j=i.prototype=new d.Container;return j.Container_initialize=j.initialize,j.initialize=function(){this.Container_initialize(),this.x=h.x,this.y=h.y},j.setCondition=function(d){var f=[],h=this;this.AssistUnitConditionList=[],a.isEmpty(d)||(a.each(d,function(b){var c=!0;a.every(f,function(a){return+a.image===+b.image?(c=!1,!1):!0}),c&&f.push(b)}),this.removeAllChildren(),a.each(f,function(a){var d=new g(e()+"ui/icon/status/defendorder/"+a.image+"_"+ +a.status+".png");d.scaleX=b,d.scaleY=c,h.AssistUnitConditionList.push(d)}),this.addConditionIcons())},j.addConditionIcons=function(){if(!(1>this.AssistUnitConditionList.length)){var b=this;a.each(this.AssistUnitConditionList,function(a,c){a.x=c*f,b.addChild(a)}),this.show()}},j.removeCondition=function(){this.removeAllChildren(),this.hide()},j.show=function(){this.visible=!0},j.hide=function(){this.visible=!1},i}(),m=function(){function b(a,b){this.initialize(a,b)}var c=44,e=13,f=1.2,g=.5,h=.8,i=10,j=-10,k=Math.round(h/g*10)/10,l=-10,m=-10,n=-20,o=-20*k,p=100,q=250,r=300,s=800,t=300,u=500,v=-30,w=b.prototype=new d.Container;return w.Container_initialize=w.initialize,w.initialize=function(a,b){this.Container_initialize(),this.spriteSheet=a,this.attributeId=b.attributeId,this.numSplit=b.num,this.size=b.size,this.isTotal=b.isTotal||!1,this.alpha=0,this.isCritical=b.isCritical,this.isGuard=b.isGuard||!1,this.create()},w.create=function(){var b,f,g,h,i,j,p=this;99===parseInt(p.attributeId,10)?(j="heal_",p.size="m"):j="damage"+p.attributeId+"_l_",a.each(p.numSplit,function(a,b){"-"!==a&&(g=new d.Sprite(p.spriteSheet,j+a),1===parseInt(a,10)?g.x=c*b+e:g.x=c*b,p.addChild(g))}),b=p.getBounds(),p.regX=b.width/2,p.regY=b.height/2,p.numSplit.length>=7&&(p.regX+=v),p.isTotal?(f=new d.Sprite(p.spriteSheet,"text_total"+p.attributeId),f.name="total",f.y=l,f.alpha=0,p.addChild(f)):p.isGuard===!0?(f=new d.Sprite(p.spriteSheet,"text_guard"+p.attributeId),f.name="guard",f.y=o,f.visible=!0,f.scaleX=f.scaleY=k,p.addChild(f),p.size="s"):"l"===p.size&&(p.isCritical?(f=new d.Sprite(p.spriteSheet,"text_critical"+p.attributeId),f.name="weakpoint",f.y=n):(f=new d.Sprite(p.spriteSheet,"text_weakpoint"+p.attributeId),f.name="weakpoint",f.y=m),f.visible=!1,p.addChild(f),i=p.numSplit.length-1,h=new d.Sprite(p.spriteSheet,"damage"+p.attributeId+"_l_attention"),h.x=c*i+c,p.addChild(h))},w.show=function(){var a=this;a.alpha=0,a.visible=!0;var b=0;"s"===a.size?(b=i,a.scaleX=a.scaleY=g):"m"===a.size&&(b=j,a.scaleX=a.scaleY=h);var c=3*b;a.isTotal?(a.alpha=1,d.Tween.get(a).call(function(){a.getChildByName("total").alpha=1}).to({scaleX:f,scaleY:f},0).to({scaleX:1,scaleY:1},r,d.Ease.cubicIn).wait(s).to({alpha:0},q,d.Ease.cubicOut).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])):"l"===a.size?(a.alpha=1,d.Tween.get(a).to({scaleX:f,scaleY:f},0).call(function(){a.getChildByName("weakpoint").visible=!0}).to({scaleX:1,scaleY:1},r,d.Ease.cubicIn).wait(t).to({alpha:0},q,d.Ease.cubicOut).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])):d.Tween.get(a).to({y:a.y+b,alpha:1},p).wait(u).to({y:a.y+c,alpha:0},q,d.Ease.cubicOut).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])},b}(),n=function(){function b(a,b){this.initialize(a,b)}var c=40,e=13,f=500,g=500,h=b.prototype=new d.Container;return h.Container_initialize=h.initialize,h.initialize=function(a,b){this.Container_initialize(),this.spriteSheet=a,this.alpha=0,this.createSprite(b)},h.createSprite=function(b){var f,g=this;f=a.isArray(b)?b:b.toString().split(""),a.each(f,function(a,b){if("-"!==a){var f=new d.Sprite(g.spriteSheet,"heal_"+a);1===parseInt(a,10)?f.x=c*b+e:f.x=c*b,g.addChild(f)}});var h=g.getBounds();g.regX=h.width/2,g.regY=h.height/2},h.show=function(){var a=this;a.alpha=1,a.visible=!0,d.Tween.get(a).wait(f).to({alpha:0},g).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])},b}(),o=function(){function b(a,b,c){this.initialize(a,b,c)}var c=75,e=28,f=52,g=28,h=40,i=20,j=15,k=400,l=800,m=400,n=b.prototype=new d.Container;return n.Container_initialize=n.initialize,n.initialize=function(a,b,d){this.Container_initialize(),this.spriteSheet=a,this.alpha=0;var j,k,l=d.toString().split("");switch(b){case"exp":j=c,k=e;break;case"rp":j=f,k=g;break;case"lupi":j=h,k=i}this.createSprite(b,l,j,k)},n.createSprite=function(b,c,e,f){var g=this,h=new d.Sprite(g.spriteSheet,"prefix_"+b);h.y="exp"===b||"rp"===b?j:0,g.addChild(h),a.each(c,function(a,c){var h=new d.Sprite(g.spriteSheet,b+"_"+a);h.x=e+f*c,g.addChild(h)});var i=g.getBounds();g.regX=i.width/2,g.regY=i.height/2},n.show=function(){var a=this;a.visible=!0,d.Tween.get(a).to({scaleX:.2,scaleY:.2,alpha:1},0).to({scaleX:1,scaleY:1},k,d.Ease.cubicIn).wait(l).to({alpha:0},m,d.Ease.cubicOut).call(function(){a.visible=!1}).call(this.dispatchEvent,["animationEnd"])},b}(),p=function(){function b(a){this.initialize(a)}var f=0,g=193,h=-60,i=1,j=100,k=300,l=5,m=50,n=4,o=3,p=50,q=.7,r=3,s=b.prototype=new d.Container;return s.Container_initialize=s.initialize,s.initialize=function(a){this.isSmallSize=2===a,this.Container_initialize(),this.createBG(!0),this.icons=[],this.gIconPaths=[],this.removing=!1,this.adding=!1,this.imgCache={}},s.createBG=function(a){if(!this.bgImg){this.bgImg=new d.Bitmap(e()+"raid/command/task_rail.png");var b=this.isSmallSize?i*q:i;this.bgImg.scaleX=b,this.bgImg.scaleY=b,this.addChild(this.bgImg)}this.x=a===!0?h:f,this.y=g},s.visualize=function(){d.Tween.get(this,{override:!0}).to({x:f},j)},s.invisualize=function(){d.Tween.get(this).to({x:h},j).call(this.dispatchEvent,["removeEnd"])},s.show=function(){this.alpha=1,this.visible=!0,this.removeAllIconChild(),this.createBG(!0),this.visualize()},s.hide=function(){this.alpha=1,this.visible=!0,this.removeAllIconChild(),this.adding=!1,this.removing=!1,this.gIconPaths=[],this.invisualize()},s.updateIcon=function(a,b){if(b=b||!1,!this.removing&&!this.adding){if(void 0===a||0===a.length)return void this.hide();if(1===+c.setting.cjs_mode&&this.x===h?(this.createBG(!0),this.visualize()):this.createBG(),b===!1){this.removeAllIconChild();for(var d=a.length>l?l:a.length,e=0;d>e;e++){var f=this.createIcon(e,a[e]);this.addChild(f),this.icons.push(f)}this.gIconPaths=a}}},s.addIcon=function(a,b){var c=this;if(this.gIconPaths.push(b),!(this.icons.length>=l)){this.adding=!0,(0===this.icons.length||void 0===this.icons)&&this.show();var a=this.removing===!0?this.gIconPaths.length:this.gIconPaths.length-1,e=!this.removing,f=this.createIcon(a,b);
f.x=h,this.addChild(f),this.icons.push(f),d.Tween.get(f).to({x:this.isSmallSize?r:n},j,d.Ease.cubicInOut).call(function(){c.adding=!1,c.updateIcon(c.gIconPaths,e)})}},s.removeIcon=function(a,b){var c=this;this.gIconPaths=b,this.gIconPaths.splice(a,1),this.removing=!0,d.Tween.get(this.icons[a]).to({alpha:0},k,d.Ease.cubicInOut).call(function(){c.removing=!1,c.updateIcon(c.gIconPaths,!1)})},s.removeAllIconChild=function(){for(var a in this.icons)this.removeChild(this.icons[a]);this.icons=[]},s.createIcon=function(b,f){var g,h=this,i=function(a){var b=h.isSmallSize?m*q:m;a.scaleX=b/a.image.naturalWidth*c.cjsScale,a.scaleY=b/a.image.naturalHeight*c.cjsScale};if(this.imgCache[f])g=new d.Bitmap(this.imgCache[f]),i(g),g.visible=!0;else{var j=e()+"ui/icon/ability/m/"+f+".png";g=new d.Bitmap(j),g.visible=!1,g.image.onload=function(){var b=a.filter(h.icons,function(a){return a.image===g.image});a.each(b,function(a){i(a),a.visible=!0}),h.imgCache[f]=g.image}}var k=this.isSmallSize?p*q:p;return g.x=this.isSmallSize?r:n,g.y=o+k*b,g.alpha=1,g},b}(),q=function(){var a=400,b=400,c={},f={},g={ja:-68,en:-100},h={ja:-120,en:-116},i=function(a,b){this.initialize(a,b)},j=i.prototype=new d.Container;return j.Container_initialize=j.initialize,j.initialize=function(a,b){this.Container_initialize(),this.x=0,this.y=0,this.defaultPlayerPosition=b,this.adjustPositionX=g[a],this.adjustPositionY=h[a],this.createBitmaps()},j.createBitmaps=function(){for(var a=0;4>a;a++)c[a]=new d.Bitmap(e()+"raid/ui_special_skip/special_skip_on.png"),c[a].x=this.defaultPlayerPosition[a].x+this.adjustPositionX,c[a].y=this.defaultPlayerPosition[a].y+this.adjustPositionY,c[a].alpha=0,this.addChild(c[a]),f[a]=new d.Bitmap(e()+"raid/ui_special_skip/special_skip_off.png"),f[a].x=this.defaultPlayerPosition[a].x+this.adjustPositionX,f[a].y=this.defaultPlayerPosition[a].y+this.adjustPositionY,f[a].alpha=0,this.addChild(f[a])},j.show=function(e,g){var h;h=1===e?c[g]:f[g],d.Tween.removeTweens(h),d.Tween.get(h,{override:!0}).to({alpha:1}).wait(b).to({alpha:0},a)},j.changePosition=function(a,b){c[a].x=b.x+this.adjustPositionX,c[a].y=b.y+this.adjustPositionY,f[a].x=b.x+this.adjustPositionX,f[a].y=b.y+this.adjustPositionY},i}(),r=function(){var a,b,c=395,f=475,g=200,h=100,i=function(){this.initialize()},j=i.prototype=new d.Container;return j.Container_initialize=j.initialize,j.initialize=function(){this.Container_initialize(),this.x=c,this.y=f,a=new d.Bitmap(e()+"raid/ui_button_attack_cancel/button_attack_cancel.png"),a.x=0,a.y=0,a.alpha=0,this.addChild(a),b=new d.Bitmap(e()+"raid/ui_button_attack_cancel/button_attack_cancel_on.png"),b.x=0,b.y=0,b.alpha=0,this.addChild(b)},j.show=function(){d.Tween.removeTweens(a),a.visible=!0,a.alpha=0,d.Tween.get(a,{override:!0}).wait(h).to({alpha:1},g),d.Tween.removeTweens(b),b.alpha=0,b.visible=!1},j.hide=function(){d.Tween.removeTweens(a),a.alpha=0,a.visible=!1,d.Tween.removeTweens(b),b.alpha=1,b.visible=!0,d.Tween.get(b,{override:!0}).to({alpha:0},g).call(function(){b.visible=!1})},i}(),s={utils:{getImagePath:e},components:{OverheadMessage:i,EnemyStatus:j,FieldCondition:k,AssistUnitCondition:l,Damage:m,Heal:n,EnemyReward:o,abilityRail:p,SpecialSkipSetEffect:q,AttackCancelButton:r}};return s});
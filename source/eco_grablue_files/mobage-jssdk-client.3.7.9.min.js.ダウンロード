/* build env: jpse, client version: 3.7.9, xdframe version: 2.0, date: 2019-08-23 05:30, tag:  */
!function(o,I,D,f,y){"use strict";!function(e){var p=function(){function e(e){this.options=e}return e.prototype.toString=function(){return JSON&&JSON.stringify?JSON.stringify(this.options):this.options},e}(),d=function(){function i(e){return"function"==typeof Object.freeze?function(e){if("object"!=typeof e||null===e)return e;var t,n;for(n in Object.freeze(e),e)e.hasOwnProperty(n)&&"object"==typeof(t=e[n])&&i(t);return e}(e):e}return{isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isString:function(e){return"[object String]"===Object.prototype.toString.apply(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.apply(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.apply(e)},join:function(e,t){var n,i="",o=!0;for(n=0;n<e.length;n+=1)o?o=!1:i+=t,i+=e[n];return i},map:function(e,t){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n},filter:function(e,t){for(var n=[],i=0;i<e.length;i+=1)t(e[i])&&n.push(e[i]);return n},deepFreeze:i}}(),l=function(){function t(e){return"0"<=e&&e<="9"}return{isAlpha:function(e){return"a"<=e&&e<="z"||"A"<=e&&e<="Z"},isDigit:t,isHexDigit:function(e){return t(e)||"a"<=e&&e<="f"||"A"<=e&&e<="F"}}}(),g=function(){var r=function(e){return unescape(encodeURIComponent(e))},s=function(e){return e<=127?1:194<=e&&e<=223?2:224<=e&&e<=239?3:240<=e&&e<=244?4:0},a=function(e){return 128<=e&&e<=191};function c(e,t){return"%"===e.charAt(t)&&l.isHexDigit(e.charAt(t+1))&&l.isHexDigit(e.charAt(t+2))}function u(e,t){return parseInt(e.substr(t,2),16)}return{encodeCharacter:function(e){var t,n,i="",o=r(e);for(n=0;n<o.length;n+=1)i+="%"+((t=o.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},isPctEncoded:function(e){if(!c(e,0))return!1;var t=u(e,1),n=s(t);if(0===n)return!1;for(var i=1;i<n;i+=1)if(!c(e,3*i)||!a(u(e,3*i+1)))return!1;return!0},pctCharAt:function(e,t){var n=e.charAt(t);if(!c(e,t))return n;var i=u(e,t+1),o=s(i);if(0===o)return n;for(var r=1;r<o;r+=1)if(!c(e,t+3*r)||!a(u(e,t+3*r+1)))return n;return e.substr(t,3*o)}}}(),h={isVarchar:function(e){return l.isAlpha(e)||l.isDigit(e)||"_"===e||g.isPctEncoded(e)},isUnreserved:function(e){return l.isAlpha(e)||l.isDigit(e)||"-"===e||"."===e||"_"===e||"~"===e},isReserved:function(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}},m=function(){function t(e,t){var n,i="",o="";for("number"!=typeof e&&"boolean"!=typeof e||(e=e.toString()),n=0;n<e.length;n+=o.length)o=e.charAt(n),i+=h.isUnreserved(o)||t&&h.isReserved(o)?o:g.encodeCharacter(o);return i}return{encode:t,encodePassReserved:function(e){return t(e,!0)},encodeLiteral:function(e){var t,n="",i="";for(t=0;t<e.length;t+=i.length)1<(i=g.pctCharAt(e,t)).length?n+=i:n+=h.isReserved(i)||h.isUnreserved(i)?i:g.encodeCharacter(i);return n},encodeLiteralCharacter:function(e,t){var n=g.pctCharAt(e,t);return 1<n.length?n:h.isReserved(n)||h.isUnreserved(n)?n:g.encodeCharacter(n)}}}(),f=function(){var t={};function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?m.encodePassReserved:m.encode,toString:function(){return this.symbol}}}return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){return t[e]?t[e]:0<="=,!@|".indexOf(e)?null:t[""]}}}();function _(e){var t;if(null===e||e===y)return!1;if(d.isArray(e))return 0<e.length;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(t in e)if(e.hasOwnProperty(t)&&_(e[t]))return!0;return!1}var t,a=function(){function e(e){this.literal=m.encodeLiteral(e)}return e.prototype.toString=e.prototype.expand=function(){return this.literal},e}(),n=function(){function s(n){var e,i,t=[],o=null,r=null,s=null,a="";function c(){var e=n.substring(r,i);if(0===e.length)throw new p({expressionText:n,message:"a varname must be specified",position:i});o={varname:e,exploded:!1,maxLength:null},r=null}function u(){if(s===i)throw new p({expressionText:n,message:"after a ':' you have to specify the length",position:i});o.maxLength=parseInt(n.substring(s,i),10),s=null}for(e=function(e){var t=f.valueOf(e);if(null===t)throw new p({expressionText:n,message:"illegal use of reserved operator",position:i,operator:e});return t}(n.charAt(0)),i=e.symbol.length,r=i;i<n.length;i+=a.length){if(a=g.pctCharAt(n,i),null!==r){if("."===a){if(r===i)throw new p({expressionText:n,message:"a varname MUST NOT start with a dot",position:i});continue}if(h.isVarchar(a))continue;c()}if(null!==s){if(i===s&&"0"===a)throw new p({expressionText:n,message:"A :prefix must not start with digit 0",position:i});if(l.isDigit(a)){if(4<=i-s)throw new p({expressionText:n,message:"A :prefix must have max 4 digits",position:i});continue}u()}if(":"!==a)if("*"!==a){if(","!==a)throw new p({expressionText:n,message:"illegal character",character:a,position:i});t.push(o),o=null,r=i+1}else{if(null===o)throw new p({expressionText:n,message:"exploded without varspec",position:i});if(o.exploded)throw new p({expressionText:n,message:"exploded twice",position:i});if(o.maxLength)throw new p({expressionText:n,message:"an explode (*) MUST NOT follow to a prefix",position:i});o.exploded=!0}else{if(null!==o.maxLength)throw new p({expressionText:n,message:"only one :maxLength is allowed per varspec",position:i});if(o.exploded)throw new p({expressionText:n,message:"an exploeded varspec MUST NOT be varspeced",position:i});s=i+1}}return null!==r&&c(),null!==s&&u(),t.push(o),new v(n,e,t)}return function(t){var e,n,i=[],o=null,r=0;for(e=0;e<t.length;e+=1)if(n=t.charAt(e),null===r){if(null===o)throw new Error("reached unreachable code");if("{"===n)throw new p({templateText:t,message:"brace already opened",position:e});if("}"===n){if(o+1===e)throw new p({templateText:t,message:"empty braces",position:o});try{i.push(s(t.substring(o+1,e)))}catch(e){if(e.prototype===p.prototype)throw new p({templateText:t,message:e.options.message,position:o+e.options.position,details:e.options});throw e}o=null,r=e+1}}else{if("}"===n)throw new p({templateText:t,message:"unopened brace closed",position:e});"{"===n&&(r<e&&i.push(new a(t.substring(r,e))),r=null,o=e)}if(null!==o)throw new p({templateText:t,message:"unclosed brace",position:o});return r<t.length&&i.push(new a(t.substr(r))),new c(t,i)}}(),v=function(){function a(e){if(!_(e))return!0;if(d.isString(e))return""===e;if(d.isNumber(e)||d.isBoolean(e))return!1;if(d.isArray(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function r(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push({name:t,value:e[t]});return n}function e(e,t,n){this.templateText=e,this.operator=t,this.varspecs=n}function c(e,t,n){var i="";if(n=n.toString(),t.named){if(i+=m.encodeLiteral(e.varname),""===n)return i+=t.ifEmpty;i+="="}return null!==e.maxLength&&(n=n.substr(0,e.maxLength)),i+=t.encode(n)}function s(e){return _(e.value)}function u(e,t,n){var i=[],o="";if(t.named){if(o+=m.encodeLiteral(e.varname),a(n))return o+=t.ifEmpty;o+="="}return d.isArray(n)?(i=n,i=d.filter(i,_),i=d.map(i,t.encode)):(i=r(n),i=d.filter(i,s),i=d.map(i,function(e){return t.encode(e.name)+","+t.encode(e.value)})),o+=d.join(i,",")}function p(n,i,e){var t=[];return d.isArray(e)?(t=e,t=d.filter(t,_),t=d.map(t,function(e){var t=m.encodeLiteral(n.varname);return a(e)?t+=i.ifEmpty:t+="="+i.encode(e),t})):(t=r(e),t=d.filter(t,s),t=d.map(t,function(e){var t=m.encodeLiteral(e.name);return a(e.value)?t+=i.ifEmpty:t+="="+i.encode(e.value),t})),d.join(t,i.separator)}function l(t,e){var n=[],i="";return d.isArray(e)?(n=e,n=d.filter(n,_),n=d.map(n,t.encode)):(n=r(e),n=d.filter(n,function(e){return _(e.value)}),n=d.map(n,function(e){return t.encode(e.name)+"="+t.encode(e.value)})),i+=d.join(n,t.separator)}return e.prototype.toString=function(){return this.templateText},e.prototype.expand=function(e){var t,n,i,o,r=[],s=this.operator;for(t=0;t<this.varspecs.length;t+=1)if(null!==(i=e[(n=this.varspecs[t]).varname])&&i!==y)if(n.exploded&&!0,d.isArray(i),"string"==typeof i||"number"==typeof i||"boolean"==typeof i)r.push(c(n,s,i));else{if(n.maxLength&&_(i))throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+(o=i,JSON&&JSON.stringify?JSON.stringify(o):o));n.exploded?_(i)&&(s.named?r.push(p(n,s,i)):r.push(l(s,i))):!s.named&&a(i)||r.push(u(n,s,i))}return 0===r.length?"":s.first+d.join(r,s.separator)},e}(),c=function(){function e(e,t){this.templateText=e,this.expressions=t,d.deepFreeze(this)}return e.prototype.toString=function(){return this.templateText},e.prototype.expand=function(e){var t,n="";for(t=0;t<this.expressions.length;t+=1)n+=this.expressions[t].expand(e);return n},e.parse=n,e.UriTemplateError=p,e}();t=c,I.UriTemplate=t}();var E={SDK_NAME:"mobage-jssdk",SDK_VERSION:"3.7.9"};o.mobage=E;var e={},t={debug:1,info:2,warn:3,crit:4},n=e.LOG_LEVEL_DEBUG=1,i=e.LOG_LEVEL_INFO=2,r=e.LOG_LEVEL_WARN=3,s=e.LOG_LEVEL_CRIT=4;e.logLevel=t.info,e.setLogLevel=function(e){this.logLevel=t[e]};for(var a=["log","debug","error","warn"],c=0;c<a.length;c++){var u=a[c];console[u]&&!console[u].bind&&(console[u].bind=function(){return function(){console[u].apply(console,arguments)}})}e.debug=console.debug&&e.logLevel<=n?console.debug.bind(console):console.log.bind(console),e.info=function(){if(console.log&&e.logLevel<=i)return console.log.bind(console)}(),e.warn=function(){if(console.warn&&e.logLevel<=r)return console.warn.bind(console)}(),e.crit=function(){if(console.error&&e.logLevel<=s)return console.error.bind(console)}(),e.error=function(){if(console.error)return console.error.bind(console)}(),E.log=e;var p={visibilityPrefix:void 0!==D.hidden?"":void 0!==D.webkitHidden?"webkit":null,getInformation:function(){return p.information||(p.isiOSChrome()?p.information={os:{name:"ios"},application:{name:"chrome"},unsupported:!0}:p.isUIWebView()&&!p.isiOSShellAppSDK()?p.information={os:{name:"ios"},application:{name:"others"},unsupported:!0}:p.isFacebookWebView()?p.information={os:{name:"android"},application:{name:"others"},unsupported:!0}:p.information={unsupported:!1}),p.information},isSandbox:function(){return!1},getEnvironment:function(){return p.isAndroidShellAppSDK()?"android-shellapp":p.isiOSShellAppSDK()?"ios-shellapp":"browser"},getSDKName:function(){return p.isAndroidShellAppSDK()?"mobage-shellapp-sdk-android":p.isiOSShellAppSDK()?"mobage-shellapp-sdk-ios":p.isChromeappWebView()?"mobage-chromeapps-sdk":"mobage-jssdk"},isAndroidShellAppSDK:function(){return navigator.userAgent.match(/Mobage-ShellApp-SDK-Android/)},isiOSShellAppSDK:function(){return navigator.userAgent.match(/Mobage-ShellApp-SDK-iOS/)},isiOSChrome:function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|).*CriOS/)},isUIWebView:function(){return navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)},isFacebookWebView:function(){return navigator.userAgent.match(/FBAV/)},isSafariPrivateMode:function(){if(navigator.userAgent.match(/Safari/)){try{localStorage.setItem("mobageJssdkTest",1)}catch(e){return!0}return localStorage.removeItem("mobageJssdkTest"),!1}},isChromeappWebView:function(){return navigator.userAgent.match(/ChromeApp/)},isIE:function(){return navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/rv:11.0/)},isFirefox:function(){return navigator.userAgent.match(/Firefox/)},isEdge:function(){return navigator.userAgent.match(/Edge/)}};void 0===f.origin&&(f.origin=f.protocol+"//"+f.host),E.platform=p;var l={inherits:function(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}};E.core=l;var d={sequences:{}},g=Math.pow(2,53),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",m=h.length,_=D.createElement("a");d.getContentURL=function(e){_.href=e;var t=_.pathname;return 0!==t.indexOf("/")&&(t="/"+t),(E.clientConfig.contentOrigin||f.origin)+t},d.ensure=function(e,t){return function(){try{e.apply(null,arguments)}catch(e){}finally{t.apply(null,arguments)}}},d.encodeQuery=function(t){return Object.keys(t).filter(function(e){return t[e]}).map(function(e){return o.encodeURIComponent(e)+"="+o.encodeURIComponent(t[e])}).join("&")},d.decodeQuery=function(e){return e.split("&").map(function(e){return e.split("=",2)}).reduce(function(e,t){return 0<t[0].length&&(e[o.decodeURIComponent(t[0])]=o.decodeURIComponent(t[1])),e},{})},d.randomString=function(e){for(var t="",n=0;n<e;n++)t+=h.charAt(Math.floor(Math.random()*m));return t},d.nextSequence=function(e){return this.sequences[e]||(this.sequences[e]=0),++this.sequences[e]===g&&(this.sequences[e]=1),this.sequences[e]},d.resetSequence=function(e){this.sequences[e]=0},d.getOriginFromUrl=function(e){var t=D.createElement("a");return t.href=e,t.origin||t.protocol+"//"+t.hostname},d.decodeBase64URL=function(e){try{var t=e.replace(/-/g,"+").replace(/_/g,"/");return atob(t)}catch(e){return null}},d.stringifyWindowFeatures=function(e){var t="";if(e&&"object"==typeof e){var n=e.location||0,i=e.menubar||0,o=e.toolbar||0,r=e.scrollbars||0,s=e.center||0,a=e.status||0,c=e.width||0,u=e.height||0;t="location="+n+",menubar="+i+",toolbar="+o+",scrollbars="+r+",center="+s+",status="+a+",width="+c+",height="+u+",left="+(screen.width/2-c/2)+",top="+(screen.height/2-u/2)}return t},E.util=d;var v={DEVICE_ID_PC:"2",DEVICE_ID_SPWEB:"4",DEVICE_ID_IOS:"8",DEVICE_ID_ANDROID:"16",DISPLAY_TOUCH:"touch",DISPLAY_TOUCH_POPUP:"touch_popup",DISPLAY_PAGE:"page",DISPLAY_PAGE_POPUP:"page_popup"};E.constants=v;var b={};function C(e){if(Error.captureStackTrace)Error.captureStackTrace(this,this.constructor);else{var t=new Error;t.stack&&(this.stack=t.stack)}this.message=e||""}function S(e){C.call(this,e.body),this.status=e.status,this.headers=e.headers||{},this.body=e.body||""}function w(e){C.call(this,e.detail),this.httpStatus=e.httpStatus,this.title=e.title,this.detail=e.detail}E.core.inherits(C,Error),C.prototype.name="CustomError",E.core.inherits(S,C),S.prototype.name="HTTPError",E.core.inherits(w,C),w.prototype.name="APIError",b.HTTPError=S,b.APIError=w,E.error=b;E.endpoints={connect:{origin:"https://connect.mobage.jp",logout:"https://connect.mobage.jp/logout",authorize:"https://connect.mobage.jp/connect/1.0/services/authorize",uninstall:"https://connect.mobage.jp/connect/1.0/services/uninstall",jsonp_revoke:"https://connect.mobage.jp/connect/1.0/jsonp/revoke",check_session:"https://connect.mobage.jp/connect/1.0/jssdk/session_iframe",heartbeat:"https://connect.mobage.jp/connect/1.0/jssdk/heartbeat_iframe",redirect:function(e){return"https://connect.mobage.jp/connect/1.0/clients/"+e+"/jssdk/redirect"},fire_install_api:"https://connect.mobage.jp/connect/1.0/api/fire_install",session_token_api:"https://connect.mobage.jp/connect/1.0/api/session_token",session_api:"https://connect.mobage.jp/connect/1.0/api/session",easy_registration_api:"https://connect.mobage.jp/connect/1.0/api/easy_account_registration",user_upgrade:"https://connect.mobage.jp/user_upgrade/new",client_updates_api:function(e){return"https://connect.mobage.jp/connect/1.0/api/clients/"+e+"/updates"},user_purchase_limit_api:"https://connect.mobage.jp/connect/1.0/api/users/{user_id}/purchase_limit",account_manager:"https://connect.mobage.jp/account_manager",session_check:"https://connect.mobage.jp/connect/1.0/shellappsdk/session_check_form",xasm_proxy:"https://connect.mobage.jp/connect/1.0/api/xasm_proxy",easy_registration:"https://connect.mobage.jp/connect/1.0/shellappsdk/easy_account_registration",account_setting:"https://connect.mobage.jp/account_setting",registration_route_tracking:"https://connect.mobage.jp/registration_route_tracking"},widget:{origin:"https://widget.mobage.jp",debug_authorized:"https://widget.mobage.jp/debug/authorized",debug_anomymous:"https://widget.mobage.jp/debug/anonymous",coin_purchase:"https://widget.mobage.jp/ui/1.0/me/coin/purchases/new",coin_passbook:"https://widget.mobage.jp/ui/1.0/me/coin/passbook/new",vc_purchase:"https://widget.mobage.jp/ui/1.0/me/vc/purchases/new",payment:"https://widget.mobage.jp/ui/1.0/me/payments/new",inquiry:"https://widget.mobage.jp/ui/1.0/me/inquiries",user_upgrade:"https://widget.mobage.jp/ui/1.0/me/wuff/user_upgrades/new",invitation:"https://widget.mobage.jp/ui/1.0/me/invitations",client_configuration:"https://widget.mobage.jp/ui/1.0/me/client_configuration/edit",redirect:"https://widget.mobage.jp/ui/1.0/redirect",shortcut_icon:"https://widget.mobage.jp/ui/1.0/shortcut_icon",commercial_transaction:"https://widget.mobage.jp/ui/1.0/commercial_transaction",client_agreement:"https://widget.mobage.jp/ui/1.0/client_agreement",browser_switch_guide:"https://widget.mobage.jp/ui/1.0/browser_switch_guide",choose_product:"https://widget.mobage.jp/ui/1.0/choose_product",client_community:"https://widget.mobage.jp/ui/1.0/legacy/client_community",mygame:"https://widget.mobage.jp/ui/1.0/legacy/mygame",mypage:"https://widget.mobage.jp/ui/1.0/legacy/mypage",portal:"https://widget.mobage.jp/ui/1.0/legacy/portal",chat_channel:"https://widget.mobage.jp/ui/1.0/legacy/chat_channel",arbitrarily:"https://widget.mobage.jp/ui/1.0/legacy/arbitrarily",privacy_policy:"https://widget.mobage.jp/ui/1.0/legacy/privacy_policy"},api:{v2:{origin:"https://app.mobage.jp",restful:"https://app.mobage.jp/social/api/restful/v2",jsonrpc:"https://app.mobage.jp/social/api/jsonrpc/v2",proxy:"https://app.mobage.jp/static/proxy2.0.html"},"v2.02":{origin:"https://app.mobage.jp",restful:"https://app.mobage.jp/social/api/restful/v2.02",jsonrpc:"https://app.mobage.jp/social/api/jsonrpc/v2.02",proxy:"https://app.mobage.jp/static/proxy2.0.html"}},menu:{application:"https://widget.mobage.jp/api/1.0/menu/application",mymenu:"https://widget.mobage.jp/api/1.0/menu/mymenu",currency:"https://widget.mobage.jp/api/1.0/menu/currency",latests:"https://widget.mobage.jp/api/1.0/menu/latests",announcement:"https://widget.mobage.jp/api/1.0/menu/announcement"},currency:{origin:"https://iap.mbga.jp",product_base:"https://iap.mbga.jp/_nbpf_get_product_",begin_purchase_base:"https://iap.mbga.jp/_nbpf_begin_purchase_",purchase_base:"https://iap.mbga.jp/_nbpf_purchase_"},mobage:{origin:"https://sp.mbga.jp",term:"https://sp.mbga.jp/payment/coin/kiyaku",coin_notes:"https://sp.mbga.jp/payment/coin/notes.html",vc_notes:"https://sp.mbga.jp/_coin_vc_notes",vca_notes:"https://sp.mbga.jp/_coin_vca_notes",tokushouhou:"https://sp.mbga.jp/character/faq12.html",coin_faq:"https://sp.mbga.jp/_cs_faq_categ?id=1267",vc_faq:"https://sp.mbga.jp/_coin_vc_faq",vca_faq:"https://sp.mbga.jp/_coin_vca_faq",heartbeat:"https://ssl.sp.mbga.jp/_heartbeat_iframe",ssl_origin:"https://ssl.sp.mbga.jp"},mocha:{origin:"https://ava-a.sp.mbga.jp",widget_script:"https://ava-a.sp.mbga.jp/mobage/js/game-chat-connect/1.32/widgets.production.service.js"},forum:{origin:"https://forum.mobage.jp"}};var k={channels:{}},x=k.MESSAGE_TYPE_NOTIFICATION="notification",P=k.MESSAGE_TYPE_REQUEST="request",A=k.MESSAGE_TYPE_RESPONSE="response";function O(e){this.target=e;var t={};t[x]={},t[P]={},t[A]={},this.listeners=t,this.channelId=f.origin+":"+E.util.nextSequence("channel"),k.channels[this.channelId]=this}function q(e,t,n){O.call(this,e),this.targetOrigin=t,(this.sourceWindow=n).addEventListener("message",this)}function R(e){O.call(this,e),e.addEventListener("message",this)}O.prototype.addRequestListener=function(e,t){this.listeners[P][e]=t},O.prototype.removeRequestListener=function(e){this.listeners[P][e]=null},O.prototype.addNotifyListener=function(e,t){var n=E.util.randomString(24);return void 0===this.listeners[x][e]&&(this.listeners[x][e]={}),this.listeners[x][e][n]=t,n},O.prototype.removeNotifyListener=function(e,t){void 0===t?this.listeners[x][e]=null:delete this.listeners[x][e][t]},O.prototype.notify=function(e,t){this.postMessage({type:x,topic:e,extra:t})},O.prototype.request=function(e,t,n){var i=E.util.nextSequence("channel:"+this.channelId);this.listeners[A][i]=n,this.postMessage({type:P,topic:e,id:i,parameters:t})},O.prototype.response=function(e,t,n){this.postMessage({type:A,topic:e,id:t,result:n})},O.prototype.dispatch=function(e){var t=e.data,n=t.topic,i=!1;if(t.type===x&&this.listeners[x][n]){for(var o in this.listeners[x][n])this.listeners[x][n][o](t);i=!0}else t.type===P&&this.listeners[P][n]?(this.listeners[P][n](t),i=!0):t.type===A&&this.listeners[A][t.id]&&(this.listeners[A][t.id](t),delete this.listeners[A][t.id],i=!0);i&&"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation()},E.core.inherits(q,O),q.prototype.dispose=function(){this.sourceWindow.removeEventListener("message",this),this.target=null,delete k.channels[this.channelId]},q.prototype.handleEvent=function(e){e.origin===this.targetOrigin?this.dispatch(e):0===e.origin.indexOf("chrome-extension://")&&this.dispatch(e)},q.prototype.postMessage=function(e){this.target&&(void 0===this.target.postMessage||this.target.postMessage(e,this.targetOrigin))},E.core.inherits(R,O),R.prototype.dispose=function(){this.target.removeEventListener("message",this),this.target=null,delete k.channels[this.channelId]},R.prototype.handleEvent=function(e){this.dispatch(e)},R.prototype.postMessage=function(e){this.target.postMessage(e)},E.channel=k,E.channel.Channel=O,E.channel.WindowChannel=q,E.channel.WorkerChannel=R;var T={modalIframeOpen:!1,modalDisposable:!0,createIframe:function(e,t){t=t||function(){};var n=D.createElement("iframe");return t.done=!1,t&&(n.onload=function(){n.onload=null,t.done||(t.done=!0,t(n))}),n.src=e,n},createInvisibleIframe:function(e,t){var n=T.createIframe(e,t);return T.css(n,{display:"none",width:0,height:0}),D.body.appendChild(n),{window:n.contentWindow,iframe:n,dispose:function(){D.body.removeChild(n),n=null}}},createModalIframe:function(e,t){if(T.modalIframeOpen)return null;E.event.emit("modal.beforeOpen"),T.modalIframeOpen=!0;var n=e.url,i=e.id,o=e.display&&e.display===E.constants.DISPLAY_PAGE_POPUP,r=o?"710px":"90%",s=o?"560px":"90%",a=e.width||r,c=e.height||s,u=void 0!==e.opacity?e.opacity:1,p=isNaN(e.zIndex)?1e4:e.zIndex,l=p-1,d=D.createElement("div"),g=D.createElement("div"),h=T.createIframe(n,t),m=E.util.getOriginFromUrl(n);d.setAttribute("id",i+"_overlay"),d.setAttribute("name",i+"_overlay"),g.setAttribute("id",i+"_container"),g.setAttribute("name",i+"_container"),h.setAttribute("id",i),h.setAttribute("name",i),T.css(d,{position:"absolute",height:T.getDocumentHeight()+"px",width:D.body.clientWidth+"px",top:0,left:0,"background-color":"transparent",opacity:.2,"z-index":l});var f,_={opacity:0,"-webkit-box-sizing":"border-box","background-color":"transparent","box-sizing":"border-box",height:c,width:a,top:"50%",left:"50%",position:"fixed","-webkit-transition":"opacity 0.3s ease-in-out",transition:"opacity 0.3s ease-in-out","z-index":p},v={};o&&(_.zoom="reset",v={maxWidth:r,maxHeight:s,maxWindowWidthRate:.9,maxWindowHeightRate:.9},f=function(){T.adjust(d,{maxWidth:"10000px",maxHeight:"10000px",maxWindowWidthRate:1,maxWindowHeightRate:1,ignoreMargin:!0})}),T.css(g,_),T.css(h,{border:"none","-webkit-boz-sizing":"border-box","box-sizing":"border-box",height:"100%",width:"100%"}),D.body.appendChild(d),g.appendChild(h),D.body.appendChild(g),E.event.emit("modal.afterOpen"),T.adjust(g,v),setTimeout(function(){T.css(g,{opacity:u})},0);var y=function(){T.modalDisposable&&(T.modalIframeOpen=!1,T.modalDisposable=!0,E.event.emit("modal.beforeClose"),b.dispose(),D.body.removeChild(g),D.body.removeChild(d),E.event.emit("modal.afterClose"),d.removeEventListener("click",y),D.removeEventListener("click",y))};o&&(E.platform.isFirefox()||E.platform.isEdge()?setTimeout(function(){D.addEventListener("click",y)},0):d.addEventListener("click",y),I.addEventListener("message",function(e){e&&"close"===e.data&&y()}));var b=T.setupModalEvents(g,h.contentWindow,m,v,f);return{window:h.contentWindow,iframe:h,rootElement:g,dispose:y}},createWindow:function(e){var t=I.open(e.url,e.id);return{window:t,dispose:function(){t&&(t.close(),t=null)}}},adjust:function(e,t){if((t=t||{}).maxWidth&&t.maxHeight&&t.maxWindowWidthRate&&t.maxWindowHeightRate){var n={},i=t.maxWidth.lastIndexOf("px")==t.maxWidth.length-"px".length?t.maxWidth.substring(0,t.maxWidth.indexOf("px")):t.maxWidth,o=t.maxHeight.lastIndexOf("px")==t.maxHeight.length-"px".length?t.maxHeight.substring(0,t.maxHeight.indexOf("px")):t.maxHeight,r=I.innerWidth||D.documentElement.clientWidth||0,s=I.innerHeight||D.documentElement.clientHeight||0;r<(2-t.maxWindowWidthRate)*i?n.width=r*t.maxWindowWidthRate+"px":n.width=t.maxWidth,s<(2-t.maxWindowHeightRate)*o?n.height=s*t.maxWindowHeightRate+"px":n.height=t.maxHeight,T.css(e,n)}t.ignoreMargin||T.css(e,{"margin-top":"-"+(e.offsetHeight/2+(t.marginTop||0))+"px","margin-left":"-"+(e.offsetWidth/2+(t.marginLeft||0))+"px"})}};T.setupModalEvents=function(n,e,t,i,o){i=i||{};var r=new E.channel.WindowChannel(e,t,self),s=function(){T.adjust(n,i),"function"==typeof o&&o()},a=function(e){var t,n=E.platform.visibilityPrefix;"string"==typeof n?t=0===n.length?D.visibilityState:D[n+"VisibilityState"]:"focus"===e.type?t="visible":"blur"===e.type&&(t="hidden"),r.notify("visibilitychange",{state:t})},c=I.innerHeight,u=1,p=setInterval(function(){I.innerHeight!==c&&(c=I.innerHeight,i.marginTop=u,T.adjust(n,i),u*=-1)},500);r.addNotifyListener("adjust_modal_visibility",function(e){var t=e.extra.visibility?1:0;setTimeout(function(){T.css(n,{opacity:t})},0)});return r.addNotifyListener("modal_disposable",function(e){var t;t=e,T.modalDisposable=t&&t.extra&&t.extra.modalDisposable}),I.addEventListener("orientationchange",s),I.addEventListener("resize",s),"string"==typeof E.platform.visibilityPrefix?D.addEventListener(E.platform.visibilityPrefix+"visibilitychange",a):(I.addEventListener("focus",a),I.addEventListener("blur",a)),{dispose:function(){I.removeEventListener("orientationchange",s),I.removeEventListener("resize",s),"string"==typeof E.platform.visibilityPrefix?D.removeEventListener(E.platform.visibilityPrefix+"visibilitychange",a):(I.removeEventListener("focus",a),I.removeEventListener("blur",a)),clearInterval(p),r.dispose()}}},T.requestWithIframe=function(e){var t=D.createElement("iframe");t.src=e,D.body.appendChild(t),D.body.removeChild(t)},T.throttle=function(n,i){var o,r=Date.now(),s=function(){var e=Date.now(),t=e-r;clearTimeout(o),i<=t?(r=e,n()):o=setTimeout(function(){s(n,i)},i-t)};return s},T.css=function(e,t){var n=" ";Object.keys(t).forEach(function(e){n+=e+": "+String(t[e])+";"}),e.style.cssText+=n},T.addClass=function(e,t){""===e.className?e.className=t:e.className+=" "+t},T.getDocumentHeight=function(){var e=D;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))},E.chrome=T;var L={openTrackingCookieIframe:function(e){E.chrome.createInvisibleIframe(E.endpoints.connect.origin,function(){e()})},init:function(e,t){var n=e.viaMobageCore?E.endpoints.mobage.heartbeat:E.endpoints.connect.heartbeat,i=e.viaMobageCore?E.endpoints.mobage.ssl_origin:E.endpoints.connect.origin,o=E.chrome.createInvisibleIframe(n+"?"+E.util.encodeQuery({sdk_name:E.SDK_NAME,sdk_version:E.SDK_VERSION,client_id:e.clientId,pathname:encodeURIComponent(e.pathname),referrer:encodeURIComponent(e.referrer),extra_payload:JSON.stringify(e.extraPayload)}),function(){t()});L.heartbeatOrigin=i,L.handle=o},send:function(e,t){t=t||{},"string"==typeof e?"object"==typeof t?L.handle.iframe.contentWindow.postMessage({label:e,params:t},L.heartbeatOrigin):E.log.error("mobage.analytics.send: params should be Object"):E.log.error("mobage.analytics.send: label should be string")},decodeRawEvents:function(e){var t=E.util.decodeBase64URL(e);try{return JSON.parse(t)}catch(e){return null}},publishEvents:function(e){var t=E.callbackRegistry.get("analytics");t&&(e||[]).forEach(function(e){t(e)})}};E.analytics=L,E.uritemplate=o.UriTemplate;var j={jsonpCallbacks:{},jsonpScriptElements:{},requestCount:0,tooManyRequestsThreshold:50};setInterval(function(){j.requestCount=0},1e3),j.reset=function(){this.jsonpCallbacks={},this.jsonpScriptElements={},E.util.resetSequence("http")},j.randomUniqueString=function(){return E.util.randomString(10)+E.util.nextSequence("http")},j.request=function(t,i){if(j.requestCount++>j.tooManyRequestsThreshold)i(new E.error.HTTPError({status:429,body:"Too many requests"}));else{var o=new XMLHttpRequest;if(o.onload=function(){var e,t=j.parseResponseHeaders(o.getAllResponseHeaders());if(200<=o.status&&o.status<=299){try{e=JSON.parse(o.responseText)}catch(e){return void i(y,{status:o.status,headers:t,body:o.responseText})}i(y,{status:o.status,headers:t,body:e})}else{try{e=JSON.parse(o.responseText)}catch(e){return void i(new E.error.HTTPError({status:o.status,headers:t,body:o.responseText}))}i(new E.error.HTTPError({status:o.status,headers:t,body:e}))}},o.onerror=function(t){var e,n=j.parseResponseHeaders(o.getAllResponseHeaders());try{e=JSON.parse(o.responseText)}catch(e){return void i(new E.error.HTTPError({status:t.target.status,headers:n,body:o.responseText}))}i(new E.error.HTTPError({status:t.target.status,headers:n,body:e}))},o.open(t.method,t.url,!0),t.withCredentials&&(o.withCredentials=t.withCredentials),Object.keys(t.headers).forEach(function(e){o.setRequestHeader(e,t.headers[e])}),o.setRequestHeader("X-Mobage-SDK-Name",E.SDK_NAME),o.setRequestHeader("X-Mobage-SDK-Version",E.SDK_VERSION),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"===t.method||"DELETE"===t.method)o.send();else{var e;try{e=JSON.stringify(t.parameters)}catch(e){return void i(new E.error.HTTPError({status:400,headers:null,body:"Invalid JSON request"}))}o.setRequestHeader("Content-Type","application/json"),o.send(e)}}},j.parseResponseHeaders=function(e){return e.split("\n").map(function(e){var t=e.indexOf(":");return[e.substring(0,t),e.substring(t+1)]}).reduce(function(e,t){return 0<t[0].length&&(e[t[0]]=t[1].trim()),e},{})},j.jsonp=function(e,t,n){var i=E.chrome.createInvisibleIframe("about:blank"),o=E.util.ensure(n,function(){i.dispose()}),r=i.window.document;i.iframe.onload=function(){void 0!==r.x?(Array.prototype.unshift.call(r.x,null),o.apply(null,r.x)):o(new E.error.HTTPError({status:500,headers:{},body:"JSONP request failed for "+e}))},t.callback="cb";var s=e+"?"+E.util.encodeQuery(t);r.open().write('<script>function cb() { document.x = arguments; }<\/script><script src="'+s+'"><\/script>'),r.close()},E.http=j,E.http=E.http||{},E.http.Request=function(e){this.url=e.url,this.method=e.method,this.headers=e.headers||{},this.parameters=e.parameters||{},this.options=e.options||{},this.retryCount=0,this.withCredentials=e.withCredentials};var V={v2:"v2",operationToHttpMethod:{get:"GET",create:"POST",update:"PUT",delete:"DELETE"},httpStatusToMessage:{400:"API request with invalid parameters",401:"API is not authorized to access",403:"API is not permitted to access",404:"not found",405:"API request was not processed because operation not supported",406:"API request is not acceptable",408:"API request was not processed because of timeout",409:"is not updatable with that value",429:"API request rejected because of too many request",500:"API request failed because of API Server's internal error",502:"API request failed because of gateway error"}};function N(e){this.version=e.version,this.url=e.url,this.resource=e.resource,this.operation=e.operation,this.parameters=e.parameters||{}}function W(){this.supportedDeviceIds=[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function F(){this.uritemplates={},this.endpointFragment="/people/{userId}/{groupId}{/personId}"+E.api.collectionRequestParametersFragment,this.resourceName="People"}function B(){this.uritemplates={},this.endpointFragment="/appdata/{userId}/{groupId}/{appId}"+E.api.collectionRequestParametersFragment,this.contentField="data",this.resourceName="AppData"}function U(){this.uritemplates={},this.endpointFragment="/avatar/{userId}/{groupId}/{;size,view,emotion,dimension,transparent,type,extension}"+E.api.collectionRequestParametersFragment,this.resourceName="Avatar"}function z(){this.uritemplates={},this.endpointFragment="/textdata/{appId}{/textdataGroupName}/{groupId}{/textdataId}"+E.api.collectionRequestParametersFragment,this.contentField="textdata",this.resourceName="TextData"}function H(){this.singleRequestFragment="/textdata/{appId}/{textdataGroupName}/{groupId}"+E.api.collectionRequestParametersFragment,this.collectionRequestFragment="/textdata/{appId}/{groupId}"+E.api.collectionRequestParametersFragment,this.resourceName="TextDataGroup"}function M(){this.uritemplates={},this.endpointFragment="/profanity{?text}",this.resourceName="Profanity"}function Y(){this.uritemplates={},this.endpointFragment="/blacklist/{userId}/{groupId}{/personId}"+E.api.collectionRequestParametersFragment,this.resourceName="BlackList"}function K(){this.uritemplates={},this.endpointFragment="/leaderboards/{appId}/{leaderboardId}"+E.api.collectionRequestParametersFragment,this.resourceName="Leaderboard"}function G(){this.uritemplates={},this.endpointFragment="/leaderboards/{appId}/{leaderboardId}{/userId}{/groupId}"+E.api.collectionRequestParametersFragment,this.contentField="score",this.resourceName="LeaderboardScore"}function J(){this.uritemplates={},this.endpointFragment="/achievements/{appId}{/id}"+E.api.collectionRequestParametersFragment,this.resourceName="Achievement",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function Q(){this.uritemplates={},this.endpointFragment="/people/{userId}/{groupId}/achievements{/appId}{/achievementId}"+E.api.collectionRequestParametersFragment,this.contentField="contents",this.resourceName="UserAchievement",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function X(){this.uritemplates={},this.endpointFragment="/bank/inventory/{appId}{/itemId}"+E.api.collectionRequestParametersFragment,this.resourceName="BankInventory"}function Z(){this.uritemplates={},this.endpointFragment="/chat/{appId}/channels{/channelId}"+E.api.collectionRequestParametersFragment,this.resourceName="ChatChannel",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function $(){this.uritemplates={},this.endpointFragment="/chat/{appId}/channels/{channelId}/members{/id}"+E.api.collectionRequestParametersFragment,this.resourceName="ChatMember",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function ee(){this.uritemplates={},this.endpointFragment="/chat/{appId}/channels/{channelId}/messages{/id}"+E.api.collectionRequestParametersFragment,this.resourceName="ChatMessage",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function te(){this.uritemplates={},this.endpointFragment="/stampcategories/{appId}{/categoryId}"+E.api.collectionRequestParametersFragment,this.resourceName="StampCategory",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function ne(){this.uritemplates={},this.endpointFragment="/stampcategories/{appId}/{categoryId}/stamps{/stampId}"+E.api.collectionRequestParametersFragment,this.resourceName="Stamp",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function ie(){this.uritemplates={},this.endpointFragment="/people/{userId}/{groupId}/channels{/channelId}"+E.api.collectionRequestParametersFragment,this.resourceName="UserChannel",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}function oe(){this.uritemplates={},this.endpointFragment="/people/{userId}/@self/stamps{/stampId}"+E.api.collectionRequestParametersFragment,this.resourceName="UserStamp",this.supportedDeviceIds=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}V.versions=["v2"],V.collectionRequestParametersFragment="{?fields,count,filterBy,filterOp,filterValue,sortBy,sortOrder,startIndex}",E.api=V,N.prototype.execute=function(e){E.apiproxy.sendApiRequest(this,e)},E.api.Request=N,W.prototype.createRequest=function(e,t){if("object"==typeof(t=t||{})&&null!==t){var n=E.clientConfig.deviceId;if(!(this.supportedDeviceIds&&this.supportedDeviceIds.indexOf(n)<0)){t.appId=E.clientConfig.appId;var i=(this.template||(this.template=E.uritemplate.parse(E.endpoints.api.v2.restful+this.endpointFragment))).expand(t);return this.contentField?new E.api.Request({version:E.api.v2,url:i,resource:this.resourceName,operation:e,parameters:t[this.contentField]}):new E.api.Request({version:E.api.v2,url:i,resource:this.resourceName,operation:e})}E.log.error("deviceId: "+n+" is unsupported.")}else E.log.error("parameters should be non-null Object")},W.prototype.get=function(e,t){var n=this.createRequest("get",e);if(!t)return n;n.execute(t)},W.prototype.create=function(e,t){var n=this.createRequest("create",e);if(!t)return n;n.execute(t)},W.prototype.update=function(e,t){var n=this.createRequest("update",e);if(!t)return n;n.execute(t)},W.prototype.delete=function(e,t){var n=this.createRequest("delete",e);if(!t)return n;n.execute(t)},E.api.Base=W,E.core.inherits(F,E.api.Base),E.api.people=new F,E.core.inherits(B,E.api.Base),E.api.appdata=new B,E.core.inherits(U,E.api.Base),E.api.avatar=new U,E.core.inherits(z,E.api.Base),E.api.textdata=new z,E.core.inherits(H,E.api.Base),H.prototype.get=function(e,t){e.appId=E.clientConfig.appId;var n=(e.textdataGroupName?this.singleRequestTemplate||(this.singleRequestTemplate=E.uritemplate.parse(E.endpoints.api.v2.restful+this.singleRequestFragment)):this.collectionRequestTemplate||(this.collectionRequestTemplate=E.uritemplate.parse(E.endpoints.api.v2.restful+this.collectionRequestFragment))).expand(e),i=new E.api.Request({version:E.api.v2,url:n,resource:this.resourceName,operation:"get"});if(!t)return i;i.execute(t)},E.api.textdataGroup=new H,E.core.inherits(M,E.api.Base),M.prototype.check=function(e,t){if("string"==typeof e){var n=this.createRequest("get",{text:e});if(!t)return n;n.execute(t)}else E.log.error("text should be string")},E.api.profanity=new M,E.core.inherits(Y,E.api.Base),E.api.blacklist=new Y,E.core.inherits(K,E.api.Base),E.api.leaderboard=new K,E.core.inherits(G,E.api.Base),E.api.leaderboardScore=new G,E.core.inherits(J,E.api.Base),E.api.achievement=new J,E.core.inherits(Q,E.api.Base),E.api.userAchievement=new Q,E.core.inherits(X,E.api.Base),X.prototype.get=function(e,t){e.appId=E.clientConfig.appId;var n=(this.template||(this.template=E.uritemplate.parse(E.endpoints.api["v2.02"].restful+this.endpointFragment))).expand(e),i=new E.api.Request({version:E.api.v2,url:n,resource:this.resourceName,operation:"get"});if(!t)return i;i.execute(t)},E.api.bankInventory=new X,E.core.inherits(Z,E.api.Base),E.api.chatChannel=new Z,E.core.inherits($,E.api.Base),E.api.chatMember=new $,E.core.inherits(ee,E.api.Base),E.api.chatMessage=new ee,E.core.inherits(te,E.api.Base),E.api.chatStampCategory=new te,E.core.inherits(ne,E.api.Base),E.api.chatStamp=new ne,E.core.inherits(ie,E.api.Base),E.api.userChatChannel=new ie,E.core.inherits(oe,E.api.Base),E.api.userChatStamp=new oe;E.api.menu=function(e,t,n){if(t=t||{},"string"==typeof e)if("object"==typeof t||"function"==typeof t){"function"==typeof t&&(n=t);var i=E.api.menus[e];"function"==typeof i?i(t,n):E.log.error("mobage.api.menu: service not found for '"+e+"'")}else E.log.error("mobage.api.menu: params should be Object");else E.log.error("mobage.api.menu: service should be string")},V.menus=V.menus||{},V.menus.announcement=function(e,n){var t=E.endpoints.menu.announcement+"/latest?client_id="+E.clientConfig.clientId,i=new E.http.Request({url:t,method:"GET",withCredentials:!1});E.http.request(i,function(e,t){if(e)return n(e);n(null,t.body)})},V.menus=V.menus||{},V.menus.application=function(n,i){var e=E.endpoints.menu.application+"?client_id="+E.clientConfig.clientId,t=new E.http.Request({url:e,parameters:E.clientConfig,method:"GET",withCredentials:!0});if(E.platform.isSandbox()){var o=E.storage.status.getStatus();if(o&&!o.login)return n.ignoreLogin||E.event.emit("oauth.loginRequired"),void setTimeout(function(){i({loginRequired:!0})},0);if(!o)return n.ignoreLogin||E.event.emit("oauth.loginRequired"),void setTimeout(function(){i({loginRequired:!0})},0)}E.http.request(t,function(e,t){return e&&401===e.status?(n.ignoreLogin||E.event.emit("oauth.loginRequired"),i({loginRequired:!0})):e?i(e):void i(null,t.body)})},V.menus=V.menus||{},V.menus.currency=function(e,n){var t=E.endpoints.menu.currency+"?client_id="+E.clientConfig.clientId,i=new E.http.Request({url:t,method:"GET",withCredentials:!0});E.http.request(i,function(e,t){if(e)return n(e);n(null,t.body)})},V.menus=V.menus||{},V.menus.latests=function(e,n){var t=E.endpoints.menu.latests+"?client_id="+E.clientConfig.clientId,i=new E.http.Request({url:t,method:"GET",withCredentials:!0});E.http.request(i,function(e,t){if(e)return n(e);n(null,t.body)})},V.menus=V.menus||{},V.menus.mymenu=function(e,n){var t=E.endpoints.menu.mymenu+"?client_id="+E.clientConfig.clientId,i=new E.http.Request({url:t,method:"GET",withCredentials:!0});E.http.request(i,function(e,t){if(e)return n(e);n(null,t.body)})};var re={channels:{}};function se(){this.store=o.localStorage}function ae(){E.storage.Storage.call(this),this.namespace="mobage"}function ce(){E.storage.Storage.call(this),this.namespace="mobage",this.expire=900}function ue(){E.storage.Storage.call(this),this.namespace="xdframe"}function pe(){E.storage.Storage.call(this),this.namespace="mobage",this.maxItems=10}re.init=function(i){var o=0,r=E.api.versions.length;E.api.versions.forEach(function(e){var t=E.endpoints.api[e].proxy,n=E.chrome.createInvisibleIframe(t+"#parent_origin="+f.origin,function(){re.initChannel(e,n.window),++o===r&&i()})})},re.initChannel=function(e,t){var n=new E.channel.WindowChannel(t,E.endpoints.api[e].origin,I.self);n.addNotifyListener("refresh_token",function(){E.oauth.invokeImmediate()}),re.channels[e]=n},re.sendApiRequest=function(r,s){var e=new E.http.Request({url:r.url,method:E.api.operationToHttpMethod[r.operation],parameters:r.parameters||{},options:{storage_suffix:E.storage.sessionState.get()}});re.channels[r.version].request("api_request",e,function(e){var t=e.result;if(t.error){var n=t.error,i={httpStatus:n.status,title:r.resource+" "+E.api.httpStatusToMessage[n.status]};t.error.body&&t.error.body.Error&&(i.detail=t.error.body.Error.Message);var o=new E.error.APIError(i);s(o,y)}else s(y,t.response.body)})},re.requestAll=function(t,n,i){var o=[],r=0,e=Object.keys(re.channels),s=e.length;e.forEach(function(e){re.channels[e].request(t,n,function(e){o.push(e),++r===s&&i(o)})})},re.requestSingle=function(e,t,n){var i=Object.keys(re.channels)[0];re.channels[i].request(e,t,n)},re.notifyAll=function(t,n){Object.keys(re.channels).forEach(function(e){re.channels[e].notify(t,n)})},re.notifySingle=function(e,t){var n=Object.keys(re.channels)[0];re.channels[n].notify(e,t)},E.apiproxy=re,E.storage={},se.prototype.prefix=function(){return this.namespace?this.namespace+":":""},se.prototype.unixtime=function(){return Date.now()/1e3|0},se.prototype.setItem=function(e,t,n){var i=this.prefix()+e,o={value:t};if(n){var r=this.unixtime()+n;o.expire=r}try{this.store.setItem(i,JSON.stringify(o))}catch(e){throw e}},se.prototype.getItem=function(e){var t,n=this.prefix()+e,i=this.store.getItem(n);if(null===i)return null;try{t=JSON.parse(i)}catch(e){return null}return t&&(!t.expire||t.expire>this.unixtime())?t.value:null},se.prototype.removeItem=function(e){var t=this.prefix()+e;this.store.removeItem(t)},E.storage.Storage=se,E.core.inherits(ae,E.storage.Storage),ae.prototype.key=function(){return"session_state:"+E.clientConfig.clientId},ae.prototype.get=function(){return this.getItem(this.key())},ae.prototype.set=function(e){this.setItem(this.key(),e)},ae.prototype.clear=function(){this.set("none")},E.storage.sessionState=new ae,E.core.inherits(ce,E.storage.Storage),ce.prototype.namespace="mobage",ce.prototype.expire=900,ce.prototype.key=function(){return"status:"+E.storage.sessionState.get()},ce.prototype.setStatus=function(e){this.setItem(this.key(),e,this.expire)},ce.prototype.setLogin=function(e){var t=this.getStatus();t.login=e,this.setItem(this.key(),t,this.expire)},ce.prototype.setConnected=function(e){var t=this.getStatus();t.connected=e,this.setItem(this.key(),t,this.expire)},ce.prototype.getStatus=function(){return this.getItem(this.key())},ce.prototype.clear=function(){this.removeItem(this.key())},E.storage.status=new ce,E.core.inherits(ue,E.storage.Storage),ue.prototype.key=function(e){return"tokenData:"+e},ue.prototype.setTokens=function(e){var t=o.parseInt(e.expires_in),n={};e.scope&&e.scope.forEach(function(e){n[e]=!0});var i={access_token:e.access_token,scopes:n};this.setItem(this.key(e.storage_suffix+e.parentOrigin),i,t)},ue.prototype.getTokens=function(e){var t=this.getItem(this.key(e.storage_suffix+e.parentOrigin));return t?e.scope&&e.scope.some(function(e){return!t.scopes[e]})?null:t:null},ue.prototype.removeTokens=function(e){this.removeItem(this.key(e.storage_suffix+e.parentOrigin))},E.storage.token=new ue,E.core.inherits(pe,E.storage.Storage),pe.prototype.key=function(){return"payment_backlog:"+E.storage.sessionState.get()},pe.prototype.getAllTransactionIds=function(){var e=this.getItem(this.key());return e?Object.keys(e):[]},pe.prototype.updateBacklog=function(e,t){var n=this.getItem(this.key())||{},i=Object.keys(n);if(!n[e]&&i.length===this.maxItems){var o=i.sort(function(e,t){return n[e].updated>n[t].updated});delete n[o[0]]}var r={status:t,updated:Date.now()};n[e]=r,this.setItem(this.key(),n)},pe.prototype.deleteBacklog=function(e){var t=this.getItem(this.key());e instanceof Array?e.forEach(function(e){delete t[e]}):delete t[e],this.setItem(this.key(),t)},pe.prototype.clear=function(){this.removeItem(this.key())},E.storage.paymentBacklog=new pe;var le={callbacks:{},register:function(e,t){this.callbacks[e]?this.callbacks[e].push(t):this.callbacks[e]=[t]},get:function(e){var t=this.callbacks[e];return t?t[t.length-1]:null},remove:function(e){if(!this.callbacks[e])return null;var t=this.callbacks[e].pop();return 0===this.callbacks[e].length&&delete this.callbacks[e],t}};E.callbackRegistry=le;var de={defaults:{scope:["openid","common_api"],responseType:["code","token"],theme:"default"},immediateTimeout:1e4,init:function(e){var t=E.chrome.createInvisibleIframe(E.endpoints.connect.check_session,function(){e()}),n=new E.channel.WindowChannel(t.window,E.endpoints.connect.origin,I);de.sessionFrameChannel=n},checkSessionState:function(e,t,n){var i=E.util.randomString(24)+E.util.nextSequence("session_iframe"),o=de.sessionFrameChannel.addNotifyListener("session_state_change_response",function(e){if(e.extra.notificationId===i){"changed"===e.extra.status&&E.clearAllStorage();var t={thirdPartyCookieAvailable:e.extra.thirdPartyCookieAvailable,sessionState:e.extra.sessionState};n(e.extra.status,t),de.sessionFrameChannel.removeNotifyListener("session_state_change_response",o)}});de.sessionFrameChannel.postMessage({clientId:e,sessionState:t,notificationId:i})},getCurrentSessionState:function(e,t){var n=E.util.randomString(24)+E.util.nextSequence("session_iframe"),i=de.sessionFrameChannel.addNotifyListener("session_state_change_response",function(e){e.extra.notificationId===n&&(t(e.extra.sessionState),de.sessionFrameChannel.removeNotifyListener("session_state_change_response",i))});de.sessionFrameChannel.postMessage({clientId:e,sessionState:"",notificationId:n})},getConnectedStatus:function(e,t){if("object"==typeof e)if("function"==typeof t){var n=e.scope||E.clientConfig.scope||de.defaults.scope,i=e.responseType||E.clientConfig.responseType||de.defaults.responseType,o=e.state;if(!n instanceof Array)E.log.error("mobage.oauth.getConnectedStatus: params.scope should be Array.<string>");else if(!i instanceof Array)E.log.error("mobage.oauth.getConnectedStatus: params.responseType should be Array.<string>");else if("string"==typeof o){var r=t;t=function(){E.event.emit("oauth.getConnectedStatus",arguments[0],arguments[1]),r(arguments[0],arguments[1])},i.some(function(e){return"code"===e})?de.invokeImmediate({scope:n,responseType:i,state:o},t):E.apiproxy.requestAll("check_token_request",{scope:n,storage_suffix:E.storage.sessionState.get()},function(e){e.every(function(e){return e.result.haveToken})?t(null,{login:!0,connected:!0}):de.invokeImmediate({scope:n,responseType:i,state:o},t)})}else E.log.error("mobage.oauth.getConnectedStatus: params.state should be string")}else E.log.error("mobage.oauth.getConnectedStatus: callback should be function");else E.log.error("mobage.oauth.getConnectedStatus: params should be Object")},invokeImmediate:function(e,t){e=e||{},t=t||function(){};var n=E.clientConfig.clientId,i=E.clientConfig.deviceId,o=e.scope||E.clientConfig.scope||de.defaults.scope,r=e.responseType||["token"],s=e.state||E.util.randomString(32),a=e.redirectUri||E.clientConfig.redirectUri,c={client_id:n,response_type:r.sort().join(" "),scope:o.join(" "),redirect_uri:a,state:s,prompt:"none",display:i===E.constants.DEVICE_ID_PC?E.constants.DISPLAY_PAGE:E.constants.DISPLAY_TOUCH,client_origin_uri:f.origin,sdk_name:E.SDK_NAME,sdk_version:E.SDK_VERSION};de.authParams=c,de.registerAuthorizationCallback({state:s,scope:o},t),de.invokeAuthorizationProcess(c,t)},connect:function(e,t){if("object"==typeof e)if("function"==typeof t){var n=E.clientConfig.clientId,i=E.clientConfig.deviceId,o=e.state,r=e.scope||E.clientConfig.scope||de.defaults.scope,s=e.responseType||E.clientConfig.responseType||de.defaults.responseType,a=e.redirectUri||E.clientConfig.redirectUri,c=e.theme||E.clientConfig.theme||de.defaults.theme,u=e.nickname,p=e.customTheme||e.loginCustomTheme||e.authCustomTheme,l=e.appearanceVersion||e.loginAppearanceVersion||e.authAppearanceVersion,d=e.route_code;if(!r instanceof Array)E.log.error("mobage.oauth.connect: params.scope should be Array.<string>");else if(!s instanceof Array)E.log.error("mobage.oauth.connect: params.responseType should be Array.<string>");else if("string"==typeof o)if("string"==typeof c){var g=t;t=function(){E.event.emit("oauth.connect",arguments[0],arguments[1]),g(arguments[0],arguments[1])};var h={client_id:n,response_type:s.join(" "),scope:r.join(" "),redirect_uri:a,state:o,prompt:"consent",theme:c,client_origin_uri:f.origin,sdk_name:E.SDK_NAME,sdk_version:E.SDK_VERSION,custom_theme:p,appearance_version:l,route_code:d};e.easyRegistration&&u&&(h.nickname=u);var m=E.storage.status.getStatus();(E.platform.isiOSShellAppSDK()||E.platform.isAndroidShellAppSDK())&&e.easyRegistration?(h.display=E.constants.DISPLAY_TOUCH,de.registerEasyRegistrationCallback({state:o,scope:r},t),de.invokeEasyRegistrationProcess(h,t)):(m&&!0===m.login&&!1===m.connected?h.display=i===E.constants.DEVICE_ID_PC?E.constants.DISPLAY_PAGE_POPUP:E.constants.DISPLAY_TOUCH_POPUP:E.clientConfig.deviceId===E.constants.DEVICE_ID_PC?h.display=E.constants.DISPLAY_PAGE:h.display=E.constants.DISPLAY_TOUCH,de.registerAuthorizationCallback({state:o,scope:r},t),de.invokeAuthorizationProcess(h,t))}else E.log.error("mobage.oauth.connect: params.theme should be string");else E.log.error("mobage.oauth.connect: params.state should be string")}else E.log.error("mobage.oauth.connect: callback should be function");else E.log.error("mobage.oauth.connect: params should be Object")},registerAuthorizationCallback:function(n,i){E.callbackRegistry.register("authorization_response",function(e){if(e.error){var t=!1;"consent_required"===e.error&&(t=!0),"access_denied"!==e.error&&E.storage.status.setStatus({login:t,connected:!1}),i({login:t,connected:!1,response:{error:e.error,error_description:e.error_description}},null)}else e.session_state!==E.storage.sessionState.get()&&E.clearAllStorage(),e.state===n.state?(E.storage.sessionState.set(e.session_state),e.access_token&&E.apiproxy.notifyAll("provide_token",{storage_suffix:E.storage.sessionState.get(),access_token:e.access_token,expires_in:e.expires_in,scope:n.scope}),E.storage.status.setStatus({login:!0,connected:!0}),i(null,{login:!0,connected:!0,response:{code:e.code,state:e.state,session_state:e.session_state}})):i({login:!1,connected:!1,response:{error:"invalid_state",error_description:"'state' of authorization request not matched with the original state."}},null);E.apiproxy.notifyAll("process_queued_requests",{storage_suffix:E.storage.sessionState.get()})})},registerEasyRegistrationCallback:function(t,n){E.callbackRegistry.register("easy_registration_response",function(e){e.error?(E.storage.status.setStatus({login:!1,connected:!1}),n({login:!1,connected:!1,response:{error:e.error,error_description:e.error_description}},null)):(e.session_state!==E.storage.sessionState.get()&&E.clearAllStorage(),e.state===t.state?(E.storage.sessionState.set(e.session_state),e.access_token&&E.apiproxy.notifyAll("provide_token",{storage_suffix:E.storage.sessionState.get(),access_token:e.access_token,expires_in:e.expires_in,scope:t.scope}),E.storage.status.setStatus({login:!0,connected:!0}),n(null,{login:!0,connected:!0,response:{code:e.code,state:e.state,session_state:e.session_state}})):n({login:!1,connected:!1,response:{error:"invalid_state",error_description:"'state' of authorization request not matched with the original state."}},null)),E.apiproxy.notifyAll("process_queued_requests",{storage_suffix:E.storage.sessionState.get()})})},invokeAuthorizationProcess:function(e,t){var n,i,o=E.endpoints.connect.authorize;if("string"==typeof e.route_code){var r=e.route_code;delete e.route_code,n=E.endpoints.connect.registration_route_tracking+"?"+E.util.encodeQuery({redirect_uri:o+"?"+E.util.encodeQuery(e),route_code:r})}else n=o+"?"+E.util.encodeQuery(e);"none"===e.prompt?i=E.chrome.createInvisibleIframe(n,function(){de.registerListeners(i,e)}):e.display===E.constants.DISPLAY_TOUCH_POPUP?i=E.chrome.createModalIframe({url:n,id:"authorize_consent_frame",display:e.display},function(){de.registerListeners(i,e)}):e.display===E.constants.DISPLAY_PAGE_POPUP?i=E.chrome.createModalIframe({url:n,id:"authorize_consent_frame",display:e.display},function(){de.registerListeners(i,e)}):e.display===E.constants.DISPLAY_TOUCH?(i=E.chrome.createWindow({url:n,id:"authorize_consent_window"}),de.registerListeners(i,e)):e.display===E.constants.DISPLAY_PAGE&&(i=E.chrome.createWindow({url:n,id:"authorize_consent_window"}),de.registerListeners(i,e)),i||(E.callbackRegistry.remove("authorization_response"),t({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"}))},registerListeners:function(t,e){var n=new E.channel.WindowChannel(t.window,E.endpoints.connect.origin,I.self);n.addNotifyListener("authorization_response",function(e){t.dispose(),n.dispose();e.extra;E.callbackRegistry.remove("authorization_response")(e.extra)}),n.addNotifyListener("authorization_error_response",function(e){t.dispose(),n.dispose();e.extra;E.callbackRegistry.remove("authorization_response")(e.extra)}),E.platform.isIE()&&(I.onfocus=function(){var n=E.callbackRegistry.get("authorization_response");n&&de.getConnectedStatus({state:e.state},function(e,t){n&&t&&t.login&&(E.callbackRegistry.remove("authorization_response"),n(t.response))})}),n.addNotifyListener("analytics",function(e){E.analytics.publishEvents([e.extra])})},disconnect:function(e,o){o=o||function(){};var r=(e=e||{}).theme||E.clientConfig.theme||de.defaults.theme;"object"==typeof e?"function"==typeof o?E.oauth.getStatus(function(e){if(!1!==e.connected){E.callbackRegistry.register("uninstall_response",function(e){e.error?o(e,y):(E.apiproxy.notifyAll("remove_token",{storage_suffix:E.storage.sessionState.get()}),E.storage.status.setConnected(!1),o(y,e))});var t=E.clientConfig.clientId,n=E.clientConfig.deviceId,i={client_id:t,post_uninstall_redirect_uri:E.endpoints.connect.redirect(t),client_origin_uri:f.origin,display:n===E.constants.DEVICE_ID_PC?E.constants.DISPLAY_PAGE_POPUP:E.constants.DISPLAY_TOUCH_POPUP,theme:r,sdk_name:E.SDK_NAME,sdk_version:E.SDK_VERSION};de.invokeDisconnectProcess(i,o)}else o({error:"not_connected",error_description:"This application is not installed by user"},y)}):E.log.error("mobage.oauth.disconnect: callback should be function"):E.log.error("mobage.oauth.disconnect: params should be Object")},invokeDisconnectProcess:function(e,t){var n=E.util.encodeQuery(e),i=E.chrome.createModalIframe({url:E.endpoints.connect.uninstall+"?"+n,id:"disconnect_frame",display:e.display},function(){var t=new E.channel.WindowChannel(i.window,E.endpoints.connect.origin,I.self);t.addNotifyListener("uninstall_response",function(e){i.dispose(),t.dispose(),E.callbackRegistry.remove("uninstall_response")(e.extra)}),t.addNotifyListener("uninstall_error_response",function(e){i.dispose(),t.dispose(),E.callbackRegistry.remove("uninstall_response")(e.extra)}),t.addNotifyListener("analytics",function(e){E.analytics.publishEvents([e.extra])})});i||(E.callbackRegistry.remove("uninstall_response"),t({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"}))},revokeToken:function(t){t=t||function(){},E.apiproxy.requestSingle("revoke_token",{storage_suffix:E.storage.sessionState.get()},function(e){e.error?t(e.error):(E.apiproxy.notifyAll("remove_token",{storage_suffix:E.storage.sessionState.get()}),t(null,e.response))})},logout:function(e,r){r=r||function(){};var s=(e=e||{}).theme||E.clientConfig.theme||de.defaults.theme;"object"==typeof e?"function"==typeof r?E.oauth.getStatus(function(e){if(!1!==e.login){var t=E.clientConfig.clientId,n=E.clientConfig.deviceId,i={client_id:t,post_logout_redirect_uri:E.endpoints.connect.redirect(t),client_origin_uri:f.origin,display:n===E.constants.DEVICE_ID_PC?E.constants.DISPLAY_PAGE:E.constants.DISPLAY_TOUCH,theme:s,sdk_name:E.SDK_NAME,sdk_version:E.SDK_VERSION},o=r;r=function(){E.event.emit("oauth.logout",arguments[0],arguments[1]),o(arguments[0],arguments[1])},E.callbackRegistry.register("logout_response",function(e){e.error?r(e,y):(E.clearAllStorage(),r(y,e))}),E.oauth.invokeLogoutProcess(i,r)}else r({error:"not_login",error_description:"This user is not logged-in"},y)}):E.log.error("mobage.oauth.logout: callback should be function"):E.log.error("mobage.oauth.logout: params should be Object")},invokeLogoutProcess:function(e,t){var n=E.util.encodeQuery(e),i=E.chrome.createWindow({url:E.endpoints.connect.logout+"?"+n,id:"logout_window"});i||(E.callbackRegistry.remove("logout_response"),t({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"}));var o=new E.channel.WindowChannel(i.window,E.endpoints.connect.origin,I.self);o.addNotifyListener("logout_response",function(e){i.dispose(),o.dispose(),E.callbackRegistry.remove("logout_response")(e.extra)}),o.addNotifyListener("logout_error_response",function(e){i.dispose(),o.dispose(),E.callbackRegistry.remove("logout_response")(e.extra)}),E.platform.isIE()&&(I.onfocus=function(){var n=E.callbackRegistry.get("logout_response");if(n){var e="";E.oauth.authParams&&(e=E.oauth.authParams.state||""),de.getConnectedStatus({state:e},function(e,t){n&&t&&!1===t.login&&(E.callbackRegistry.remove("logout_response"),n(t.response))})}}),o.addNotifyListener("analytics",function(e){E.analytics.publishEvents([e.extra])})},getStatus:function(i){var e=E.storage.status.getStatus();e?i(e):E.oauth.invokeImmediate({},function(e,t){var n=e||t;i({login:n.login,connected:n.connected})})},getStatusByCache:function(e){var t=E.storage.status.getStatus();e(t||{login:!1,connected:!1})}};E.oauth=de;var ge={listeners:{},registeredEvents:{},data:{},supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],subscribe:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.pop();if("string"==typeof t)if("function"==typeof n){var i=E.clientConfig.deviceId;if(this.supportedDeviceIds&&this.supportedDeviceIds.indexOf(i)<0)E.log.error("deviceId: "+i+" is unsupported.");else{if(void 0!==ge.registeredEvents[t]){void 0===ge.listeners[t]&&(ge.listeners[t]=[]),0===ge.listeners[t].length&&ge.registeredEvents[t].init();var o=t+":"+ge.listeners[t].length.toString(),r={id:o,type:t,args:e,callback:n,data:{}};return ge.listeners[t].push(r),ge.registeredEvents[t].start(r),o}E.log.error("mobage.event.subscribe: invalid event type = "+t+", available events =",Object.keys(ge.registeredEvents))}}else E.log.error("mobage.event.subscribe: callback should be function");else E.log.error("mobage.event.subscribe: type should be string")},once:function(){var e,t=Array.prototype.slice.call(arguments),n=t.shift(),i=t.pop(),o=!1,r=this;return e=this.subscribe(n,function(){r.unsubscribe(e),o||(o=!0,i.apply(this,arguments))})},unsubscribe:function(t){if("string"==typeof t){var e=t.split(/:/,2)[0];if(void 0!==ge.registeredEvents[e]){var n=ge.getListener(t);void 0!==n?(ge.registeredEvents[e].end(n),ge.listeners[e]=ge.listeners[e].filter(function(e){return e.id!==t}),0===ge.listeners[e].length&&ge.registeredEvents[e].finalize()):E.log.debug("mobage.event.unsubscribe: invalid listener id, perhaps you never call mobage.event.subscribe or already have unsubscribed")}else E.log.error("mobage.event.subscribe: invalid event type, available events =",Object.keys(ge.registeredEvents))}else E.log.error("mobage.event.unsubscribe: id should be string")},isSupported:function(e){return!!ge.registeredEvents[e]},getListener:function(t){var e=t.split(/:/,2)[0];return ge.listeners[e].filter(function(e){return e.id===t})[0]},register:function(e,t){ge.registeredEvents[e]=t},emit:function(){var t=Array.prototype.slice.call(arguments),e=t.shift();(ge.listeners[e]||[]).forEach(function(e){e.callback.apply(null,t)})}};(E.event=ge).register("oauth.sessionStateChange",{init:function(){},start:function(n){n.data.sessionChangeTimerId=setInterval(function(){E.oauth.checkSessionState(E.clientConfig.clientId,n.args[0],function(e,t){"changed"===e&&(ge.emit("oauth.sessionStateChangeOnce",e,t),ge.emit(n.type,e,t),clearInterval(n.data.sessionChangeTimerId),ge.unsubscribe(n.id))})},1e3)},end:function(e){clearInterval(e.data.sessionChangeTimerId)},finalize:function(){}}),ge.register("oauth.sessionStateChangeOnce",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("oauth.getConnectedStatus",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("oauth.loginRequired",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("oauth.connect",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("oauth.logout",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("bank.paymentBacklog",{init:function(){},start:function(t){function e(){var e=E.storage.paymentBacklog.getAllTransactionIds();0<e.length&&ge.emit(t.type,e)}e(),t.data.timerId=setInterval(e,1e3)},end:function(e){clearInterval(e.data.timerId)},finalize:function(){}}),ge.register("bank.coinChanged",{init:function(){},start:function(i){function e(){E.api.menu("currency",function(e,t){if(e)throw e;var n=parseInt(t.currency);null===i.data.coin?i.data.coin=n:i.data.coin!==n&&(i.data.coin=n,ge.emit(i.type,{currency:n}))})}i.data.coin=null,e(),i.data.timerId=setInterval(e,1e3)},end:function(e){clearInterval(e.data.timerId)},finalize:function(){}}),ge.register("analytics",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("analytics.userActivity",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("platform.unsupportedBrowser",{init:function(){},start:function(e){E.platform.getInformation().unsupported&&E.event.emit(e.type,E.platform.information)},end:function(){},finalize:function(){}}),ge.register("modal.beforeOpen",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("modal.afterOpen",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("modal.beforeClose",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("modal.afterClose",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}}),ge.register("ui.menubar",{init:function(){},start:function(e){},end:function(e){},finalize:function(){}});var he={requestParametersFragment:"client_id,theme,display,width,height,format,client_origin_uri,notification_id,session_state,close_timeout,sdk_name,custom_theme,appearance_version}",services:{show:{},open:{}},embeds:{},templates:{},init:function(){E.oauth.getCurrentSessionState("12018140-4",function(e){he.currentSessionState=e}),setInterval(function(){E.oauth.getCurrentSessionState("12018140-4",function(e){he.currentSessionState=e})},3e3)},getServiceConfig:function(e,t){return he.services[e][t]},open:function(e,t,n){if(t=t||{},n=n||function(){},"string"==typeof e)if("object"==typeof t)if("function"==typeof n){var i=he.getServiceConfig("open",e);if(void 0!==i){var o=E.clientConfig.deviceId;if(!(i.supportedDeviceIds&&i.supportedDeviceIds.indexOf(o)<0)){he.createParams(t,i),i.startCallback&&i.startCallback(t);var r="user_upgrade"===e?"user_upgrade_response":"ui_response";E.callbackRegistry.register(r,function(e,t){i.endCallback&&i.endCallback(e,t),n(e,t)});var s,a=he.templates[e];if(!a)s="user_upgrade"===e?E.endpoints.connect[e]:E.endpoints.widget[e],a=he.templates[e]=E.uritemplate.parse(s+i.endpointFragment);var c=a.expand(t);return E.ui.invokeWidgetServiceProcess(e,c,t,n)}E.log.error("mobage.ui.open: this service '"+e+"' is not supported on deviceId: "+o)}else E.log.error("mobage.ui.open: service not found for '"+e+"'")}else E.log.error("mobage.ui.open: callback should be function");else E.log.error("mobage.ui.open: params should be Object");else E.log.error("mobage.ui.open: service should be string")},show:function(e,t){if(t=t||{},"string"==typeof e)if("object"==typeof t){var n=he.getServiceConfig("show",e);if(void 0!==n){var i=E.clientConfig.deviceId;if(!(n.supportedDeviceIds&&n.supportedDeviceIds.indexOf(i)<0)){he.createParams(t,n),n.startCallback&&n.startCallback(t),E.callbackRegistry.register("ui_response",function(e,t){n.endCallback&&n.endCallback(e,t)});var o=he.templates[e];if(!o){var r;switch(e){case"account_manager":case"account_setting":r=E.endpoints.connect[e];break;default:r=E.endpoints.widget[e]}o=E.uritemplate.parse(r+n.endpointFragment)}var s=o.expand(t);return E.ui.invokeWidgetServiceProcess(e,s,t)}E.log.error("mobage.ui.open: this service '"+e+"' is not supported on deviceId: "+i)}else E.log.error("mobage.ui.show: service not found for '"+e+"'")}else E.log.error("mobage.ui.show: params should be Object");else E.log.error("mobage.ui.show: service should be string")},createParams:function(e,t){e.client_id=E.clientConfig.clientId,e.theme=e.theme||"default",t.displayOverridable||(e.display=""),e.display||(t.display===E.constants.DISPLAY_TOUCH&&E.clientConfig.deviceId===E.constants.DEVICE_ID_PC?e.display=E.constants.DISPLAY_PAGE:t.display===E.constants.DISPLAY_TOUCH_POPUP&&E.clientConfig.deviceId===E.constants.DEVICE_ID_PC?e.display=E.constants.DISPLAY_PAGE_POPUP:e.display=t.display),e.width=e.width||"auto",e.height=e.height||"auto",e.format=e.format||"html",e.client_origin_uri=f.origin,e.notification_id=E.util.randomString(24)+E.util.nextSequence("widget_notification_id"),e.session_state=he.currentSessionState,e.sdk_name=E.platform.getSDKName(),e.opacity=void 0!==t.opacity?t.opacity:1,void 0!==e.closeTimeout?e.close_timeout=e.closeTimeout:void 0!==E.clientConfig.uiCloseTimeout&&(e.close_timeout=E.clientConfig.uiCloseTimeout)},invokeWidgetServiceProcess:function(e,t,n,i){var o;return i=i||function(){},n.display===E.constants.DISPLAY_TOUCH?o=he.openWidgetWithWindow({url:t,service:e,notificationId:n.notification_id,theme:n.theme},i):n.display===E.constants.DISPLAY_TOUCH_POPUP?o=he.openWidgetWithIframe({url:t,service:e,notificationId:n.notification_id,theme:n.theme,opacity:n.opacity,display:n.display,zIndex:n.zIndex}):n.display===E.constants.DISPLAY_PAGE?o=he.openWidgetWithWindow({url:t,service:e,notificationId:n.notification_id,theme:n.theme},i):n.display===E.constants.DISPLAY_PAGE_POPUP&&(o=he.openWidgetWithIframe({url:t,service:e,notificationId:n.notification_id,theme:n.theme,opacity:n.opacity,display:n.display,zIndex:n.zIndex},i)),o||(E.callbackRegistry.remove("ui_response"),i({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"})),o},openWidgetWithIframe:function(t){var n=E.chrome.createModalIframe({url:t.url,id:t.service,theme:t.theme,opacity:t.opacity,display:t.display,zIndex:t.zIndex},function(){var e=new E.channel.WindowChannel(n.window,E.endpoints.widget.origin,self);he.registerListeners({handle:n,channel:e,notificationId:t.notificationId,service:t.service})});return n},openWidgetWithWindow:function(e,t){var n=E.chrome.createWindow({url:e.url,id:e.service});if(!n.window)return t({error:"client_error",errorDescription:"Cannot open a new window, perhaps due to pop-up blocker"},null),void n.dispose();if(void 0!==t){var i="user_upgrade"===e.service?E.endpoints.connect.origin:E.endpoints.widget.origin,o=new E.channel.WindowChannel(n.window,i,self);return he.registerListeners({handle:n,channel:o,notificationId:e.notificationId,service:e.service}),n}},registerListeners:function(t){if("user_upgrade"===t.service){var e=function(e){he.userUpgradeNotificationHandler(t,e),t.handle.dispose(),t.channel.dispose(),t.handle=null,t.channel=null};t.channel.addNotifyListener("user_upgrade_response",e),t.channel.addNotifyListener("user_upgrade_error_response",e)}else t.channel.addNotifyListener(t.service,function(e){t.handle.dispose(),t.channel.dispose(),t.handle=null,t.channel=null,he.serviceNotificationHandler(t,e)});t.channel.addNotifyListener("login",function(e){t.handle.dispose(),t.channel.dispose(),t.handle=null,t.channel=null,he.serviceNotificationHandler(t,e)}),t.channel.addNotifyListener("analytics",function(e){E.callbackRegistry.get("analytics")(e.extra)})},serviceNotificationHandler:function(e,t){var n=t.extra,i=E.callbackRegistry.remove("ui_response");t.id===e.notificationId?n.error?i({error:n.error,errorDescription:n.error_description},null):i(null,{response:n,signedResponse:t.signedExtra}):i({error:"invalid_notification",errorDescription:"Invalid notification, got = "+t.id+", expected = "+e.notificationId},null)},userUpgradeNotificationHandler:function(e,t){var n=t.extra,i=E.callbackRegistry.remove("user_upgrade_response");n.error?i({error:n.error,errorDescription:n.error_description},null):i(null,n)},embed:function(e,t){if(t=t||{},"string"==typeof e)if("object"==typeof t){var n=he.embeds[e];"function"==typeof n?n(t):E.log.error("mobage.ui.embed: service not found for '"+e+"'")}else E.log.error("mobage.ui.embed: params should be Object");else E.log.error("mobage.ui.embed: service should be string")}};(E.ui=he).services.open.coin_purchase={endpointFragment:"{?shortfall,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB]},he.services.open.coin_passbook={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC]},he.services.open.payment={endpointFragment:"{?transaction_id,order_id,choose_product_custom_theme,choose_product_appearance_version,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH_POPUP,displayOverridable:!0,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.transaction_id=e.transactionId,e.order_id=e.orderId,e.customTheme&&(e.custom_theme=e.customTheme),e.appearanceVersion&&(e.appearance_version=e.appearanceVersion),e.chooseProductCustomTheme&&(e.choose_product_custom_theme=e.chooseProductCustomTheme),e.chooseProductAppearanceVersion&&(e.choose_product_appearance_version=e.chooseProductAppearanceVersion),E.storage.paymentBacklog.updateBacklog(e.transaction_id,"authorized")},endCallback:function(e,t){t&&E.storage.paymentBacklog.updateBacklog(t.response.result.payment.id,"closed")}},he.services.show.inquiry={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]},he.services.show.user_upgrade={endpointFragment:"{?required_grade,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.required_grade=e.requiredGrade,e.customTheme&&(e.custom_theme=e.customTheme),e.appearanceVersion&&(e.appearance_version=e.appearanceVersion)}},he.services.open.user_upgrade={endpointFragment:"{?required_grade,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.required_grade=e.requiredGrade,e.customTheme&&(e.custom_theme=e.customTheme),e.appearanceVersion&&(e.appearance_version=e.appearanceVersion)}},he.services.open.invitation={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.customTheme&&(e.custom_theme=e.customTheme),e.appearanceVersion&&(e.appearance_version=e.appearanceVersion)}},he.services.open.client_configuration={endpointFragment:"{?required_mygame,required_invitation,required_message,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.required_invitation=e.requiredInvitation,e.required_message=e.requiredMessage,e.required_mygame=e.requiredMygame}},he.services.show.redirect={endpointFragment:"{?uri,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH_POPUP,opacity:0,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],endCallback:function(e,t){t&&t.response.result.redirect&&(f.href=t.response.result.redirect_uri)}},he.services.show.shortcut_icon={endpointFragment:"{?shortcut_type,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.shortcut_type=e.shortcutType}},he.services.show.commercial_transaction={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]},he.services.show.client_agreement={endpointFragment:"{?page_type,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.is_easy_registration&&(e.page_type="menu")}},he.services.show.browser_switch_guide={endpointFragment:"{?os_name,os_version,application_name,application_version,product,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH_POPUP,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){var t=E.platform.getInformation();t&&(t.os&&(e.os_name=t.os.name,e.os_version=t.os.version),t.application&&(e.application_name=t.application.name,e.application_version=t.application.version),t.product&&(e.product=t.product))}},he.services.show.account_manager={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB],startCallback:function(e){}},he.services.show.account_setting={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_PAGE,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC],startCallback:function(e){}},["client_community","mygame","mypage","add_mygame"].forEach(function(e){he.services.show[e]={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]}}),he.services.show.portal={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]},he.services.show.chat_channel={endpointFragment:"{?target_user_id,channel_id,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID],startCallback:function(e){e.target_user_id=e.targetUserId,e.channel_id=e.channelId}},he.services.show.arbitrarily={endpointFragment:"{?url,"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID]},he.services.show.privacy_policy={endpointFragment:"{?"+he.requestParametersFragment,display:E.constants.DISPLAY_TOUCH,displayOverridable:!1,supportedDeviceIds:[E.constants.DEVICE_ID_PC]};var me={pluginsType:"plugins-type",productName:"product-name",widgetId:"widget-id",widgetMode:"widget-mode",stampSize:"stamp-size",theme:"theme",defaultMessage:"default-message",successCallback:"success-callback",styleSheet:"style-sheet"},fe={previewLimit:"preview-limit",limit:"limit"},_e={useStream:"use-stream",showHeader:"show-header",showLink:"show-link",showPostform:"show-postform"},ve=[E.constants.DEVICE_ID_PC,E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID];he.embeds.chat=function(o){var r=E.clientConfig.deviceId;ve&&ve.indexOf(r)<0?E.log.error("deviceId: "+r+" is unsupported."):E.oauth.getStatus(function(e){if(e.login){var t=o.scriptId||"mocha-plugin-script";if(D.getElementById(t))return;var i=D.getElementById(o.targetId);if(!i)return void E.log.error('mobage.ui.embed("chat"): target element not found: targetId = '+o.targetId);if("browser"!==E.platform.getEnvironment()&&(o.showLink=!1),r===E.constants.DEVICE_ID_PC){if(E.platform.isIE())return void E.log.error('mobage.ui.embed("chat"): IE is not support');o.showLink=!1}i.classList.contains("mbga-game-chat")||E.chrome.addClass(i,"mbga-game-chat"),i.setAttribute("data-talk-id",o.channelId),i.setAttribute("data-plugins-type","mbga-game-chat"),Object.keys(me).forEach(function(e){if(void 0!==o[e]){var t=me[e];i.setAttribute("data-"+t,o[e])}}),Object.keys(fe).forEach(function(e){if(void 0!==o[e]){var t=fe[e];i.setAttribute("data-"+t,0|o[e])}}),Object.keys(_e).forEach(function(e){if(void 0!==o[e]){var t=_e[e],n=o[e]?"true":"false";i.setAttribute("data-"+t,n)}});var n=D.createElement("script");n.id=t,n.async=!0,n.src=E.endpoints.mocha.widget_script,n.setAttribute("data-lang","ja"),n.setAttribute("data-app-id",E.clientConfig.appId),D.getElementsByTagName("head")[0].appendChild(n)}else E.log.error('mobage.ui.embed("chat"): user should logged in')})};var ye="mbga-game-forum",be=[E.constants.DEVICE_ID_SPWEB,E.constants.DEVICE_ID_IOS,E.constants.DEVICE_ID_ANDROID];he.embeds["forum-topic-list"]=function(d){var e=E.clientConfig.deviceId;be&&be.indexOf(e)<0?E.log.error("deviceId: "+e+" is unsupported."):E.oauth.getStatus(function(e){var t=D.getElementById(d.targetId);t||E.log.error('mobage.ui.embed("forum-topic-list"): target element not found: targetId = '+d.targetId);var n=d.forumId;n||E.log.error('mobage.ui.embed("forum-topic-list"): forumId is required');var i=d.categoryId,o=d.subCategoryId,r=d.sortBy,s=d.count,a=d.width||t.width||"100%",c=d.height||t.height||"500px",u=E.util.encodeQuery({category_id:i,sub_category_id:o,sort_by:r,count:s});u&&(u="?"+u),t.setAttribute("data-plugins-type",ye),t.setAttribute("class",ye),t.setAttribute("data-forum-id",n),i&&t.setAttribute("data-category-id",i),o&&t.setAttribute("data-sub-category-id",o),r&&t.setAttribute("data-sort-by",r),s&&t.setAttribute("data-count",s);var p=D.createElement("iframe");p.src=E.endpoints.forum.origin+"/"+n+"/widgets/topics"+u,p.width=a,p.height=c;var l=D.createElement("div");l.style.overflow="auto",l.style.setProperty("-webkit-overflow-scrolling","touch"),l.style.width=a,l.style.height=c,l.appendChild(p),t.appendChild(l)})},he.embeds.panel=function(e){var t=E.endpoints.widget.panel,n=new E.http.Request({url:t,method:"GET",withCredentials:!0});E.http.request(n,function(e,t){e&&console.log("err: ",e),t&&console.log("res: ",t)})};var Ie={clearPaymentBacklog:function(e){"string"==typeof e||e instanceof Array&&e.every(function(e){return"string"==typeof e})?E.storage.paymentBacklog.deleteBacklog(e):E.log.error("mobage.bank.clearPaymentBacklog: transactionId should be string or Array.<string>")}};E.storage.paymentBacklog.getAllTransactionIds&&!E.storage.paymentBacklog.getAllTransactionIds.bind&&(E.storage.paymentBacklog.getAllTransactionIds.bind=function(){var e=E.storage.paymentBacklog.getAllTransactionIds;return function(){return e.apply(E.storage.paymentBacklog)}}),Ie.getPaymentAllTransactionIds=E.storage.paymentBacklog.getAllTransactionIds.bind(E.storage.paymentBacklog),E.bank=Ie;var De={android:{},ios:{},backend:function(){var e=E.platform.getEnvironment();return"android-shellapp"===e?E.bridge.android:"ios-shellapp"===e?E.bridge.ios:void 0}};E.bridge=De;var Ee={supportedDeviceIds:[E.constants.DEVICE_ID_ANDROID],request:function(e,t,n,i){n=n||function(){},i=i||E.util.randomString(12)+E.util.nextSequence("bridge");var o=E.clientConfig.deviceId;this.supportedDeviceIds&&this.supportedDeviceIds.indexOf(o)<0?E.log.error("deviceId: "+o+" is unsupported."):(E.callbackRegistry.register(i,function(e){n(e)}),setTimeout(function(){E.chrome.requestWithIframe("mobage-client-bridge:///#"+encodeURIComponent(JSON.stringify({id:i,method:e,params:t,version:E.SDK_VERSION})))},0))},invokeResponseCallback:function(e){if(e.result.analytics_events){var t=E.analytics.decodeRawEvents(e.result.analytics_events);E.analytics.publishEvents(t)}var n=E.callbackRegistry.remove(e.id);n&&n(e.result)}};E.bridge.android=Ee;var Ce={supportedDeviceIds:[E.constants.DEVICE_ID_IOS],request:function(e,t,n,i){n=n||function(){},i=i||E.util.randomString(12)+E.util.nextSequence("bridge");var o=E.clientConfig.deviceId;this.supportedDeviceIds&&this.supportedDeviceIds.indexOf(o)<0?E.log.error("deviceId: "+o+" is unsupported."):(E.callbackRegistry.register(i,function(e){n(e)}),E.chrome.requestWithIframe("mobage-client-bridge:///#"+encodeURIComponent(JSON.stringify({id:i,method:e,params:t,version:E.SDK_VERSION}))))},invokeResponseCallback:function(e){if(e.result.analytics_events){var t=E.analytics.decodeRawEvents(e.result.analytics_events);E.analytics.publishEvents(t)}var n=E.callbackRegistry.remove(e.id);n&&n(e.result)}};E.bridge.ios=Ce;var Se={shellapp:{},chromeapps:{},apply:function(n,i){Object.keys(n).forEach(function(e){if("function"==typeof n[e])if(void 0===i[e])i[e]=n[e];else if(void 0===i[e].orig){var t=i[e];i[e]=n[e],i[e].orig=t}})}};E.ext=Se;var we={invokeAuthorizationProcess:function(e){e.response_type.match(/\bid_token\b/)||(e.response_type=e.response_type+" id_token"),e.response_type.match(/\btoken\b/)||(e.response_type=e.response_type+" token");var t="mobage.oauth.invokeAuthorizationProcess";(E.platform.isAndroidShellAppSDK()||"0"===E.clientConfig.sdkConfigs.xasm)&&(t="mobage.oauth.invokeAuthorizationWithBrowserProcess"),E.bridge.request(t,e,function(e){E.callbackRegistry.remove("authorization_response")(e)})},invokeEasyRegistrationProcess:function(e){var t;E.platform.isAndroidShellAppSDK()||"0"===E.clientConfig.sdkConfigs.xasm?(t="mobage.oauth.invokeEasyRegistrationWithBrowserProcess",e.response_type.match(/\bid_token\b/)||(e.response_type=e.response_type+" id_token")):t="mobage.oauth.invokeEasyRegistrationProcess",E.bridge.request(t,e,function(e){E.callbackRegistry.remove("easy_registration_response")(e)})},invokeLogoutProcess:function(e){E.bridge.request("mobage.oauth.invokeLogoutProcess",e,function(e){E.callbackRegistry.remove("logout_response")(e)})},invokeDisconnectProcess:function(e){E.bridge.request("mobage.oauth.invokeDisconnectProcess",e,function(e){E.callbackRegistry.remove("uninstall_response")(e)})},revokeToken:function(e){E.bridge.request("mobage.oauth.revokeToken",{}),E.oauth.revokeToken.orig(e)}};E.ext.shellapp.oauth=we;var ke={iframeModalServices:["payment","redirect"],browserServices:["client_community","mygame","mypage","portal","privacy_policy","arbitrarily"],unsupportedServices:["shortcut_icon","browser_switch_guide"],sandboxLoginRequiredServices:["payment","inquiry","user_upgrade","invitation","commercial_transaction","coin_purchase","client_configuration","sandbox_support","client_community","mygame","mypage","portal"],serviceLoginRequiredServices:["payment","inquiry","user_upgrade","invitation","coin_purchase","client_configuration","client_community","mygame","mypage","portal"],forceLogin:function(n,i){E.oauth.getStatus(function(e){e.login?n():E.oauth.connect({state:E.util.randomString(32)},function(e,t){e?i():n()})})},invokeWidgetServiceProcess:function(t,e,n,i){ke.iframeModalServices.some(function(e){return e===t})?ke.invokeWidgetServiceInIframeModal(t,e,n,i):ke.browserServices.some(function(e){return e===t})?(delete n.client_origin_uri,ke.invokeWidgetServiceInExternalBrowser(t,e,n,i)):(delete n.client_origin_uri,n.service=t,ke.invokeWidgetServiceInPrivilegedWebView(t,e,n,i))},invokeWidgetServiceInIframeModal:function(t,e,n,i){(E.platform.isSandbox()?ke.sandboxLoginRequiredServices:ke.serviceLoginRequiredServices).some(function(e){return e===t})?ke.forceLogin(function(){E.ui.invokeWidgetServiceProcess.orig(t,e,n,i)},function(){i({error:"login_required",errorDescription:"User login is required to invoke payment service"},null)}):E.ui.invokeWidgetServiceProcess.orig(t,e,n,i)},invokeWidgetServiceInPrivilegedWebView:function(i,e,t){var o="user_upgrade"===i?"user_upgrade_response":"ui_response",n=function(){E.bridge.request("mobage.ui.invokeWidgetServiceProcess",t,function(e){var t=E.callbackRegistry.remove(o);if("user_upgrade"===i)e.error?t({error:e.error,errorDescription:e.error_description},null):(delete e.topic,t(null,e));else{var n=e.extra;n.error?t({error:n.error,errorDescription:n.error_description},null):t(null,{response:n,signedResponse:e.signedExtra})}},t.notification_id)};(E.platform.isSandbox()?ke.sandboxLoginRequiredServices:ke.serviceLoginRequiredServices).some(function(e){return e===i})?ke.forceLogin(function(){n()},function(){E.callbackRegistry.remove(o)({error:"login_required",errorDescription:"User login is required to invoke "+i+" service"},null)}):n()},invokeWidgetServiceInExternalBrowser:function(e,t,n){E.bridge.request("mobage.ui.openURLInBrowser",{url:t},null,n.notification_id)},getServiceConfig:function(e,t){var n=E.ui.getServiceConfig.orig(e,t);return ke.unsupportedServices.some(function(e){return e===t})?y:("redirect"===t&&(n.endCallback=function(e,t){t&&t.response.result.redirect&&E.bridge.request("mobage.ui.openURLInBrowser",{url:t.response.result.redirect_uri})}),n)}};E.ext.shellapp.ui=ke;var xe={unsupportedServices:["shortcut_icon","browser_switch_guide"],getServiceConfig:function(e,t){return ke.unsupportedServices.some(function(e){return e===t})?y:E.ui.getServiceConfig.orig(e,t)}};E.ext.chromeapps.ui=xe;var Pe={sessionTokenKID:"",invokeAuthorizationProcess:function(n,e){var r,i=E.endpoints.connect.authorize,s=i+"?"+E.util.encodeQuery(n);"none"===n.prompt?(r=E.chrome.createInvisibleIframe(s,function(){de.registerListeners(r)}))||(E.callbackRegistry.remove("authorization_response"),e({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"})):"touch_popup"===n.display?(r=E.chrome.createModalIframe({url:s,id:"authorize_consent_frame"},function(){de.registerListeners(r)}))||(E.callbackRegistry.remove("authorization_response"),e({error:"multiple_modals",errorDescription:"Cannot open multiple modals at once"})):"touch"===n.display&&(n.display="page",Pe.ssoToken(function(e){if("sso_token_response"===e.topic){Pe.sessionTokenKID=e.extra.session_token_kid,n.response_type.match(/\bid_token\b/)||(n.response_type=n.response_type+" id_token");var t={session_token_kid:Pe.sessionTokenKID,_mobage_chromeapps_open_in_browser:1};s=i+"?"+E.util.encodeQuery(n)+"&"+E.util.encodeQuery(t),r=E.chrome.createWindow({url:s,id:"authorize_consent_window"});var o=new E.channel.WindowChannel(r.window,E.endpoints.connect.origin,I.self);o.addNotifyListener("authorization_response",function(t){r.dispose(),o.dispose();var e=t.extra,n=e.id_token,i=E.callbackRegistry.remove("authorization_response");Pe.sso(Pe.sessionTokenKID,n,function(e){"sso_response"===e.topic?(t.extra.session_state=e.extra.session_state,i(t.extra)):i({error:"sso_error",errorDescription:"sso api error"})})}),o.addNotifyListener("authorization_error_response",function(e){r.dispose(),o.dispose();e.extra;E.callbackRegistry.remove("authorization_response")(e.extra)}),o.addNotifyListener("analytics",function(e){E.analytics.publishEvents([e.extra])})}else E.log.error("sso token error. response:  ",e)}))},sso:function(e,t,n){var i=E.ext.chromeapps.endpoints.connect.sso(E.clientConfig.clientId),o={session_token_kid:e,login_hint:t,client_origin_uri:f.origin},r=i+"?"+E.util.encodeQuery(o);Pe.invokeSSOProcess(r,"sso_response","sso_error_response",n)},ssoToken:function(e){var t=E.ext.chromeapps.endpoints.connect.ssoToken(E.clientConfig.clientId),n={client_origin_uri:f.origin},i=t+"?"+E.util.encodeQuery(n);Pe.invokeSSOProcess(i,"sso_token_response","sso_token_error_response",e)},invokeSSOProcess:function(e,n,i,o){var r=E.chrome.createInvisibleIframe(e,function(){var t=new E.channel.WindowChannel(r.window,E.endpoints.connect.origin,I.self);t.addNotifyListener(n,function(e){r.dispose(),t.dispose();e.extra;o(e)}),t.addNotifyListener(i,function(e){r.dispose(),t.dispose();e.extra;o(e)}),t.addNotifyListener("analytics",function(e){E.analytics.publishEvents([e.extra])})});return r}};E.ext.chromeapps.oauth=Pe;E.ext.chromeapps.endpoints={connect:{redirect:function(e){return"https://connect.mobage.jp/connect/1.0/clients/"+e+"/chromeapps/redirect"},ssoToken:function(e){return"https://connect.mobage.jp/connect/1.0/clients/"+e+"/chromeapps/sso_token"},sso:function(e){return"https://connect.mobage.jp/connect/1.0/clients/"+e+"/chromeapps/sso"}}};var Ae={callBridgeMethod:function(e,t,n){var i=E.bridge.backend();if(i){var o=E.util.randomString(12)+E.util.nextSequence("user_bridge");i.request(e,t,n,o)}else console.error("Cannot use bridge call on this environment")},openURLInBrowser:function(e){var t=E.bridge.backend();t?t.request("mobage.ui.openURLInBrowser",{url:e}):console.error("Cannot use bridge call on this environment")}};E.shellapp=Ae,E.clientConfig={},E._isInitialized=!1,E._emitToDocument=function(e){var t;"function"==typeof CustomEvent?t=new CustomEvent(e,{}):(t=D.createEvent("Event")).initEvent(e,!0,!0),D.dispatchEvent(t)},E.ready=function(){E._emitToDocument("mobageReady")},E.initialized=function(){E._emitToDocument("mobageInitialized"),E._isInitialized=!0},E.isInitialized=function(){return E._isInitialized},E.init=function(e){if(E.log.debug("mobage.init called"),void 0!==e.clientId&&"string"==typeof e.clientId){var t=e.clientId.match(/([a-zA-Z0-9]+)-(\d+)/);if(3===t.length)if(e.redirectUri&&"string"!=typeof e.redirectUri)E.log.error("redirectUri should be string");else{if(e.contentOrigin){if("string"!=typeof e.contentOrigin)return void E.log.error("contentOrigin should be string");if(e.contentOrigin.match(/\/$/))return void E.log.error("contentOrigin should not be terminated with / (slash) because it is origin URL")}if(e.scope&&!e.scope instanceof Array)E.log.error("scope should be Array.<string>");else if(e.responseType&&!e.responseType instanceof Array)E.log.error("scope should be Array.<string>");else if(e.uiCloseTimeout&&"number"!=typeof e.uiCloseTimeout)E.log.error("uiCloseTimeout should be number");else{if(E.platform.isSafariPrivateMode())throw E.log.error("this browser is safari private mode"),new Error("This browser can not use LocalStorage");E.clientConfig=e,E.clientConfig.appId=t[1],E.clientConfig.deviceId=t[2],o.__mobageSDK&&o.__mobageSDK.no_heartbeat_frame||(e.analytics=e.analytics||{},E.analytics.init({clientId:e.clientId,pathname:f.pathname,referrer:D.referrer,viaMobageCore:e.analytics.viaMobageCore,extraPayload:e.analytics.extraPayload},function(){})),o.__mobageSDK&&o.__mobageSDK.no_session_frame||E.oauth.init(function(){E.ui.init()}),E.platform.getInformation().unsupported&&E.clientConfig.showBrowserSwitchGuide&&E.ui.show("browser_switch_guide"),E.callbackRegistry.register("analytics",function(e){E.event.emit("analytics",e),E.event.emit("analytics.userActivity",e)});var n=p.getEnvironment();"browser"!==n&&E.initShellAppFeatures(n),p.isChromeappWebView()&&(E.ext.apply(E.ext.chromeapps.oauth,E.oauth),E.ext.apply(E.ext.chromeapps.ui,E.ui),E.ext.apply(E.ext.chromeapps.endpoints.connect,E.endpoints.connect)),E.initialized()}}else E.log.error('clientId should be string of "{appId}-{deviceId}" style')}else E.log.error("clientId should be string")},E.initShellAppFeatures=function(e){var t={client_id:E.clientConfig.clientId,endpoint_urls:{connect:{origin:E.endpoints.connect.origin,authorize:E.endpoints.connect.authorize,logout:E.endpoints.connect.logout,uninstall:E.endpoints.connect.uninstall,fire_install_api:E.endpoints.connect.fire_install_api,session_token_api:E.endpoints.connect.session_token_api,session_api:E.endpoints.connect.session_api,user_upgrade:E.endpoints.connect.user_upgrade,client_updates_api:E.endpoints.connect.client_updates_api(E.clientConfig.clientId),user_purchase_limit_api:E.endpoints.connect.user_purchase_limit_api,session_check:E.endpoints.connect.session_check,xasm_proxy:E.endpoints.connect.xasm_proxy,easy_registration:E.endpoints.connect.easy_registration},widget:{origin:E.endpoints.widget.origin,inquiry:E.endpoints.widget.inquiry,user_upgrade:E.endpoints.widget.user_upgrade,invitation:E.endpoints.widget.invitation,commercial_transaction:E.endpoints.widget.commercial_transaction,client_agreement:E.endpoints.widget.client_agreement,coin_purchase:E.endpoints.widget.coin_purchase,vc_purchase:E.endpoints.widget.vc_purchase,client_configuration:E.endpoints.widget.client_configuration,arbitrarily:E.endpoints.widget.arbitrarily},api:{v2:{origin:E.endpoints.api.v2.origin,jsonrpc:E.endpoints.api.v2.jsonrpc}},mobage:{origin:E.endpoints.mobage.origin,term:E.endpoints.mobage.term,tokushouhou:E.endpoints.mobage.tokushouhou},currency:{origin:E.endpoints.currency.origin}},cookie_configs:{tracking_cookie_key:"CTID_P"}};"android-shellapp"===e?(E.ext.apply(E.ext.shellapp.oauth,E.oauth),E.ext.apply(E.ext.shellapp.ui,E.ui),t.endpoint_urls.mobage.notes=E.endpoints.mobage.vca_notes,t.endpoint_urls.mobage.faq=E.endpoints.mobage.vca_faq,t.endpoint_urls.currency.product=E.endpoints.currency.product_base+"iab",t.endpoint_urls.currency.begin_purchase=E.endpoints.currency.begin_purchase_base+"iab",t.endpoint_urls.currency.purchase=E.endpoints.currency.purchase_base+"iab",t.endpoint_urls.widget.choose_product=E.endpoints.widget.choose_product,t.extra={},t.extra.gcm_sender_id="347092074773",E.bridge.request=E.bridge.android.request):"ios-shellapp"===e&&(E.ext.apply(E.ext.shellapp.oauth,E.oauth),E.ext.apply(E.ext.shellapp.ui,E.ui),t.endpoint_urls.mobage.notes=E.endpoints.mobage.vc_notes,t.endpoint_urls.mobage.faq=E.endpoints.mobage.vc_faq,t.endpoint_urls.currency.product=E.endpoints.currency.product_base+"iap",t.endpoint_urls.currency.begin_purchase=E.endpoints.currency.begin_purchase_base+"iap",t.endpoint_urls.currency.purchase=E.endpoints.currency.purchase_base+"iap",t.endpoint_urls.connect.easy_registration_api=E.endpoints.connect.easy_registration_api,t.endpoint_urls.connect.easy_registration=E.endpoints.connect.easy_registration,t.endpoint_urls.widget.client_community=E.endpoints.widget.client_community,t.endpoint_urls.widget.mygame=E.endpoints.widget.mygame,t.endpoint_urls.widget.mypage=E.endpoints.widget.mypage,t.endpoint_urls.widget.portal=E.endpoints.widget.portal,t.endpoint_urls.widget.privacy_policy=E.endpoints.widget.privacy_policy,t.endpoint_urls.widget.choose_product=E.endpoints.widget.choose_product,E.bridge.request=E.bridge.ios.request),E.bridge.request&&!I.opener&&I.top===I&&(E.clientConfig.sdkConfigs={},E.bridge.request("mobage.provideConfigs",t,function(e){E.clientConfig.sdkConfigs=e}))},E.clearAllStorage=function(){E.storage.status.clear(),E.storage.paymentBacklog.clear(),E.apiproxy.notifyAll("remove_token",{storage_suffix:E.storage.sessionState.get()}),E.storage.sessionState.clear()},o.__mobageSDK&&o.__mobageSDK.no_proxy_frame?E.ready():E.apiproxy.init(function(){E.analytics.openTrackingCookieIframe(function(){E.ready()})})}(window,window,document,location);
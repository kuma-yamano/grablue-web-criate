define(["underscore","backbone"],function(a,b){var c=function(b){var c=0===b.indexOf("?")?b.slice(1):b,d=c?c.split("&"):[];return a.object(a.map(d,function(a){return a.split("=")}))},d=function(c,d){var e=window.location;d.refresh?(b.history.stop(),e.hash=c,e.reload()):b.History.started?(d=d||{},a.has(d,"trigger")||(d.trigger=!0),b.history.navigate(c,d)):e.hash=c},e=function(a,c){var d=window.location;c.refresh?(b.history.stop(),d.href=a,d.reload()):d.href=a},f=function(a){if(window.Game&&window.Game.ajaxConnecting){var b=$(document);b.on("ajaxStop",function c(){b.off("ajaxStop",c),a()})}else a()},g=function(b,c){c=c||{};var e=a.partial(d,b,c);c.sync?f(e):e()},h=function(b,c){c=c||{};var d=a.partial(e,b,c);c.sync?f(d):d()};return{parseQuery:c,hash:g,href:h}});